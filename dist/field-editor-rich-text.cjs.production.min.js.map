{"version":3,"file":"field-editor-rich-text.cjs.production.min.js","sources":["../src/ContentfulEditorProvider.ts","../src/helpers/environment.ts","../src/helpers/editor.ts","../src/plugins/links-tracking.tsx","../src/SdkProvider.tsx","../src/plugins/shared/useFetchedEntity.ts","../src/plugins/shared/FetchingWrappedAssetCard.tsx","../src/plugins/shared/FetchingWrappedEntryCard.tsx","../src/plugins/EmbeddedEntityBlock/LinkedEntityBlock.tsx","../../../node_modules/regenerator-runtime/runtime.js","../src/helpers/getLinkedContentTypeIdsForNodeType.ts","../src/helpers/newEntitySelectorConfigFromRichTextField.ts","../src/plugins/EmbeddedEntityBlock/Util.ts","../src/plugins/EmbeddedEntityBlock/ToolbarIcon.tsx","../src/plugins/EmbeddedEntityBlock/index.tsx","../src/plugins/EmbeddedEntityInline/FetchingWrappedInlineEntryCard.tsx","../src/plugins/EmbeddedEntityInline/Util.ts","../src/plugins/EmbeddedEntityInline/index.tsx","../src/helpers/validations.ts","../src/plugins/Heading/components/ToolbarHeadingButton.tsx","../src/helpers/transformers.ts","../src/helpers/extractNodes.ts","../src/plugins/Heading/components/Heading.tsx","../src/plugins/Heading/createHeadingPlugin.ts","../src/plugins/shared/ToolbarButton.tsx","../src/plugins/Hr/index.tsx","../src/plugins/Hyperlink/HyperlinkModal.tsx","../src/plugins/Hyperlink/components/ToolbarHyperlinkButton.tsx","../src/plugins/Hyperlink/utils.ts","../src/plugins/Hyperlink/useEntityInfo.ts","../src/plugins/Hyperlink/components/styles.ts","../src/plugins/Hyperlink/components/EntityHyperlink.tsx","../src/plugins/Hyperlink/components/UrlHyperlink.tsx","../src/plugins/Hyperlink/createHyperlinkPlugin.ts","../src/plugins/List/components/List.tsx","../src/plugins/List/components/ListItem.tsx","../src/plugins/List/transforms/unwrapList.ts","../src/plugins/List/transforms/toggleList.ts","../src/plugins/List/onKeyDownList.ts","../src/plugins/List/transforms/moveListItems.ts","../src/plugins/List/transforms/moveListItemDown.ts","../src/plugins/List/utils.ts","../src/plugins/List/insertListFragment.ts","../src/plugins/List/withList.ts","../src/plugins/List/transforms/deleteBackwardList.ts","../src/plugins/List/insertListBreak.ts","../src/plugins/List/transforms/insertListItem.ts","../src/plugins/List/components/ToolbarListButton.tsx","../src/plugins/Marks/components/MarkToolbarButton.tsx","../src/plugins/Marks/helpers.ts","../src/plugins/Marks/Bold.tsx","../src/plugins/Marks/Code.tsx","../src/plugins/Marks/Italic.tsx","../src/plugins/Marks/Underline.tsx","../src/plugins/Normalizer/baseRules.ts","../src/plugins/Normalizer/utils.ts","../src/plugins/Normalizer/withNormalizer.ts","../src/plugins/Paragraph/Paragraph.tsx","../src/plugins/Paragraph/createParagraphPlugin.ts","../src/plugins/PasteHTML/utils/sanitizeHTML.ts","../src/plugins/PasteHTML/utils/sanitizeSheets.ts","../src/plugins/PasteHTML/createPasteHTMLPlugin.ts","../src/plugins/Quote/components/Quote.tsx","../src/plugins/Quote/shouldResetQuote.ts","../src/plugins/Quote/toggleQuote.ts","../src/plugins/Quote/withQuote.ts","../src/plugins/Quote/createQuotePlugin.ts","../src/plugins/Quote/components/ToolbarQuoteButton.tsx","../src/plugins/SlashCommands/helpers.ts","../src/plugins/SlashCommands/SlashCommandsPalette.tsx","../src/plugins/Table/actions/addRow.ts","../src/plugins/Table/actions/addColumn.ts","../src/plugins/Table/helpers.ts","../src/plugins/Table/components/TableActions.tsx","../src/plugins/Table/actions/setHeader.ts","../src/plugins/Table/components/Cell.tsx","../src/plugins/Table/components/HeaderCell.tsx","../src/plugins/Table/components/Row.tsx","../src/plugins/Table/components/Table.tsx","../src/plugins/Table/insertTableFragment.ts","../src/plugins/Table/onKeyDownTable.ts","../src/constants/Schema.ts","../src/plugins/Tracking/utils.ts","../src/plugins/Tracking/createTrackingPlugin.ts","../src/plugins/Table/tableTracking.ts","../src/plugins/Table/createTablePlugin.ts","../src/plugins/Table/components/ToolbarButton.tsx","../src/plugins/Text/createTextPlugin.ts","../src/plugins/TrailingParagraph/index.ts","../src/plugins/index.ts","../src/prepareDocument.ts","../src/helpers/sanitizeIncomingSlateDoc.ts","../src/RichTextEditor.styles.ts","../src/Toolbar/components/EmbeddedEntityDropdownButton.tsx","../src/Toolbar/components/EmbedEntityWidget.tsx","../src/Toolbar/index.tsx","../src/Toolbar/components/StickyToolbarWrapper.tsx","../src/useOnValueChanged.ts","../src/RichTextEditor.tsx","../src/plugins/DragAndDrop/index.tsx","../src/plugins/SlashCommands/createSlashCommandsPlugin.tsx","../src/plugins/Paragraph/utils.ts","../src/plugins/List/createListPlugin.ts","../src/plugins/Marks/index.ts","../src/plugins/Voids/createVoidsPlugin.ts","../src/plugins/SelectOnBackspace/createSelectOnBackspacePlugin.ts","../src/plugins/Break/createSoftBreakPlugin.ts","../src/plugins/Break/createExitBreakPlugin.ts","../src/plugins/Break/createResetNodePlugin.ts","../src/plugins/Normalizer/createNormalizerPlugin.ts","../src/dialogs/HypelinkDialog/HyperlinkDialog.jsx","../src/dialogs/openRichTextDialog.tsx","../src/dialogs/renderRichTextDialog.tsx"],"sourcesContent":["import { createContext, useContext } from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { usePlateEditorRef, usePlateEditorState } from '@udecode/plate-core';\n\nimport { RichTextEditor } from './types';\n\nexport function getContentfulEditorId(sdk: FieldExtensionSDK) {\n  const { entry, field } = sdk;\n  const sys = entry.getSys();\n\n  return `rich-text-editor-${sys.id}-${field.id}-${field.locale}`;\n}\n\nexport const editorContext = createContext('');\n\nexport const ContentfulEditorIdProvider = editorContext.Provider;\n\nexport function useContentfulEditorId(id?: string) {\n  const contextId = useContext(editorContext);\n\n  if (id) {\n    return id;\n  }\n\n  if (!contextId) {\n    throw new Error(\n      'could not find editor id. Please ensure the component is wrapped in <ContentfulEditorIdProvider> '\n    );\n  }\n\n  return contextId;\n}\n\n// This hook re-renders when the value changes\n// Use case: Toolbar icons, for example\nexport function useContentfulEditor(id?: string) {\n  const editorId = useContentfulEditorId(id);\n  const editor = usePlateEditorState<RichTextEditor>(editorId);\n\n  return editor;\n}\n\n// This doesn't re-render when the value changes\nexport function useContentfulEditorRef(id?: string) {\n  const editorId = useContentfulEditorId(id);\n  const editor = usePlateEditorRef<RichTextEditor>(editorId);\n\n  return editor;\n}\n","export const IS_SAFARI =\n  typeof navigator !== 'undefined' && /Version\\/[\\d.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_CHROME = /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9.]+)(:?\\s|$)/.test(\n  navigator.userAgent\n);\n","import { Link } from '@contentful/field-editor-reference/dist/types';\nimport { BLOCKS, INLINES } from '@contentful/rich-text-types';\nimport {\n  EditorNodesOptions,\n  getText,\n  PlateEditor,\n  toggleNodeType,\n  ToggleNodeTypeOptions,\n} from '@udecode/plate-core';\nimport { Text, Editor, Element, Transforms, Path, Range, Node } from 'slate';\nimport { ReactEditor } from 'slate-react';\n\nimport { CustomElement, RichTextEditor } from '../types';\nimport { IS_SAFARI } from './environment';\n\nexport const LINK_TYPES: INLINES[] = [\n  INLINES.HYPERLINK,\n  INLINES.ENTRY_HYPERLINK,\n  INLINES.ASSET_HYPERLINK,\n];\n\nconst LIST_TYPES: BLOCKS[] = [BLOCKS.OL_LIST, BLOCKS.UL_LIST];\n\nexport function isBlockSelected(editor: PlateEditor, type: string): boolean {\n  const [match] = Array.from(\n    Editor.nodes(editor, {\n      match: (node) => Element.isElement(node) && (node as CustomElement).type === type,\n    })\n  );\n  return !!match;\n}\n\nexport function isRootLevel(path: Path): boolean {\n  return path.length === 1;\n}\n\ntype NodeEntry = [CustomElement, Path];\ntype NodeType = BLOCKS | INLINES;\nexport function getNodeEntryFromSelection(\n  editor: RichTextEditor,\n  nodeTypeOrTypes: NodeType | NodeType[],\n  path?: Path\n): NodeEntry | [] {\n  path = path ?? editor.selection?.focus.path;\n  if (!path) return [];\n  const nodeTypes = Array.isArray(nodeTypeOrTypes) ? nodeTypeOrTypes : [nodeTypeOrTypes];\n  for (let i = 0; i < path.length; i++) {\n    const nodeEntry = Editor.node(editor, path.slice(0, i + 1)) as NodeEntry;\n    if (nodeTypes.includes(nodeEntry[0].type as NodeType)) return nodeEntry;\n  }\n  return [];\n}\n\nexport function isNodeTypeSelected(editor: RichTextEditor, nodeType: BLOCKS | INLINES): boolean {\n  if (!editor) return false;\n  const [node] = getNodeEntryFromSelection(editor, nodeType);\n  return !!node;\n}\n\nexport function moveToTheNextLine(editor: RichTextEditor) {\n  Transforms.move(editor, { distance: 1, unit: 'line' });\n}\n\nexport function moveToTheNextChar(editor: RichTextEditor) {\n  Transforms.move(editor, { distance: 1, unit: 'offset' });\n}\n\nexport function insertEmptyParagraph(editor: RichTextEditor, options?) {\n  const emptyParagraph: CustomElement = {\n    type: BLOCKS.PARAGRAPH,\n    children: [{ text: '' }],\n    data: {},\n    isVoid: false,\n  };\n  Transforms.insertNodes(editor, emptyParagraph, options);\n}\n\nexport function getElementFromCurrentSelection(editor: RichTextEditor) {\n  if (!editor.selection) return [];\n\n  return Array.from(\n    Editor.nodes(editor, {\n      /**\n       * editor.select is a Range, which includes anchor and focus, the beginning and the end of a selection\n       * when using only editor.selection.focus, we might get only the end of the selection, or where the text cursor is\n       * and in some cases getting the next element instead of the one we want\n       **/\n      at: editor.selection,\n      match: (node) => Element.isElement(node),\n    })\n  ).flat();\n}\n\nexport function isList(editor?: RichTextEditor) {\n  if (!editor) {\n    return false;\n  }\n\n  const element = getElementFromCurrentSelection(editor);\n\n  return element.some(\n    (element) =>\n      Element.isElement(element) && LIST_TYPES.includes((element as CustomElement).type as BLOCKS)\n  );\n}\n\nexport function getTableSize(\n  table: CustomElement\n): Record<'numRows' | 'numColumns', number> | null {\n  const numRows = table.children.length;\n  if (!numRows) return null;\n  const [firstRow] = table.children;\n  const numColumns = (firstRow as CustomElement).children?.length;\n  return { numRows, numColumns };\n}\n\ninterface InsertLinkOptions {\n  text: string;\n  type: INLINES.HYPERLINK | INLINES.ENTRY_HYPERLINK | INLINES.ASSET_HYPERLINK;\n  url?: string;\n  target?: Link;\n  path?: Path;\n}\n\n// TODO: move to hyperlink plugin\nexport function insertLink(editor, options: InsertLinkOptions) {\n  if (editor.selection) {\n    wrapLink(editor, options);\n  }\n}\n\n// TODO: move to hyperlink plugin\nexport function isLinkActive(editor?: RichTextEditor) {\n  if (!editor) {\n    return false;\n  }\n\n  const [link] = Array.from(\n    Editor.nodes(editor, {\n      match: (node) =>\n        !Editor.isEditor(node) &&\n        Element.isElement(node) &&\n        LINK_TYPES.includes((node as CustomElement).type as INLINES),\n    })\n  );\n  return !!link;\n}\n\n// TODO: move to hyperlink plugin\nexport function unwrapLink(editor) {\n  Transforms.unwrapNodes(editor, {\n    match: (node) =>\n      !Editor.isEditor(node) &&\n      Element.isElement(node) &&\n      LINK_TYPES.includes((node as CustomElement).type as INLINES),\n  });\n}\n\n// TODO: move to hyperlink plugin\nexport function wrapLink(editor, { text, url, target, type, path }: InsertLinkOptions) {\n  if (isLinkActive(editor) && !path) {\n    unwrapLink(editor);\n  }\n\n  const { selection } = editor;\n  const isCollapsed = selection && Range.isCollapsed(selection);\n  const link = {\n    type,\n    data: {},\n    children: isCollapsed ? [{ text }] : [],\n  };\n\n  if (url) {\n    link.data = { uri: url };\n  }\n\n  if (target) {\n    link.data = { target };\n  }\n\n  // TODO: always set the selection to the end of the inserted link\n  if (path) {\n    Transforms.setNodes(editor, link, { at: path });\n    Transforms.insertText(editor, text, { at: path });\n    Transforms.select(editor, path);\n  } else if (isCollapsed) {\n    Transforms.insertNodes(editor, link);\n  } else {\n    Transforms.wrapNodes(editor, link, { split: true });\n    Transforms.delete(editor);\n    Transforms.insertText(editor, text);\n    Transforms.collapse(editor, { edge: 'end' });\n  }\n}\n\nexport function getAncestorPathFromSelection(editor: RichTextEditor) {\n  if (!editor.selection) return undefined;\n\n  return Path.levels(editor.selection.focus.path).find((level) => level.length === 1);\n}\n\nexport const isAtEndOfTextSelection = (editor: RichTextEditor) =>\n  editor.selection?.focus.offset === getText(editor, editor.selection?.focus.path).length;\n\n/**\n * This traversal strategy is unfortunately necessary because Slate doesn't\n * expose something like Node.next(editor).\n */\nexport function getNextNode(editor: RichTextEditor): CustomElement | null {\n  if (!editor.selection) {\n    return null;\n  }\n  const descendants = Node.descendants(editor, { from: editor.selection.focus.path });\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const { done, value } = descendants.next();\n    if (done) {\n      return null;\n    }\n    const [node, path] = value as NodeEntry;\n    if (Path.isCommon(path, editor.selection.focus.path)) {\n      continue;\n    }\n    return node as CustomElement;\n  }\n}\n\nexport const INLINE_TYPES = Object.values(INLINES) as string[];\n\nexport const isInlineOrText = (node: Node) => {\n  // either text or inline elements\n  return Text.isText(node) || (Element.isElement(node) && INLINE_TYPES.includes(node.type));\n};\n\nexport const focus = (editor: RichTextEditor) => {\n  const x = window.scrollX;\n  const y = window.scrollY;\n\n  ReactEditor.focus(editor);\n\n  // Safari has issues with `editor.focus({ preventScroll: true })`, it ignores the option `preventScroll`\n  if (IS_SAFARI) {\n    setTimeout(function () {\n      window.scrollTo(x, y); // restore position\n    }, 0);\n  }\n};\n\nexport function toggleElement(\n  editor: RichTextEditor,\n  options: ToggleNodeTypeOptions,\n  editorOptions?: Omit<EditorNodesOptions, 'match'>\n) {\n  toggleNodeType(editor, options, editorOptions);\n\n  // We must reset `data` from one element to another\n  Transforms.setNodes(editor, { data: {} });\n}\n","import React, { ComponentProps } from 'react';\n\nimport { useContentfulEditorRef } from '../ContentfulEditorProvider';\n\ntype WithEntityFetchProps = {\n  onEntityFetchComplete: VoidFunction;\n} & JSX.IntrinsicAttributes;\n\nexport function withLinkTracking(Component: React.ComponentType<WithEntityFetchProps>) {\n  return function ComponentWithTracking(props: ComponentProps<typeof Component>) {\n    const editor = useContentfulEditorRef();\n    const onEntityFetchComplete = React.useCallback(\n      () => editor.tracking.onViewportAction('linkRendered'),\n      [editor]\n    );\n\n    return <Component {...props} onEntityFetchComplete={onEntityFetchComplete} />;\n  };\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport constate from 'constate';\n\ninterface SdkProviderProps {\n  sdk: FieldExtensionSDK;\n}\n\nfunction useSdk({ sdk }: SdkProviderProps) {\n  const sdkMemo = React.useMemo<FieldExtensionSDK>(() => sdk, []); // eslint-disable-line\n\n  return sdkMemo;\n}\n\nexport const [SdkProvider, useSdkContext] = constate(useSdk);\n","import { useEffect, useState } from 'react';\n\nimport { Entry, Asset } from '@contentful/app-sdk';\nimport { useEntities } from '@contentful/field-editor-reference';\nimport areEqual from 'fast-deep-equal';\n\ninterface FetchedEntityProps {\n  type: 'Entry' | 'Asset';\n  id: string;\n  onEntityFetchComplete?: VoidFunction;\n}\n\nexport function useFetchedEntity({ type, id, onEntityFetchComplete }: FetchedEntityProps) {\n  const { entries, assets, getOrLoadEntry, getOrLoadAsset } = useEntities();\n\n  const store = type === 'Entry' ? entries : assets;\n  const [entity, setEntity] = useState<Entry | Asset | 'failed' | undefined>(store[id]);\n\n  // Deep compare the entity value to keep re-rendering to minimal\n  useEffect(() => {\n    const newValue = store[id];\n\n    if (!areEqual(entity, newValue)) {\n      setEntity(newValue);\n    }\n  }, [store, entity, id]);\n\n  // Fetch the entity if needed\n  useEffect(() => {\n    (type === 'Entry' ? getOrLoadEntry : getOrLoadAsset)(id);\n\n    // \"getOrLoadEntry\" and \"getOrLoadAsset\" instances change with every\n    // entity store update causing page lag on initial load\n    // TODO: consider rewriting useEntities() hook to avoid that happening in\n    // first place.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [type, id]);\n\n  useEffect(() => {\n    if (entity) {\n      onEntityFetchComplete?.();\n    }\n  }, [onEntityFetchComplete, entity]);\n\n  return entity;\n}\n","import * as React from 'react';\n\nimport { Asset, FieldExtensionSDK, ScheduledAction } from '@contentful/app-sdk';\nimport { AssetCard } from '@contentful/f36-components';\nimport {\n  useEntities,\n  MissingEntityCard,\n  WrappedAssetCard,\n} from '@contentful/field-editor-reference';\nimport areEqual from 'fast-deep-equal';\n\nimport { useFetchedEntity } from './useFetchedEntity';\n\ninterface InternalAssetCardProps {\n  asset?: Asset | 'failed';\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  onEdit?: () => void;\n  onRemove?: () => unknown;\n  sdk: FieldExtensionSDK;\n  loadEntityScheduledActions: (entityType: string, entityId: string) => Promise<ScheduledAction[]>;\n}\n\nconst InternalAssetCard = React.memo((props: InternalAssetCardProps) => {\n  if (props.asset === undefined) {\n    return <AssetCard size=\"default\" isLoading />;\n  }\n\n  if (props.asset === 'failed') {\n    return (\n      <MissingEntityCard\n        entityType=\"Asset\"\n        isDisabled={props.isDisabled}\n        onRemove={props.onRemove}\n      />\n    );\n  }\n\n  return (\n    <WrappedAssetCard\n      getEntityScheduledActions={props.loadEntityScheduledActions}\n      size=\"small\"\n      isSelected={props.isSelected}\n      isDisabled={props.isDisabled}\n      localeCode={props.locale}\n      defaultLocaleCode={props.sdk.locales.default}\n      asset={props.asset}\n      onEdit={props.onEdit}\n      onRemove={props.isDisabled ? undefined : props.onRemove}\n      isClickable={false}\n    />\n  );\n}, areEqual);\n\nInternalAssetCard.displayName = 'InternalAssetCard';\n\ninterface FetchingWrappedAssetCardProps {\n  assetId: string;\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  onEdit?: () => void;\n  onRemove?: () => unknown;\n  sdk: FieldExtensionSDK;\n  onEntityFetchComplete?: VoidFunction;\n}\n\nexport function FetchingWrappedAssetCard(props: FetchingWrappedAssetCardProps) {\n  const { onEntityFetchComplete, assetId } = props;\n  const { loadEntityScheduledActions } = useEntities();\n\n  const asset = useFetchedEntity({\n    type: 'Asset',\n    id: assetId,\n    onEntityFetchComplete,\n  });\n\n  return (\n    <InternalAssetCard\n      asset={asset as Asset | 'failed' | undefined}\n      sdk={props.sdk}\n      isDisabled={props.isDisabled}\n      isSelected={props.isSelected}\n      loadEntityScheduledActions={loadEntityScheduledActions}\n      locale={props.locale}\n      onEdit={props.onEdit}\n      onRemove={props.onRemove}\n    />\n  );\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { ScheduledAction, Entry } from '@contentful/app-sdk';\nimport { EntryCard } from '@contentful/f36-components';\nimport {\n  useEntities,\n  MissingEntityCard,\n  WrappedEntryCard,\n} from '@contentful/field-editor-reference';\nimport areEqual from 'fast-deep-equal';\n\nimport { useFetchedEntity } from './useFetchedEntity';\n\ninterface InternalEntryCard {\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  sdk: FieldExtensionSDK;\n  loadEntityScheduledActions: (entityType: string, entityId: string) => Promise<ScheduledAction[]>;\n  entry?: Entry | 'failed';\n  onEdit?: VoidFunction;\n  onRemove?: VoidFunction;\n}\n\nconst InternalEntryCard = React.memo((props: InternalEntryCard) => {\n  const { entry, sdk, loadEntityScheduledActions } = props;\n\n  if (entry === undefined) {\n    return <EntryCard isLoading />;\n  }\n\n  if (entry === 'failed') {\n    return (\n      <MissingEntityCard\n        entityType=\"Entry\"\n        isDisabled={props.isDisabled}\n        onRemove={props.onRemove}\n      />\n    );\n  }\n\n  const contentType = sdk.space\n    .getCachedContentTypes()\n    .find((contentType) => contentType.sys.id === entry.sys.contentType.sys.id);\n\n  return (\n    <WrappedEntryCard\n      size=\"default\"\n      getAsset={props.sdk.space.getAsset}\n      getEntityScheduledActions={loadEntityScheduledActions}\n      isSelected={props.isSelected}\n      isDisabled={props.isDisabled}\n      localeCode={props.locale}\n      defaultLocaleCode={props.sdk.locales.default}\n      contentType={contentType}\n      entry={entry}\n      onEdit={props.onEdit}\n      onRemove={props.isDisabled ? undefined : props.onRemove}\n      isClickable={false}\n    />\n  );\n}, areEqual);\n\nInternalEntryCard.displayName = 'ReferenceCard';\n\ninterface FetchingWrappedEntryCardProps {\n  entryId: string;\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  sdk: FieldExtensionSDK;\n  onEntityFetchComplete?: VoidFunction;\n  onEdit?: VoidFunction;\n  onRemove?: VoidFunction;\n}\n\nexport const FetchingWrappedEntryCard = (props: FetchingWrappedEntryCardProps) => {\n  const { entryId, onEntityFetchComplete } = props;\n  const { loadEntityScheduledActions } = useEntities();\n\n  const entry = useFetchedEntity({\n    type: 'Entry',\n    id: entryId,\n    onEntityFetchComplete,\n  });\n\n  return (\n    <InternalEntryCard\n      entry={entry}\n      sdk={props.sdk}\n      locale={props.locale}\n      isDisabled={props.isDisabled}\n      isSelected={props.isSelected}\n      onEdit={props.onEdit}\n      onRemove={props.onRemove}\n      loadEntityScheduledActions={loadEntityScheduledActions}\n    />\n  );\n};\n","import React from 'react';\n\nimport { css } from 'emotion';\nimport { Transforms } from 'slate';\nimport { ReactEditor, useSelected, useReadOnly } from 'slate-react';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { IS_CHROME } from '../../helpers/environment';\nimport { useSdkContext } from '../../SdkProvider';\nimport { CustomRenderElementProps } from '../../types';\nimport { FetchingWrappedAssetCard } from '../shared/FetchingWrappedAssetCard';\nimport { FetchingWrappedEntryCard } from '../shared/FetchingWrappedEntryCard';\n\nconst styles = {\n  root: css({\n    marginBottom: '1.25rem !important',\n    display: 'block',\n  }),\n  container: css({\n    // The next 2 properties ensure Entity card won't be aligned above\n    // a list item marker (i.e. bullet)\n    display: 'inline-block',\n    verticalAlign: 'text-top',\n    width: '100%',\n  }),\n};\n\ntype LinkedEntityBlockProps = CustomRenderElementProps<{\n  target: {\n    sys: {\n      id: string;\n      linkType: 'Entry' | 'Asset';\n      type: 'Link';\n    };\n  };\n}> & {\n  onEntityFetchComplete: VoidFunction;\n};\n\nexport function LinkedEntityBlock(props: LinkedEntityBlockProps) {\n  const { attributes, children, element, onEntityFetchComplete } = props;\n  const isSelected = useSelected();\n  const editor = useContentfulEditor();\n  const sdk = useSdkContext();\n  const isDisabled = useReadOnly();\n  const { id: entityId, linkType: entityType } = element.data.target.sys;\n\n  const handleEditClick = React.useCallback(() => {\n    const openEntity = entityType === 'Asset' ? sdk.navigator.openAsset : sdk.navigator.openEntry;\n    return openEntity(entityId, { slideIn: true });\n  }, [sdk, entityId, entityType]);\n\n  const handleRemoveClick = React.useCallback(() => {\n    if (!editor) return;\n    const pathToElement = ReactEditor.findPath(editor, element);\n    Transforms.removeNodes(editor, { at: pathToElement });\n  }, [editor, element]);\n\n  return (\n    <div\n      {...attributes}\n      className={styles.root}\n      data-entity-type={entityType}\n      data-entity-id={entityId}\n      // COMPAT: This makes copy & paste work for Firefox\n      contentEditable={IS_CHROME ? undefined : false}\n      draggable={IS_CHROME ? true : undefined}>\n      <div\n        // COMPAT: This makes copy & paste work for Chromium/Blink browsers and Safari\n        contentEditable={IS_CHROME ? false : undefined}\n        draggable={IS_CHROME ? true : undefined}\n        className={styles.container}>\n        {entityType === 'Entry' && (\n          <FetchingWrappedEntryCard\n            sdk={sdk}\n            entryId={entityId}\n            locale={sdk.field.locale}\n            isDisabled={isDisabled}\n            isSelected={isSelected}\n            onRemove={handleRemoveClick}\n            onEdit={handleEditClick}\n            onEntityFetchComplete={onEntityFetchComplete}\n          />\n        )}\n        {entityType === 'Asset' && (\n          <FetchingWrappedAssetCard\n            sdk={sdk}\n            assetId={entityId}\n            locale={sdk.field.locale}\n            isDisabled={isDisabled}\n            isSelected={isSelected}\n            onRemove={handleRemoveClick}\n            onEdit={handleEditClick}\n            onEntityFetchComplete={onEntityFetchComplete}\n          />\n        )}\n      </div>\n      {children}\n    </div>\n  );\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","/* eslint-disable you-dont-need-lodash-underscore/find */\nimport find from 'lodash/find';\nimport flow from 'lodash/flow';\nimport get from 'lodash/get';\n\n/**\n * Given a field object and a rich text node type, return a list of valid\n * content type IDs associated with the node type, based on that node type's\n * `linkContentType` validation.\n *\n * If there is no such validation or the validation is empty, return an empty\n * array.\n *\n * The navigation here is explained by the `nodes` validation having signature:\n * { nodes: { [nodeType]: validationObject[] } }\n *\n * We defensively navigate through this object because\n * 1) the field may not have a `validations` array,\n * 2) the `validations` array may be empty,\n * 3) the `validations` array may not have a `nodes` validation,\n * 4) the `nodes` validation may not validate the `nodeType`, and\n * 5) the `nodeType` validations may not have a `linkContentType` validation.\n *\n * Note that passing an empty array will result in all possible content types\n * being whitelisted.\n *\n * @param {object} field\n * @param {string} nodeType\n * @returns {string[]}\n */\nexport default function getLinkedContentTypeIdsForNodeType(field, nodeType): string[] {\n  return flow(\n    (v) => find(v, 'nodes'),\n    (v) => get(v, ['nodes', nodeType]),\n    (v) => find(v, 'linkContentType'),\n    (v) => get(v, 'linkContentType', [])\n  )(field.validations);\n}\n","import getLinkedContentTypeIdsForNodeType from './getLinkedContentTypeIdsForNodeType';\n\n/**\n * Returns a config for the entity selector based on a given rich text field and a\n * rich text node type that the entity should be picked for. Takes the field\n * validations for the given node type into account.\n *\n * @param {object} field\n * @param {string} nodeType\n * @returns {object}\n */\nexport default function newEntitySelectorConfigFromRichTextField(field, nodeType) {\n  return {\n    entityType: getEntityTypeFromRichTextNode(nodeType),\n    locale: field.locale || null, // Will fall back to default locale.\n    contentTypes: getLinkedContentTypeIdsForNodeType(field, nodeType),\n  };\n}\n\nfunction getEntityTypeFromRichTextNode(nodeType): 'Entry' | 'Asset' | never {\n  const words = nodeType.split('-');\n  if (words.indexOf('entry') !== -1) {\n    return 'Entry';\n  }\n  if (words.indexOf('asset') !== -1) {\n    return 'Asset';\n  }\n  throw new Error(`RichText node type \\`${nodeType}\\` has no associated \\`entityType\\``);\n}\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { getText } from '@udecode/plate-core';\nimport { Editor, Element, Path, Transforms } from 'slate';\nimport { RichTextEditor } from 'types';\n\nimport { focus, insertEmptyParagraph, moveToTheNextChar } from '../../helpers/editor';\nimport newEntitySelectorConfigFromRichTextField from '../../helpers/newEntitySelectorConfigFromRichTextField';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\n\nexport async function selectEntityAndInsert(\n  nodeType,\n  sdk,\n  editor,\n  logAction: TrackingPluginActions['onToolbarAction'] | TrackingPluginActions['onShortcutAction']\n) {\n  logAction('openCreateEmbedDialog', { nodeType });\n\n  const { field, dialogs } = sdk;\n  const baseConfig = newEntitySelectorConfigFromRichTextField(field, nodeType);\n  const selectEntity =\n    baseConfig.entityType === 'Asset' ? dialogs.selectSingleAsset : dialogs.selectSingleEntry;\n  const config = { ...baseConfig, withCreate: true };\n\n  const { selection } = editor;\n  const entity = await selectEntity(config);\n  if (!entity) {\n    logAction('cancelCreateEmbedDialog', { nodeType });\n    return;\n  }\n\n  Transforms.select(editor, selection);\n  insertBlock(editor, nodeType, entity);\n  ensureFollowingParagraph(editor);\n  logAction('insert', { nodeType });\n}\n\nfunction ensureFollowingParagraph(editor: RichTextEditor) {\n  /* \n     If the new block isn't followed by a sibling paragraph we insert a new empty one\n   */\n  const next = Editor.next(editor);\n  if (!next) {\n    return insertEmptyParagraph(editor);\n  }\n\n  const parent = Editor.above(editor, {\n    voids: false,\n    match: (e) =>\n      !Element.isElement(e) ||\n      ![BLOCKS.EMBEDDED_ASSET, BLOCKS.EMBEDDED_ENTRY].includes(e.type as BLOCKS),\n  });\n\n  if (Editor.isEditor(parent)) {\n    // at level 0, a following paragraph is handled by the tralingParagraph plugin\n    moveToTheNextChar(editor);\n    return;\n  }\n\n  const paragraph = Editor.above(editor, {\n    at: next[1],\n    match: (e) => Element.isElement(e) && TEXT_CONTAINERS.includes(e.type as BLOCKS),\n  });\n\n  if (!paragraph || !parent || !Path.isChild(paragraph[1], parent[1])) {\n    return insertEmptyParagraph(editor);\n  }\n\n  moveToTheNextChar(editor);\n}\nconst createNode = (nodeType, entity) => ({\n  type: nodeType,\n  data: {\n    target: {\n      sys: {\n        id: entity.sys.id,\n        type: 'Link',\n        linkType: entity.sys.type,\n      },\n    },\n  },\n  children: [{ text: '' }],\n  isVoid: true,\n});\n\n// TODO: DRY up copied code from HR\nexport function insertBlock(editor, nodeType, entity) {\n  if (!editor?.selection) return;\n\n  const linkedEntityBlock = createNode(nodeType, entity);\n\n  const hasText = editor.selection && !!getText(editor, editor.selection.focus.path);\n\n  if (hasText) {\n    Transforms.insertNodes(editor, linkedEntityBlock);\n  } else {\n    Transforms.setNodes(editor, linkedEntityBlock);\n  }\n\n  focus(editor);\n}\n","import React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { Flex, Icon, Menu } from '@contentful/f36-components';\nimport { AssetIcon, EmbeddedEntryBlockIcon } from '@contentful/f36-icons';\nimport { css } from 'emotion';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { useSdkContext } from '../../SdkProvider';\nimport { selectEntityAndInsert } from './Util';\n\nexport const styles = {\n  icon: css({\n    marginRight: '10px',\n  }),\n};\n\ninterface EmbeddedEntityBlockToolbarIconProps {\n  isDisabled: boolean;\n  nodeType: string;\n  onClose: () => void;\n}\n\nexport function EmbeddedEntityBlockToolbarIcon({\n  isDisabled,\n  nodeType,\n  onClose,\n}: EmbeddedEntityBlockToolbarIconProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n\n  const handleClick = async (event: React.MouseEvent<HTMLButtonElement>) => {\n    event.preventDefault();\n\n    onClose();\n    await selectEntityAndInsert(nodeType, sdk, editor, editor.tracking.onToolbarAction);\n  };\n\n  const type = getEntityTypeFromNodeType(nodeType);\n  const baseClass = `rich-text__${nodeType}`;\n  return (\n    <Menu.Item\n      disabled={isDisabled}\n      className={`${baseClass}-list-item`}\n      onClick={handleClick}\n      testId={`toolbar-toggle-${nodeType}`}>\n      <Flex alignItems=\"center\" flexDirection=\"row\">\n        <Icon\n          as={type === 'Asset' ? AssetIcon : EmbeddedEntryBlockIcon}\n          className={`rich-text__embedded-entry-list-icon ${styles.icon}`}\n          variant=\"secondary\"\n        />\n        <span>{type}</span>\n      </Flex>\n    </Menu.Item>\n  );\n}\n\nfunction getEntityTypeFromNodeType(nodeType: string): string | never {\n  const words = nodeType.toLowerCase().split('-');\n  if (words.includes('entry')) {\n    return 'Entry';\n  }\n  if (words.includes('asset')) {\n    return 'Asset';\n  }\n  throw new Error(`Node type \\`${nodeType}\\` has no associated \\`entityType\\``);\n}\n","import { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { KeyboardHandler, HotkeyPlugin } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\nimport { Transforms } from 'slate';\n\nimport { getNodeEntryFromSelection } from '../../helpers/editor';\nimport { RichTextPlugin, CustomElement, RichTextEditor } from '../../types';\nimport { withLinkTracking } from '../links-tracking';\nimport { LinkedEntityBlock } from './LinkedEntityBlock';\nimport { selectEntityAndInsert } from './Util';\n\nexport { EmbeddedEntityBlockToolbarIcon as ToolbarIcon } from './ToolbarIcon';\n\nconst entityTypes = {\n  [BLOCKS.EMBEDDED_ENTRY]: 'Entry',\n  [BLOCKS.EMBEDDED_ASSET]: 'Asset',\n};\n\nfunction getWithEmbeddedEntityEvents(\n  nodeType: BLOCKS.EMBEDDED_ENTRY | BLOCKS.EMBEDDED_ASSET,\n  sdk: FieldExtensionSDK\n): KeyboardHandler<RichTextEditor, HotkeyPlugin> {\n  return (editor, { options: { hotkey } }) =>\n    (event) => {\n      const [, pathToSelectedElement] = getNodeEntryFromSelection(editor, nodeType);\n\n      if (pathToSelectedElement) {\n        const isDelete = event.key === 'Delete';\n        const isBackspace = event.key === 'Backspace';\n\n        if (isDelete || isBackspace) {\n          event.preventDefault();\n          Transforms.removeNodes(editor, { at: pathToSelectedElement });\n        }\n\n        return;\n      }\n\n      if (hotkey && isHotkey(hotkey, event)) {\n        selectEntityAndInsert(nodeType, sdk, editor, editor.tracking.onShortcutAction);\n      }\n    };\n}\n\nconst createEmbeddedEntityPlugin =\n  (nodeType: BLOCKS.EMBEDDED_ENTRY | BLOCKS.EMBEDDED_ASSET, hotkey: string) =>\n  (sdk: FieldExtensionSDK): RichTextPlugin => ({\n    key: nodeType,\n    type: nodeType,\n    isElement: true,\n    isVoid: true,\n    component: withLinkTracking(LinkedEntityBlock),\n    options: { hotkey },\n    handlers: {\n      onKeyDown: getWithEmbeddedEntityEvents(nodeType, sdk),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validAttribute: {\n            'data-entity-type': entityTypes[nodeType],\n          },\n        },\n      ],\n      withoutChildren: true,\n      getNode: (el): CustomElement => ({\n        type: nodeType,\n        children: [{ text: '' }],\n        isVoid: true,\n        data: {\n          target: {\n            sys: {\n              id: el.getAttribute('data-entity-id'),\n              linkType: el.getAttribute('data-entity-type'),\n              type: 'Link',\n            },\n          },\n        },\n      }),\n    },\n  });\n\nexport const createEmbeddedEntryBlockPlugin = createEmbeddedEntityPlugin(\n  BLOCKS.EMBEDDED_ENTRY,\n  'mod+shift+e'\n);\nexport const createEmbeddedAssetBlockPlugin = createEmbeddedEntityPlugin(\n  BLOCKS.EMBEDDED_ASSET,\n  'mod+shift+a'\n);\n","import React from 'react';\n\nimport { InlineEntryCard, MenuItem, Text } from '@contentful/f36-components';\nimport { ClockIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { useEntities, ScheduledIconWithTooltip } from '@contentful/field-editor-reference';\nimport { entityHelpers, FieldExtensionSDK } from '@contentful/field-editor-shared';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\n\nconst { getEntryTitle, getEntryStatus } = entityHelpers;\n\nconst styles = {\n  scheduledIcon: css({\n    verticalAlign: 'text-bottom',\n    marginRight: tokens.spacing2Xs,\n  }),\n};\n\ninterface FetchingWrappedInlineEntryCardProps {\n  entryId: string;\n  sdk: FieldExtensionSDK;\n  isSelected: boolean;\n  isDisabled: boolean;\n  onEdit: (event: React.MouseEvent<Element, MouseEvent>) => void;\n  onRemove: (event: React.MouseEvent<Element, MouseEvent>) => void;\n  onEntityFetchComplete?: VoidFunction;\n}\n\nexport function FetchingWrappedInlineEntryCard(props: FetchingWrappedInlineEntryCardProps) {\n  const { getOrLoadEntry, loadEntityScheduledActions, entries } = useEntities();\n  const entry = React.useMemo(() => entries[props.entryId], [entries, props.entryId]);\n\n  const allContentTypes = props.sdk.space.getCachedContentTypes();\n  const { onEntityFetchComplete } = props;\n  const contentType = React.useMemo(() => {\n    if (!entry || entry === 'failed' || !allContentTypes) return undefined;\n\n    return allContentTypes.find(\n      (contentType) => contentType.sys.id === entry.sys.contentType.sys.id\n    );\n  }, [allContentTypes, entry]);\n\n  React.useEffect(() => {\n    if (!entry) {\n      return;\n    }\n    onEntityFetchComplete?.();\n  }, [entry, onEntityFetchComplete]);\n\n  const contentTypeName = contentType ? contentType.name : '';\n\n  const title = React.useMemo(\n    () =>\n      getEntryTitle({\n        entry,\n        contentType,\n        localeCode: props.sdk.field.locale,\n        defaultLocaleCode: props.sdk.locales.default,\n        defaultTitle: 'Untitled',\n      }),\n    [entry, contentType, props.sdk.field.locale, props.sdk.locales.default]\n  );\n\n  React.useEffect(() => {\n    if (!props.entryId) return;\n    getOrLoadEntry(props.entryId);\n    // We don't include getOrLoadEntry below because it's part of the constate-derived\n    // useEntities(), not props.\n    // eslint-disable-next-line\n  }, [props.entryId]);\n\n  if (entry === 'failed') {\n    return (\n      <InlineEntryCard\n        title=\"Entry missing or inaccessible\"\n        testId={INLINES.EMBEDDED_ENTRY}\n        isSelected={props.isSelected}\n      />\n    );\n  }\n\n  if (entry === undefined) {\n    return <InlineEntryCard isLoading />;\n  }\n\n  const status = getEntryStatus(entry.sys);\n  if (status === 'deleted') {\n    return (\n      <InlineEntryCard\n        title=\"Entry missing or inaccessible\"\n        testId={INLINES.EMBEDDED_ENTRY}\n        isSelected={props.isSelected}\n        actions={[\n          <MenuItem key=\"remove\" onClick={props.onRemove} testId=\"delete\">\n            Remove\n          </MenuItem>,\n        ]}\n      />\n    );\n  }\n\n  return (\n    <InlineEntryCard\n      testId={INLINES.EMBEDDED_ENTRY}\n      isSelected={props.isSelected}\n      title={`${contentTypeName}: ${title}`}\n      status={status}\n      actions={[\n        <MenuItem key=\"edit\" onClick={props.onEdit}>\n          Edit\n        </MenuItem>,\n        <MenuItem key=\"remove\" onClick={props.onRemove} disabled={props.isDisabled} testId=\"delete\">\n          Remove\n        </MenuItem>,\n      ]}>\n      <ScheduledIconWithTooltip\n        getEntityScheduledActions={loadEntityScheduledActions}\n        entityType=\"Entry\"\n        entityId={entry.sys.id}>\n        <ClockIcon className={styles.scheduledIcon} variant=\"muted\" testId=\"scheduled-icon\" />\n      </ScheduledIconWithTooltip>\n      <Text>{title}</Text>\n    </InlineEntryCard>\n  );\n}\n","import { INLINES } from '@contentful/rich-text-types';\n\nexport function createInlineEntryNode(id: string) {\n  return {\n    type: INLINES.EMBEDDED_ENTRY,\n    children: [{ text: '' }],\n    data: {\n      target: {\n        sys: {\n          id,\n          type: 'Link',\n          linkType: 'Entry',\n        },\n      },\n    },\n  };\n}\n","import * as React from 'react';\n\nimport { Link, FieldExtensionSDK } from '@contentful/app-sdk';\nimport { Menu, Flex } from '@contentful/f36-components';\nimport { EmbeddedEntryInlineIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { Entry } from '@contentful/field-editor-shared';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { HotkeyPlugin, KeyboardHandler } from '@udecode/plate-core';\nimport { css } from 'emotion';\nimport isHotkey from 'is-hotkey';\nimport { Transforms } from 'slate';\nimport { useSelected, ReactEditor, useReadOnly } from 'slate-react';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { focus, moveToTheNextChar } from '../../helpers/editor';\nimport { IS_CHROME } from '../../helpers/environment';\nimport newEntitySelectorConfigFromRichTextField from '../../helpers/newEntitySelectorConfigFromRichTextField';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\nimport { useSdkContext } from '../../SdkProvider';\nimport {\n  RichTextPlugin,\n  CustomElement,\n  CustomRenderElementProps,\n  RichTextEditor,\n} from '../../types';\nimport { withLinkTracking } from '../links-tracking';\nimport { FetchingWrappedInlineEntryCard } from './FetchingWrappedInlineEntryCard';\nimport { createInlineEntryNode } from './Util';\n\nconst styles = {\n  icon: css({\n    marginRight: '10px',\n  }),\n\n  root: css({\n    display: 'inline-block',\n    margin: `0 ${tokens.spacing2Xs}`,\n    fontSize: 'inherit',\n    span: {\n      userSelect: 'none',\n    },\n  }),\n};\n\ntype EmbeddedEntityInlineProps = CustomRenderElementProps<{\n  target: Link;\n}> & {\n  onEntityFetchComplete: VoidFunction;\n};\n\nfunction EmbeddedEntityInline(props: EmbeddedEntityInlineProps) {\n  const editor = useContentfulEditor();\n  const sdk = useSdkContext();\n  const isSelected = useSelected();\n  const { id: entryId } = props.element.data.target.sys;\n  const isDisabled = useReadOnly();\n\n  function handleEditClick() {\n    return sdk.navigator.openEntry(entryId, { slideIn: true });\n  }\n\n  function handleRemoveClick() {\n    if (!editor) return;\n    const pathToElement = ReactEditor.findPath(editor, props.element);\n    Transforms.removeNodes(editor, { at: pathToElement });\n  }\n\n  return (\n    <span\n      {...props.attributes}\n      className={styles.root}\n      data-embedded-entity-inline-id={entryId}\n      // COMPAT: This makes copy & paste work for Firefox\n      contentEditable={IS_CHROME ? undefined : false}\n      draggable={IS_CHROME ? true : undefined}>\n      <span\n        // COMPAT: This makes copy & paste work for Chromium/Blink browsers and Safari\n        contentEditable={IS_CHROME ? false : undefined}\n        draggable={IS_CHROME ? true : undefined}>\n        <FetchingWrappedInlineEntryCard\n          sdk={sdk}\n          entryId={entryId}\n          isSelected={isSelected}\n          isDisabled={isDisabled}\n          onRemove={handleRemoveClick}\n          onEdit={handleEditClick}\n          onEntityFetchComplete={props.onEntityFetchComplete}\n        />\n      </span>\n      {props.children}\n    </span>\n  );\n}\n\ninterface ToolbarEmbeddedEntityInlineButtonProps {\n  onClose: () => void;\n  isDisabled: boolean;\n}\n\nasync function selectEntityAndInsert(\n  editor,\n  sdk: FieldExtensionSDK,\n  logAction: TrackingPluginActions['onShortcutAction'] | TrackingPluginActions['onToolbarAction']\n) {\n  logAction('openCreateEmbedDialog', { nodeType: INLINES.EMBEDDED_ENTRY });\n\n  const config = {\n    ...newEntitySelectorConfigFromRichTextField(sdk.field, INLINES.EMBEDDED_ENTRY),\n    withCreate: true,\n  };\n  const selection = editor.selection;\n\n  const entry = await sdk.dialogs.selectSingleEntry<Entry>(config);\n  focus(editor); // Dialog steals focus from editor, return it.\n\n  if (!entry) {\n    logAction('cancelCreateEmbedDialog', { nodeType: INLINES.EMBEDDED_ENTRY });\n    return;\n  }\n\n  const inlineEntryNode = createInlineEntryNode(entry.sys.id);\n\n  logAction('insert', { nodeType: INLINES.EMBEDDED_ENTRY });\n  // Got to wait until focus is really back on the editor or setSelection() won't work.\n  return new Promise<void>((resolve) => {\n    setTimeout(() => {\n      Transforms.setSelection(editor, selection);\n      Transforms.insertNodes(editor, inlineEntryNode);\n      resolve();\n    }, 0);\n  });\n}\n\nexport function ToolbarEmbeddedEntityInlineButton(props: ToolbarEmbeddedEntityInlineButtonProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n\n  async function handleClick(event) {\n    event.preventDefault();\n\n    if (!editor) return;\n\n    props.onClose();\n\n    await selectEntityAndInsert(editor, sdk, editor.tracking.onToolbarAction);\n    moveToTheNextChar(editor);\n  }\n\n  return (\n    <Menu.Item\n      disabled={props.isDisabled}\n      className=\"rich-text__entry-link-block-button\"\n      testId={`toolbar-toggle-${INLINES.EMBEDDED_ENTRY}`}\n      onClick={handleClick}>\n      <Flex alignItems=\"center\" flexDirection=\"row\">\n        <EmbeddedEntryInlineIcon\n          variant=\"secondary\"\n          className={`rich-text__embedded-entry-list-icon ${styles.icon}`}\n        />\n        <span>Inline entry</span>\n      </Flex>\n    </Menu.Item>\n  );\n}\n\nexport function createEmbeddedEntityInlinePlugin(sdk: FieldExtensionSDK): RichTextPlugin {\n  const htmlAttributeName = 'data-embedded-entity-inline-id';\n\n  return {\n    key: INLINES.EMBEDDED_ENTRY,\n    type: INLINES.EMBEDDED_ENTRY,\n    isElement: true,\n    isInline: true,\n    isVoid: true,\n    component: withLinkTracking(EmbeddedEntityInline),\n    options: {\n      hotkey: 'mod+shift+2',\n    },\n    handlers: {\n      onKeyDown: getWithEmbeddedEntryInlineEvents(sdk),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validAttribute: htmlAttributeName,\n        },\n      ],\n      withoutChildren: true,\n      getNode: (el): CustomElement =>\n        createInlineEntryNode(el.getAttribute(htmlAttributeName) as string),\n    },\n  };\n}\n\nfunction getWithEmbeddedEntryInlineEvents(\n  sdk: FieldExtensionSDK\n): KeyboardHandler<RichTextEditor, HotkeyPlugin> {\n  return function withEmbeddedEntryInlineEvents(editor, { options: { hotkey } }) {\n    return function handleEvent(event) {\n      if (!editor) return;\n\n      if (hotkey && isHotkey(hotkey, event)) {\n        selectEntityAndInsert(editor, sdk, editor.tracking.onShortcutAction);\n      }\n    };\n  };\n}\n","/* eslint-disable you-dont-need-lodash-underscore/find */\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { BLOCKS, INLINES, TOP_LEVEL_BLOCKS } from '@contentful/rich-text-types';\nimport find from 'lodash/find';\nimport flow from 'lodash/flow';\nimport get from 'lodash/get';\n\n// TODO: Move these into separate package (maybe rich-text-types) and share with FE.\nexport const VALIDATIONS = {\n  ENABLED_MARKS: 'enabledMarks',\n  ENABLED_NODE_TYPES: 'enabledNodeTypes',\n};\nexport const DEFAULT_ENABLED_NODE_TYPES = [BLOCKS.DOCUMENT, BLOCKS.PARAGRAPH, 'text'];\n\nexport const VALIDATABLE_NODE_TYPES = ([] as Array<BLOCKS | INLINES>)\n  .concat(TOP_LEVEL_BLOCKS)\n  .filter((type) => type !== BLOCKS.PARAGRAPH)\n  .concat(Object.values(INLINES));\n\n// TODO: Memoize\nconst getRichTextValidation = (field, validationType) =>\n  flow(\n    (v) => find(v, validationType),\n    (v) => get(v, validationType)\n  )(field.validations);\n\nconst isFormattingOptionEnabled = (field, validationType, nodeTypeOrMark) => {\n  const enabledFormattings = getRichTextValidation(field, validationType);\n\n  // TODO: In the future, validations will always be opt-in. In that case\n  // we don't need this step.\n  if (enabledFormattings === undefined) {\n    return true;\n  }\n\n  return DEFAULT_ENABLED_NODE_TYPES.concat(enabledFormattings).includes(nodeTypeOrMark);\n};\n\nexport const isNodeTypeEnabled = (field: FieldExtensionSDK['field'], nodeType): boolean =>\n  isFormattingOptionEnabled(field, VALIDATIONS.ENABLED_NODE_TYPES, nodeType);\n\nexport const isMarkEnabled = (field: FieldExtensionSDK['field'], mark) =>\n  isFormattingOptionEnabled(field, VALIDATIONS.ENABLED_MARKS, mark);\n","import * as React from 'react';\n\nimport { Menu, Button } from '@contentful/f36-components';\nimport { ChevronDownIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport {\n  getElementFromCurrentSelection,\n  focus,\n  isBlockSelected,\n  toggleElement,\n} from '../../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../../helpers/validations';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { CustomElement } from '../../../types';\n\nconst styles = {\n  dropdown: {\n    root: css`\n      font-weight: ${tokens.fontWeightDemiBold};\n    `,\n    [BLOCKS.PARAGRAPH]: css`\n      font-size: ${tokens.fontSizeL};\n    `,\n    [BLOCKS.HEADING_1]: css`\n      font-size: 1.625rem;\n    `,\n    [BLOCKS.HEADING_2]: css`\n      font-size: 1.4375rem;\n    `,\n    [BLOCKS.HEADING_3]: css`\n      font-size: 1.25rem;\n    `,\n    [BLOCKS.HEADING_4]: css`\n      font-size: 1.125rem;\n    `,\n    [BLOCKS.HEADING_5]: css`\n      font-size: 1rem;\n    `,\n    [BLOCKS.HEADING_6]: css`\n      font-size: 0.875rem;\n    `,\n  },\n};\n\nconst LABELS = {\n  [BLOCKS.PARAGRAPH]: 'Normal text',\n  [BLOCKS.HEADING_1]: 'Heading 1',\n  [BLOCKS.HEADING_2]: 'Heading 2',\n  [BLOCKS.HEADING_3]: 'Heading 3',\n  [BLOCKS.HEADING_4]: 'Heading 4',\n  [BLOCKS.HEADING_5]: 'Heading 5',\n  [BLOCKS.HEADING_6]: 'Heading 6',\n};\n\nexport interface ToolbarHeadingButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function ToolbarHeadingButton(props: ToolbarHeadingButtonProps) {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n  const [isOpen, setOpen] = React.useState(false);\n  const [selected, setSelected] = React.useState<string>(BLOCKS.PARAGRAPH);\n\n  React.useEffect(() => {\n    if (!editor?.selection) return;\n\n    const [element] = getElementFromCurrentSelection(editor);\n    const type = (element as CustomElement).type;\n\n    setSelected(LABELS[type] ? type : BLOCKS.PARAGRAPH);\n  }, [editor?.operations, editor?.selection]); // eslint-disable-line\n\n  const [nodeTypesByEnablement, someHeadingsEnabled] = React.useMemo(() => {\n    const nodeTypesByEnablement = Object.fromEntries(\n      Object.keys(LABELS).map((nodeType) => [nodeType, isNodeTypeEnabled(sdk.field, nodeType)])\n    );\n    const someHeadingsEnabled = Object.values(nodeTypesByEnablement).filter(Boolean).length > 0;\n    return [nodeTypesByEnablement, someHeadingsEnabled];\n  }, [sdk.field]);\n\n  function handleOnSelectItem(type: BLOCKS): (event: React.MouseEvent<HTMLButtonElement>) => void {\n    return (event: React.MouseEvent<HTMLButtonElement>) => {\n      event.preventDefault();\n\n      if (!editor?.selection) return;\n\n      setSelected(type);\n      setOpen(false);\n\n      const prevOnChange = editor.onChange;\n      /*\n       The focus might happen at point in time when\n       `toggleElement` (helper for toggleNodeType) changes aren't rendered yet, causing the browser\n       to place the cursor at the start of the text.\n       We wait for the change event before focusing\n       the editor again. This ensures the cursor is back at the previous\n       position.*/\n      editor.onChange = (...args) => {\n        focus(editor);\n        editor.onChange = prevOnChange;\n        prevOnChange(...args);\n      };\n\n      const isActive = isBlockSelected(editor, type);\n      editor.tracking.onToolbarAction(isActive ? 'remove' : 'insert', { nodeType: type });\n\n      toggleElement(editor, { activeType: type, inactiveType: type });\n    };\n  }\n\n  if (!editor) return null;\n\n  return (\n    <Menu isOpen={isOpen} onClose={() => setOpen(false)}>\n      <Menu.Trigger>\n        <Button\n          size=\"small\"\n          testId=\"toolbar-heading-toggle\"\n          variant=\"transparent\"\n          endIcon={<ChevronDownIcon />}\n          isDisabled={props.isDisabled}\n          onClick={() => someHeadingsEnabled && setOpen(!isOpen)}>\n          {LABELS[selected]}\n        </Button>\n      </Menu.Trigger>\n      <Menu.List testId=\"dropdown-heading-list\">\n        {' '}\n        {Object.keys(LABELS)\n          .map(\n            (nodeType) =>\n              nodeTypesByEnablement[nodeType] && (\n                <Menu.Item\n                  key={nodeType}\n                  isInitiallyFocused={selected === nodeType}\n                  onClick={handleOnSelectItem(nodeType as BLOCKS)}\n                  testId={`dropdown-option-${nodeType}`}\n                  disabled={props.isDisabled}>\n                  <span className={cx(styles.dropdown.root, styles.dropdown[nodeType])}>\n                    {LABELS[nodeType]}\n                  </span>\n                </Menu.Item>\n              )\n          )\n          .filter(Boolean)}\n      </Menu.List>\n    </Menu>\n  );\n}\n","import { BLOCKS, INLINES } from '@contentful/rich-text-types';\nimport { NodeEntry, Transforms } from 'slate';\n\nimport { RichTextEditor } from '../types';\nimport { extractParagraphs } from './extractNodes';\n\nexport const transformRemove = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  Transforms.removeNodes(editor, { at: path });\n};\n\nexport const transformParagraphs = (editor: RichTextEditor, entry: NodeEntry) => {\n  const path = entry[1];\n  const nodes = extractParagraphs(editor, path);\n\n  transformRemove(editor, entry);\n  Transforms.insertNodes(editor, nodes, { at: path });\n};\n\nexport const transformUnwrap = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  Transforms.unwrapNodes(editor, {\n    at: path,\n  });\n};\n\nexport const transformWrapIn =\n  (type: BLOCKS | INLINES) =>\n  (editor: RichTextEditor, [, path]: NodeEntry) => {\n    Transforms.wrapNodes(editor, { type, data: {}, children: [] }, { at: path });\n  };\n\nexport const transformLift = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  Transforms.liftNodes(editor, { at: path });\n};\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { NodeMatch, getNodes } from '@udecode/plate-core';\nimport { Path } from 'slate';\n\nimport { CustomElement, RichTextEditor } from '../types';\n\nfunction extractNodes(editor: RichTextEditor, path: Path, match: NodeMatch) {\n  return Array.from(\n    getNodes(editor, {\n      match,\n      at: path,\n      mode: 'lowest',\n    })\n  ).map(([node]) => node as CustomElement);\n}\n\n/**\n * It filters out all paragraphs and headings from a path and convert them into paragraphs.\n */\nexport function extractParagraphs(editor: RichTextEditor, path: Path): CustomElement[] {\n  return extractNodes(editor, path, {\n    type: TEXT_CONTAINERS,\n  }).map((node) => ({\n    ...node,\n    type: BLOCKS.PARAGRAPH,\n  }));\n}\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst styles = {\n  dropdown: {\n    root: css`\n      font-weight: ${tokens.fontWeightDemiBold};\n    `,\n    [BLOCKS.PARAGRAPH]: css`\n      font-size: ${tokens.fontSizeL};\n    `,\n    [BLOCKS.HEADING_1]: css`\n      font-size: 1.625rem;\n    `,\n    [BLOCKS.HEADING_2]: css`\n      font-size: 1.4375rem;\n    `,\n    [BLOCKS.HEADING_3]: css`\n      font-size: 1.25rem;\n    `,\n    [BLOCKS.HEADING_4]: css`\n      font-size: 1.125rem;\n    `,\n    [BLOCKS.HEADING_5]: css`\n      font-size: 1rem;\n    `,\n    [BLOCKS.HEADING_6]: css`\n      font-size: 0.875rem;\n    `,\n  },\n  headings: {\n    root: css`\n      font-weight: ${tokens.fontWeightMedium};\n      line-height: 1.3;\n      margin: 0 0 ${tokens.spacingS};\n    `,\n    [BLOCKS.HEADING_1]: css`\n      font-size: 1.875rem;\n    `,\n    [BLOCKS.HEADING_2]: css`\n      font-size: 1.5625rem;\n    `,\n    [BLOCKS.HEADING_3]: css`\n      font-size: 1.375rem;\n    `,\n    [BLOCKS.HEADING_4]: css`\n      font-size: 1.25rem;\n    `,\n    [BLOCKS.HEADING_5]: css`\n      font-size: 1.125rem;\n    `,\n    [BLOCKS.HEADING_6]: css`\n      font-size: 1rem;\n    `,\n  },\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction createHeading(Tag: any, block: BLOCKS) {\n  return function Heading(props: Slate.RenderElementProps) {\n    return (\n      <Tag {...props.attributes} className={cx(styles.headings.root, styles.headings[block])}>\n        {props.children}\n      </Tag>\n    );\n  };\n}\n\nexport const HeadingComponents = {\n  [BLOCKS.HEADING_1]: React.memo(createHeading('h1', BLOCKS.HEADING_1)),\n  [BLOCKS.HEADING_2]: React.memo(createHeading('h2', BLOCKS.HEADING_2)),\n  [BLOCKS.HEADING_3]: React.memo(createHeading('h3', BLOCKS.HEADING_3)),\n  [BLOCKS.HEADING_4]: React.memo(createHeading('h4', BLOCKS.HEADING_4)),\n  [BLOCKS.HEADING_5]: React.memo(createHeading('h5', BLOCKS.HEADING_5)),\n  [BLOCKS.HEADING_6]: React.memo(createHeading('h6', BLOCKS.HEADING_6)),\n};\n","import { BLOCKS, HEADINGS } from '@contentful/rich-text-types';\nimport { getAbove, HotkeyPlugin, KeyboardHandler } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\n\nimport { isBlockSelected, isInlineOrText, toggleElement } from '../../helpers/editor';\nimport { transformLift, transformUnwrap } from '../../helpers/transformers';\nimport { RichTextEditor, RichTextPlugin } from '../../types';\nimport { HeadingComponents } from './components/Heading';\n\nconst buildHeadingEventHandler =\n  (type: BLOCKS): KeyboardHandler<RichTextEditor, HotkeyPlugin> =>\n  (editor, { options: { hotkey } }) =>\n  (event) => {\n    if (editor.selection && hotkey && isHotkey(hotkey, event)) {\n      const isActive = isBlockSelected(editor, type);\n      editor.tracking.onShortcutAction(isActive ? 'remove' : 'insert', { nodeType: type });\n\n      toggleElement(editor, { activeType: type, inactiveType: BLOCKS.PARAGRAPH });\n    }\n  };\n\nexport const createHeadingPlugin = (): RichTextPlugin => ({\n  key: 'HeadingPlugin',\n  softBreak: [\n    // create a new line with SHIFT+Enter inside a heading\n    {\n      hotkey: 'shift+enter',\n      query: {\n        allow: HEADINGS,\n      },\n    },\n  ],\n  normalizer: [\n    {\n      match: {\n        type: HEADINGS,\n      },\n      validChildren: (_, [node]) => isInlineOrText(node),\n      transform: {\n        [BLOCKS.PARAGRAPH]: transformUnwrap,\n        default: transformLift,\n      },\n    },\n  ],\n  then: (editor) => {\n    return {\n      exitBreak: [\n        // Pressing ENTER at the start or end of a heading text inserts a\n        // normal paragraph.\n        {\n          hotkey: 'enter',\n          query: {\n            allow: HEADINGS,\n            end: true,\n            start: true,\n\n            // Exclude headings inside lists as it interferes with the list's\n            // insertBreak implementation\n            filter: ([, path]) =>\n              !getAbove(editor, {\n                at: path,\n                match: { type: BLOCKS.LIST_ITEM },\n              }),\n          },\n        },\n      ],\n    } as Partial<RichTextPlugin>;\n  },\n  plugins: HEADINGS.map((nodeType, idx) => {\n    const level = idx + 1;\n    const tagName = `h${level}`;\n\n    return {\n      key: nodeType,\n      type: nodeType,\n      isElement: true,\n      component: HeadingComponents[nodeType],\n      options: {\n        hotkey: [`mod+alt+${level}`],\n      },\n      handlers: {\n        onKeyDown: buildHeadingEventHandler(nodeType),\n      },\n      deserializeHtml: {\n        rules: [\n          {\n            validNodeName: tagName.toUpperCase(),\n          },\n        ],\n      },\n    };\n  }),\n});\n","import React from 'react';\n\nimport { Button, Tooltip } from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { css, cx } from 'emotion';\n\nconst styles = {\n  button: css({\n    height: '30px',\n    width: '30px',\n    marginLeft: tokens.spacing2Xs,\n    marginRight: tokens.spacing2Xs,\n  }),\n\n  tooltip: css({\n    zIndex: Number(tokens.zIndexTooltip),\n  }),\n};\n\ninterface ToolbarButtonProps {\n  onClick: () => void;\n  isActive?: boolean;\n  isDisabled?: boolean;\n  children: any;\n  title: string;\n  className?: string;\n  testId?: string;\n}\n\nexport function ToolbarButton(props: ToolbarButtonProps) {\n  const { title, testId, isActive, children, className, isDisabled = false } = props;\n  const handleClick = (event) => {\n    event.preventDefault();\n    props.onClick();\n  };\n\n  const button = (\n    <Button\n      className={cx(styles.button, className)}\n      isDisabled={isDisabled}\n      startIcon={children}\n      onClick={handleClick}\n      testId={testId}\n      variant={isActive ? 'secondary' : 'transparent'}\n      size=\"small\"\n    />\n  );\n\n  if (title) {\n    return (\n      <Tooltip className={styles.tooltip} placement=\"bottom\" content={title}>\n        {button}\n      </Tooltip>\n    );\n  }\n\n  return button;\n}\n","import * as React from 'react';\n\nimport { HorizontalRuleIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { getText, setNodes } from '@udecode/plate-core';\nimport { css, cx } from 'emotion';\nimport { Transforms } from 'slate';\nimport * as Slate from 'slate-react';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport {\n  getNodeEntryFromSelection,\n  isBlockSelected,\n  moveToTheNextLine,\n  focus,\n} from '../../helpers/editor';\nimport { RichTextEditor, RichTextPlugin } from '../../types';\nimport { ToolbarButton } from '../shared/ToolbarButton';\n\nconst styles = {\n  container: css`\n    margin: 0 0 ${tokens.spacingL};\n  `,\n  hr: css`\n    margin: 0;\n    height: ${tokens.spacingM};\n    background: transparent;\n    position: relative;\n    border: 0;\n    user-select: none;\n    &:hover {\n      cursor: pointer;\n    }\n    &::after {\n      content: '';\n      position: absolute;\n      width: 100%;\n      height: 1px;\n      background: ${tokens.gray300};\n      top: 50%;\n    }\n  `,\n  hrSelected: css`\n    &::after {\n      background: ${tokens.colorPrimary};\n      -webkit-box-shadow: 0px 0px 5px ${tokens.colorPrimary};\n      box-shadow: 0px 0px 5px ${tokens.colorPrimary};\n    }\n  `,\n};\n\ninterface ToolbarHrButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function withHrEvents(editor: RichTextEditor) {\n  return (event: React.KeyboardEvent) => {\n    if (!editor) return;\n\n    const [, pathToSelectedHr] = getNodeEntryFromSelection(editor, BLOCKS.HR);\n    if (pathToSelectedHr) {\n      const isBackspace = event.key === 'Backspace';\n      const isDelete = event.key === 'Delete';\n      if (isBackspace || isDelete) {\n        event.preventDefault();\n        Transforms.removeNodes(editor, { at: pathToSelectedHr });\n      }\n    }\n  };\n}\n\nexport function ToolbarHrButton(props: ToolbarHrButtonProps) {\n  const editor = useContentfulEditor();\n\n  function handleOnClick() {\n    if (!editor?.selection) return;\n\n    const hr = {\n      type: BLOCKS.HR,\n      data: {},\n      children: [{ text: '' }],\n      isVoid: true,\n    };\n\n    const hasText = !!getText(editor, editor.selection.focus.path);\n    hasText ? Transforms.insertNodes(editor, hr) : setNodes(editor, hr);\n\n    // Move focus to the next paragraph (added by TrailingParagraph plugin)\n    moveToTheNextLine(editor);\n\n    focus(editor);\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"HR\"\n      isDisabled={props.isDisabled}\n      onClick={handleOnClick}\n      testId=\"hr-toolbar-button\"\n      isActive={isBlockSelected(editor, BLOCKS.HR)}>\n      <HorizontalRuleIcon />\n    </ToolbarButton>\n  );\n}\n\nexport function Hr(props: Slate.RenderLeafProps) {\n  const isSelected = Slate.useSelected();\n  const isFocused = Slate.useFocused();\n\n  return (\n    <div\n      {...props.attributes}\n      className={styles.container}\n      // COMPAT: To make HR copyable in Safari, we verify this attribute below on `deserialize`\n      data-void-element={BLOCKS.HR}>\n      <div\n        draggable={true}\n        // Moving `contentEditable` to this div makes it to be selectable when being the first void element, e.g pressing ctrl + a to select everything\n        contentEditable={false}>\n        <hr className={cx(styles.hr, isSelected && isFocused ? styles.hrSelected : undefined)} />\n      </div>\n      {props.children}\n    </div>\n  );\n}\n\nexport const createHrPlugin = (): RichTextPlugin => ({\n  key: BLOCKS.HR,\n  type: BLOCKS.HR,\n  isVoid: true,\n  isElement: true,\n  component: Hr,\n  handlers: {\n    onKeyDown: withHrEvents,\n  },\n  deserializeHtml: {\n    rules: [\n      {\n        validNodeName: ['HR'],\n      },\n      {\n        validAttribute: {\n          'data-void-element': BLOCKS.HR,\n        },\n      },\n    ],\n    withoutChildren: true,\n  },\n});\n","import * as React from 'react';\n\nimport {\n  TextLink,\n  Button,\n  FormControl,\n  FormLabel,\n  Select,\n  TextInput,\n  Form,\n  ModalContent,\n  ModalControls,\n} from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { EntityProvider } from '@contentful/field-editor-reference';\nimport { Link } from '@contentful/field-editor-reference/dist/types';\nimport { ModalDialogLauncher, FieldExtensionSDK } from '@contentful/field-editor-shared';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport { Editor, Transforms, Path } from 'slate';\nimport { ReactEditor } from 'slate-react';\n\nimport { getNodeEntryFromSelection, insertLink, LINK_TYPES, focus } from '../../helpers/editor';\nimport getLinkedContentTypeIdsForNodeType from '../../helpers/getLinkedContentTypeIdsForNodeType';\nimport { isNodeTypeEnabled } from '../../helpers/validations';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\nimport { RichTextEditor } from '../../types';\nimport { FetchingWrappedAssetCard } from '../shared/FetchingWrappedAssetCard';\nimport { FetchingWrappedEntryCard } from '../shared/FetchingWrappedEntryCard';\n\nconst styles = {\n  removeSelectionLabel: css`\n    margin-left: ${tokens.spacingS};\n  `,\n};\n\ninterface HyperlinkModalProps {\n  linkText?: string;\n  linkType?: string;\n  linkTarget?: string;\n  linkEntity?: Link;\n  onClose: (value: unknown) => void;\n  sdk: FieldExtensionSDK;\n  readonly: boolean;\n}\n\nconst SYS_LINK_TYPES = {\n  [INLINES.ENTRY_HYPERLINK]: 'Entry',\n  [INLINES.ASSET_HYPERLINK]: 'Asset',\n};\n\nconst LINK_TYPE_SELECTION_VALUES = {\n  [INLINES.HYPERLINK]: 'URL',\n  [INLINES.ENTRY_HYPERLINK]: 'Entry',\n  [INLINES.ASSET_HYPERLINK]: 'Asset',\n};\n\nexport function HyperlinkModal(props: HyperlinkModalProps) {\n  const enabledLinkTypes = LINK_TYPES.filter((nodeType) =>\n    isNodeTypeEnabled(props.sdk.field, nodeType)\n  );\n  const [defaultLinkType] = enabledLinkTypes;\n  const [linkText, setLinkText] = React.useState(props.linkText ?? '');\n  const [linkType, setLinkType] = React.useState(props.linkType ?? defaultLinkType);\n  const [linkTarget, setLinkTarget] = React.useState(props.linkTarget ?? '');\n  const [linkEntity, setLinkEntity] = React.useState<Link | null>(props.linkEntity ?? null);\n\n  function isLinkComplete() {\n    const isRegularLink = linkType === INLINES.HYPERLINK;\n    if (isRegularLink) {\n      return !!(linkText && linkTarget);\n    }\n\n    const entityLinks: string[] = Object.keys(SYS_LINK_TYPES);\n    const isEntityLink = entityLinks.includes(linkType);\n    if (isEntityLink) {\n      return !!(linkText && linkEntity);\n    }\n\n    return false;\n  }\n\n  function handleOnSubmit(event: React.MouseEvent<HTMLButtonElement>) {\n    event.preventDefault();\n\n    props.onClose({ linkText, linkType, linkTarget, linkEntity });\n  }\n\n  function entityToLink(entity): Link {\n    const { id, type } = entity.sys;\n\n    return { sys: { id, type: 'Link', linkType: type } };\n  }\n\n  async function selectEntry() {\n    const options = {\n      locale: props.sdk.field.locale,\n      contentTypes: getLinkedContentTypeIdsForNodeType(props.sdk.field, INLINES.ENTRY_HYPERLINK),\n    };\n    const entry = await props.sdk.dialogs.selectSingleEntry(options);\n    setLinkTarget('');\n    setLinkEntity(entityToLink(entry));\n  }\n\n  async function selectAsset() {\n    const options = {\n      locale: props.sdk.field.locale,\n    };\n    const asset = await props.sdk.dialogs.selectSingleAsset(options);\n    setLinkTarget('');\n    setLinkEntity(entityToLink(asset));\n  }\n\n  function resetLinkEntity(event: React.MouseEvent) {\n    event.preventDefault();\n\n    setLinkEntity(null);\n  }\n\n  return (\n    <EntityProvider sdk={props.sdk}>\n      <React.Fragment>\n        <ModalContent>\n          <Form>\n            {!props.linkType && (\n              <FormControl id=\"link-text\" isRequired>\n                <FormControl.Label>Link text</FormControl.Label>\n                <TextInput\n                  testId=\"link-text-input\"\n                  name=\"link-text\"\n                  value={linkText}\n                  onChange={(event) => setLinkText(event.target.value)}\n                />\n              </FormControl>\n            )}\n\n            {enabledLinkTypes.length > 1 && (\n              <FormControl id=\"link-type\">\n                <FormControl.Label>Link type</FormControl.Label>\n                <Select\n                  value={linkType}\n                  onChange={(event: React.ChangeEvent<HTMLSelectElement>) =>\n                    setLinkType(event.target.value)\n                  }\n                  testId=\"link-type-input\"\n                  isDisabled={props.readonly}>\n                  {enabledLinkTypes.map((nodeType) => (\n                    <Select.Option key={nodeType} value={nodeType}>\n                      {LINK_TYPE_SELECTION_VALUES[nodeType]}\n                    </Select.Option>\n                  ))}\n                </Select>\n              </FormControl>\n            )}\n\n            {linkType === INLINES.HYPERLINK && (\n              <FormControl id=\"linkTarget\" isRequired>\n                <FormControl.Label>Link target</FormControl.Label>\n                <TextInput\n                  name=\"linkTarget\"\n                  value={linkTarget}\n                  onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n                    setLinkEntity(null);\n                    setLinkTarget(event.target.value);\n                  }}\n                  testId=\"link-target-input\"\n                  isDisabled={props.readonly}\n                />\n                <FormControl.HelpText>\n                  A protocol may be required, e.g. https://\n                </FormControl.HelpText>\n              </FormControl>\n            )}\n\n            {linkType !== INLINES.HYPERLINK && (\n              <div>\n                <FormLabel isRequired htmlFor=\"\">\n                  Link target{' '}\n                </FormLabel>\n\n                {linkEntity && linkEntity.sys.linkType === SYS_LINK_TYPES[linkType] ? (\n                  <>\n                    {!props.readonly && (\n                      <TextLink\n                        testId=\"entity-selection-link\"\n                        onClick={resetLinkEntity}\n                        className={styles.removeSelectionLabel}>\n                        Remove selection\n                      </TextLink>\n                    )}\n                    <div>\n                      {linkType === INLINES.ENTRY_HYPERLINK && (\n                        <FetchingWrappedEntryCard\n                          sdk={props.sdk}\n                          locale={props.sdk.field.locale}\n                          entryId={linkEntity.sys.id}\n                          isDisabled={true}\n                          isSelected={false}\n                        />\n                      )}\n                      {linkType === INLINES.ASSET_HYPERLINK && (\n                        <FetchingWrappedAssetCard\n                          sdk={props.sdk}\n                          locale={props.sdk.field.locale}\n                          assetId={linkEntity.sys.id}\n                          isDisabled={true}\n                          isSelected={false}\n                        />\n                      )}\n                    </div>\n                  </>\n                ) : (\n                  <div>\n                    {linkType === INLINES.ENTRY_HYPERLINK && (\n                      <TextLink testId=\"entity-selection-link\" onClick={selectEntry}>\n                        Select entry\n                      </TextLink>\n                    )}\n                    {linkType === INLINES.ASSET_HYPERLINK && (\n                      <TextLink testId=\"entity-selection-link\" onClick={selectAsset}>\n                        Select asset\n                      </TextLink>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n          </Form>\n        </ModalContent>\n        <ModalControls>\n          <Button\n            type=\"button\"\n            onClick={() => props.onClose(null)}\n            variant=\"secondary\"\n            testId=\"cancel-cta\"\n            size=\"small\">\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"positive\"\n            size=\"small\"\n            isDisabled={props.readonly || !isLinkComplete()}\n            onClick={handleOnSubmit}\n            testId=\"confirm-cta\">\n            {props.linkType ? 'Update' : 'Insert'}\n          </Button>\n        </ModalControls>\n      </React.Fragment>\n    </EntityProvider>\n  );\n}\n\ninterface HyperLinkDialogData {\n  linkText: string;\n  linkType: INLINES.HYPERLINK | INLINES.ASSET_HYPERLINK | INLINES.ENTRY_HYPERLINK;\n  linkTarget?: string;\n  linkEntity?: Link;\n}\n\nexport async function addOrEditLink(\n  editor: RichTextEditor,\n  sdk: FieldExtensionSDK,\n  logAction:\n    | TrackingPluginActions['onToolbarAction']\n    | TrackingPluginActions['onShortcutAction']\n    | TrackingPluginActions['onViewportAction'],\n  targetPath?: Path\n) {\n  const isReadOnly = ReactEditor.isReadOnly(editor);\n  const selectionBeforeBlur = editor.selection ? { ...editor.selection } : undefined;\n  if (!targetPath && !selectionBeforeBlur) return;\n\n  let linkType;\n  let linkText;\n  let linkTarget;\n  let linkEntity;\n  const [node, path] = getNodeEntryFromSelection(editor, LINK_TYPES, targetPath);\n  if (node && path) {\n    linkType = node.type;\n    linkText = Editor.string(editor, path);\n    linkTarget = (node.data as { uri: string }).uri || '';\n    linkEntity = (node.data as { target: Link }).target;\n  }\n\n  const selectionAfterFocus =\n    targetPath ?? (selectionBeforeBlur as NonNullable<typeof selectionBeforeBlur>);\n\n  const currentLinkText =\n    linkText || (editor.selection ? Editor.string(editor, editor.selection) : '');\n  const isEditing = Boolean(node && path);\n\n  logAction(isEditing ? 'openEditHyperlinkDialog' : 'openCreateHyperlinkDialog');\n\n  const data = await ModalDialogLauncher.openDialog(\n    {\n      title: isEditing ? 'Edit hyperlink' : 'Insert hyperlink',\n      width: 'large',\n      shouldCloseOnEscapePress: true,\n      shouldCloseOnOverlayClick: true,\n      allowHeightOverflow: true,\n    },\n    ({ onClose }) => {\n      return (\n        <HyperlinkModal\n          linkTarget={linkTarget}\n          linkText={currentLinkText}\n          linkType={linkType}\n          linkEntity={linkEntity}\n          onClose={onClose}\n          sdk={sdk}\n          readonly={isReadOnly}\n        />\n      );\n    }\n  );\n  Transforms.select(editor, selectionAfterFocus);\n\n  if (!data) {\n    focus(editor);\n    logAction(isEditing ? 'cancelEditHyperlinkDialog' : 'cancelCreateHyperlinkDialog');\n    return;\n  }\n\n  const {\n    linkText: text,\n    linkTarget: url,\n    linkType: type,\n    linkEntity: target,\n  } = data as HyperLinkDialogData;\n\n  Editor.withoutNormalizing(editor, () => {\n    insertLink(editor, { text, url, type, target, path });\n  });\n\n  logAction(isEditing ? 'edit' : 'insert', {\n    nodeType: type,\n    linkType: target?.sys.linkType ?? 'uri', // we want to keep the same values we've been using for the old editor, which can be `uri`, `Asset` or `Entry`\n  });\n\n  focus(editor);\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { LinkIcon } from '@contentful/f36-icons';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { isLinkActive, unwrapLink } from '../../../helpers/editor';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { addOrEditLink } from '../HyperlinkModal';\n\ninterface ToolbarHyperlinkButtonProps {\n  isDisabled: boolean | undefined;\n}\n\nexport function ToolbarHyperlinkButton(props: ToolbarHyperlinkButtonProps) {\n  const editor = useContentfulEditor();\n  const isActive = !!(editor && isLinkActive(editor));\n  const sdk: FieldExtensionSDK = useSdkContext();\n\n  async function handleClick() {\n    if (!editor) return;\n\n    if (isActive) {\n      unwrapLink(editor);\n      editor.tracking.onToolbarAction('unlinkHyperlinks');\n    } else {\n      addOrEditLink(editor, sdk, editor.tracking.onToolbarAction);\n    }\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"Hyperlink\"\n      testId=\"hyperlink-toolbar-button\"\n      onClick={handleClick}\n      isActive={isActive}\n      isDisabled={props.isDisabled}>\n      <LinkIcon />\n    </ToolbarButton>\n  );\n}\n","import { getScheduleTooltipContent } from '@contentful/field-editor-reference';\nimport { isAncestorEmpty } from '@udecode/plate-core';\nimport { NodeEntry, Ancestor, Node } from 'slate';\n\nimport { RichTextEditor } from '../../types';\nimport { FetchedEntityData } from './useEntityInfo';\n\nexport const hasText = (editor: RichTextEditor, entry: NodeEntry) => {\n  const [node] = entry;\n  return !isAncestorEmpty(editor, node as Ancestor) && Node.string(node).trim() !== '';\n};\n\nfunction truncate(str: string, length: number) {\n  if (typeof str === 'string' && str.length > length) {\n    return (\n      str &&\n      str\n        .substr(0, length + 1) // +1 to look ahead and be replaced below.\n        // Get rid of orphan letters but not one letter words (I, a, 2).\n        // Try to not have “.” as last character to avoid awkward “....”.\n        .replace(/(\\s+\\S(?=\\S)|\\s*)\\.?.$/, '…')\n    );\n  }\n\n  return str;\n}\n\nexport function getEntityInfo(data?: FetchedEntityData) {\n  if (!data) {\n    return '';\n  }\n  const { entityTitle, contentTypeName, entityStatus, jobs } = data;\n\n  const title = truncate(entityTitle, 60) || 'Untitled';\n\n  const scheduledActions =\n    jobs.length > 0 ? getScheduleTooltipContent({ job: jobs[0], jobsCount: jobs.length }) : '';\n\n  return `${contentTypeName || 'Asset'} \"${title}\", ${entityStatus} ${scheduledActions}`;\n}\n","import { useState, useEffect } from 'react';\n\nimport { FieldExtensionSDK, Link, Entry, Asset, ScheduledAction } from '@contentful/app-sdk';\nimport { entityHelpers } from '@contentful/field-editor-shared';\n\nimport { getEntityInfo } from './utils';\n\nexport type FetchedEntityData = {\n  jobs: ScheduledAction[];\n  entity: Entry | Asset;\n  entityTitle: string;\n  entityDescription: string;\n  entityStatus: ReturnType<typeof entityHelpers.getEntryStatus>;\n  contentTypeName: string;\n};\n\nasync function fetchAllData({\n  sdk,\n  entityId,\n  entityType,\n  localeCode,\n  defaultLocaleCode,\n}: {\n  sdk: FieldExtensionSDK;\n  entityId: string;\n  entityType: string;\n  localeCode: string;\n  defaultLocaleCode: string;\n}): Promise<FetchedEntityData> {\n  let contentType;\n\n  const getEntity = entityType === 'Entry' ? sdk.space.getEntry : sdk.space.getAsset;\n  const entity = await getEntity(entityId);\n  if (entity.sys.contentType) {\n    const contentTypeId = entity.sys.contentType.sys.id;\n    contentType = sdk.space.getCachedContentTypes().find((ct) => ct.sys.id === contentTypeId);\n  }\n\n  const entityTitle =\n    entityType === 'Entry'\n      ? entityHelpers.getEntryTitle({\n          entry: entity,\n          contentType,\n          localeCode,\n          defaultLocaleCode,\n          defaultTitle: 'Untitled',\n        })\n      : entityHelpers.getAssetTitle({\n          asset: entity,\n          localeCode,\n          defaultLocaleCode,\n          defaultTitle: 'Untitled',\n        });\n\n  const entityDescription = entityHelpers.getEntityDescription({\n    entity,\n    contentType,\n    localeCode,\n    defaultLocaleCode,\n  });\n\n  const jobs = await sdk.space.getEntityScheduledActions(entityType, entityId);\n\n  const entityStatus = entityHelpers.getEntryStatus(entity.sys);\n\n  return {\n    jobs,\n    entity,\n    entityTitle,\n    entityDescription,\n    entityStatus,\n    contentTypeName: contentType ? contentType.name : '',\n  };\n}\n\nexport type EntityInfoProps = {\n  target: Link;\n  sdk: FieldExtensionSDK;\n  onEntityFetchComplete?: VoidFunction;\n};\n\nfunction useRequestStatus({ sdk, target, onEntityFetchComplete }: EntityInfoProps) {\n  const [requestStatus, setRequestStatus] = useState<{\n    type: 'success' | 'loading' | 'error';\n    data?: FetchedEntityData;\n    error?: Error;\n  }>({ type: 'loading' });\n\n  useEffect(() => {\n    if (target) {\n      fetchAllData({\n        sdk,\n        entityId: target?.sys?.id,\n        entityType: target?.sys?.linkType,\n        localeCode: sdk.field.locale,\n        defaultLocaleCode: sdk.locales.default,\n      })\n        .then((entityInfo) => {\n          setRequestStatus({ type: 'success', data: entityInfo });\n        })\n        .catch((e) => {\n          console.log(e);\n          setRequestStatus({ type: 'error', error: e });\n        })\n        .finally(() => {\n          onEntityFetchComplete?.();\n        });\n    }\n  }, [sdk, target, onEntityFetchComplete]);\n\n  return requestStatus;\n}\n\nexport function useEntityInfo(props: EntityInfoProps) {\n  const status = useRequestStatus(props);\n\n  const { linkType } = props.target.sys;\n\n  if (status.type === 'loading') {\n    return `Loading ${linkType.toLowerCase()}...`;\n  }\n\n  if (status.type === 'error') {\n    return `${linkType} missing or inaccessible`;\n  }\n\n  return getEntityInfo(status.data);\n}\n","import tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\n\nexport const styles = {\n  hyperlinkWrapper: css({\n    display: 'inline',\n    position: 'static',\n    a: {\n      fontSize: 'inherit !important',\n    },\n  }),\n  hyperlink: css({\n    fontSize: 'inherit !important',\n    display: 'inline !important',\n    '&:hover': {\n      fill: tokens.gray900,\n    },\n    '&:focus': {\n      fill: tokens.gray900,\n    },\n  }),\n};\n","import * as React from 'react';\n\nimport { FieldExtensionSDK, Link } from '@contentful/app-sdk';\nimport { Tooltip, TextLink } from '@contentful/f36-components';\nimport { ReactEditor } from 'slate-react';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { CustomRenderElementProps } from '../../../types';\nimport { addOrEditLink } from '../HyperlinkModal';\nimport { useEntityInfo } from '../useEntityInfo';\nimport { styles } from './styles';\n\ntype HyperlinkElementProps = CustomRenderElementProps<{\n  uri?: string;\n  target?: Link;\n  onEntityFetchComplete?: VoidFunction;\n}>;\n\nexport function EntityHyperlink(props: HyperlinkElementProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n  const { target } = props.element.data;\n  const { onEntityFetchComplete } = props;\n\n  const tooltipContent = useEntityInfo({\n    target,\n    sdk,\n    onEntityFetchComplete,\n  });\n\n  if (!target) return null;\n\n  function handleClick(event: React.MouseEvent<HTMLAnchorElement>) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (!editor) return;\n    const p = ReactEditor.toSlatePoint(editor, [event.target as Node, 0], {\n      exactMatch: false,\n      suppressThrow: false,\n    });\n    addOrEditLink(editor, sdk, editor.tracking.onViewportAction, p.path);\n  }\n\n  return (\n    <Tooltip\n      content={tooltipContent}\n      targetWrapperClassName={styles.hyperlinkWrapper}\n      placement=\"bottom\"\n      maxWidth=\"auto\">\n      <TextLink\n        as=\"a\"\n        onClick={handleClick}\n        className={styles.hyperlink}\n        data-link-type={target.sys.linkType}\n        data-link-id={target.sys.id}>\n        {props.children}\n      </TextLink>\n    </Tooltip>\n  );\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK, Link } from '@contentful/app-sdk';\nimport { Tooltip, TextLink } from '@contentful/f36-components';\nimport { ReactEditor } from 'slate-react';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { CustomRenderElementProps } from '../../../types';\nimport { addOrEditLink } from '../HyperlinkModal';\nimport { styles } from './styles';\n\ntype HyperlinkElementProps = CustomRenderElementProps<{\n  uri?: string;\n  target?: Link;\n  onEntityFetchComplete?: VoidFunction;\n}>;\n\nexport function UrlHyperlink(props: HyperlinkElementProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n  const { uri } = props.element.data;\n\n  function handleClick(event: React.MouseEvent<HTMLAnchorElement>) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (!editor) return;\n    const p = ReactEditor.toSlatePoint(editor, [event.target as Node, 0], {\n      exactMatch: false,\n      suppressThrow: false,\n    });\n    addOrEditLink(editor, sdk, editor.tracking.onViewportAction, p.path);\n  }\n\n  return (\n    <Tooltip\n      content={uri}\n      targetWrapperClassName={styles.hyperlinkWrapper}\n      placement=\"bottom\"\n      maxWidth=\"auto\">\n      <TextLink\n        as=\"a\"\n        href={uri}\n        rel=\"noopener noreferrer\"\n        onClick={handleClick}\n        className={styles.hyperlink}>\n        {props.children}\n      </TextLink>\n    </Tooltip>\n  );\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK, Link } from '@contentful/app-sdk';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { AnyObject, KeyboardHandler, HotkeyPlugin } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\n\nimport { isLinkActive, unwrapLink } from '../../helpers/editor';\nimport { transformRemove } from '../../helpers/transformers';\nimport {\n  RichTextPlugin,\n  CustomRenderElementProps,\n  CustomElement,\n  RichTextEditor,\n} from '../../types';\nimport { withLinkTracking } from '../links-tracking';\nimport { EntityHyperlink } from './components/EntityHyperlink';\nimport { UrlHyperlink } from './components/UrlHyperlink';\nimport { addOrEditLink } from './HyperlinkModal';\nimport { hasText } from './utils';\n\ntype HyperlinkElementProps = CustomRenderElementProps<{\n  uri?: string;\n  target?: Link;\n  onEntityFetchComplete?: VoidFunction;\n}>;\n\nconst isAnchor = (element: HTMLElement) =>\n  element.nodeName === 'A' &&\n  !!element.getAttribute('href') &&\n  element.getAttribute('href') !== '#';\n\nconst isEntryAnchor = (element: HTMLElement) =>\n  element.nodeName === 'A' && element.getAttribute('data-link-type') === 'Entry';\n\nconst isAssetAnchor = (element: HTMLElement) =>\n  element.nodeName === 'A' && element.getAttribute('data-link-type') === 'Asset';\n\nconst buildHyperlinkEventHandler =\n  (sdk: FieldExtensionSDK): KeyboardHandler<RichTextEditor, HotkeyPlugin> =>\n  (editor, { options: { hotkey } }) => {\n    return (event: React.KeyboardEvent) => {\n      if (!editor.selection) {\n        return;\n      }\n\n      if (hotkey && !isHotkey(hotkey, event)) {\n        return;\n      }\n\n      if (isLinkActive(editor)) {\n        unwrapLink(editor);\n        editor.tracking.onShortcutAction('unlinkHyperlinks');\n      } else {\n        addOrEditLink(editor, sdk, editor.tracking.onShortcutAction);\n      }\n    };\n  };\n\nconst getNodeOfType =\n  (type: INLINES) =>\n  (el: HTMLElement, node: AnyObject): CustomElement<HyperlinkElementProps> => ({\n    type,\n    children: node.children,\n    data:\n      type === INLINES.HYPERLINK\n        ? {\n            uri: el.getAttribute('href'),\n          }\n        : {\n            target: {\n              sys: {\n                id: el.getAttribute('data-link-id'),\n                linkType: el.getAttribute('data-link-type'),\n                type: 'Link',\n              },\n            },\n          },\n  });\n\nexport const createHyperlinkPlugin = (sdk: FieldExtensionSDK): RichTextPlugin => {\n  const common: Partial<RichTextPlugin> = {\n    isElement: true,\n    isInline: true,\n  };\n\n  return {\n    key: 'HyperlinkPlugin',\n    options: {\n      hotkey: 'mod+k',\n    },\n    handlers: {\n      onKeyDown: buildHyperlinkEventHandler(sdk),\n    },\n    plugins: [\n      // URL Hyperlink\n      {\n        ...common,\n        key: INLINES.HYPERLINK,\n        type: INLINES.HYPERLINK,\n        component: UrlHyperlink,\n        deserializeHtml: {\n          rules: [\n            {\n              validNodeName: ['A'],\n            },\n          ],\n          query: (el) => isAnchor(el) && !(isEntryAnchor(el) || isAssetAnchor(el)),\n          getNode: getNodeOfType(INLINES.HYPERLINK),\n        },\n      },\n      // Entry Hyperlink\n      {\n        ...common,\n        key: INLINES.ENTRY_HYPERLINK,\n        type: INLINES.ENTRY_HYPERLINK,\n        component: withLinkTracking(EntityHyperlink),\n        deserializeHtml: {\n          rules: [\n            {\n              validNodeName: ['A'],\n            },\n          ],\n          query: (el) => isEntryAnchor(el),\n          getNode: getNodeOfType(INLINES.ENTRY_HYPERLINK),\n        },\n      },\n      // Asset Hyperlink\n      {\n        ...common,\n        key: INLINES.ASSET_HYPERLINK,\n        type: INLINES.ASSET_HYPERLINK,\n        component: withLinkTracking(EntityHyperlink),\n        deserializeHtml: {\n          rules: [\n            {\n              validNodeName: ['A'],\n            },\n          ],\n          query: (el) => isAssetAnchor(el),\n          getNode: getNodeOfType(INLINES.ASSET_HYPERLINK),\n        },\n      },\n    ],\n    normalizer: [\n      {\n        match: {\n          type: [INLINES.HYPERLINK, INLINES.ASSET_HYPERLINK, INLINES.ENTRY_HYPERLINK],\n        },\n        validNode: hasText,\n        transform: transformRemove,\n      },\n    ],\n  };\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst baseStyle = css`\n  padding: 0;\n  margin: 0 0 1.25rem 1.25rem;\n\n  div:first-child {\n    margin: 0;\n    line-height: ${tokens.lineHeightDefault};\n  }\n`;\n\nconst styles = {\n  [BLOCKS.UL_LIST]: css`\n    list-style-type: disc;\n    ul {\n      list-style-type: circle;\n      ul {\n        list-style-type: square;\n      }\n    }\n  `,\n  [BLOCKS.OL_LIST]: css`\n    list-style-type: decimal;\n    ol {\n      list-style-type: upper-alpha;\n      ol {\n        list-style-type: lower-roman;\n        ol {\n          list-style-type: lower-alpha;\n        }\n      }\n    }\n  `,\n};\n\nfunction createList(Tag, block: BLOCKS) {\n  return function List(props: Slate.RenderElementProps) {\n    return (\n      <Tag {...props.attributes} className={cx(baseStyle, styles[block])}>\n        {props.children}\n      </Tag>\n    );\n  };\n}\n\nexport const ListUL = createList('ul', BLOCKS.UL_LIST);\nexport const ListOL = createList('ol', BLOCKS.OL_LIST);\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst style = css`\n  margin: 0;\n  list-style: inherit;\n  margin-top: ${tokens.spacingXs};\n\n  ol,\n  ul {\n    margin: 0 0 0 ${tokens.spacingL};\n  }\n`;\n\nexport function ListItem(props: Slate.RenderElementProps) {\n  return (\n    <li {...props.attributes} className={style}>\n      {props.children}\n    </li>\n  );\n}\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { PlateEditor, unwrapNodes } from '@udecode/plate-core';\nimport { Editor, Element, Path, Transforms } from 'slate';\n\nfunction hasUnliftedListItems(editor: PlateEditor, at?: Path) {\n  return Editor.nodes(editor, {\n    at,\n    match: (node, path) =>\n      Element.isElement(node) && node.type === BLOCKS.LIST_ITEM && path.length >= 2,\n  }).next().done;\n}\nexport const unwrapList = (editor: PlateEditor, { at }: { at?: Path } = {}) => {\n  Editor.withoutNormalizing(editor, () => {\n    do {\n      // lift list items to the root level\n      Transforms.liftNodes(editor, {\n        at,\n        match: (node) => Element.isElement(node) && node.type === BLOCKS.LIST_ITEM,\n        mode: 'lowest',\n      });\n    } while (!hasUnliftedListItems(editor, at));\n\n    // finally unwrap all lifted items\n    unwrapNodes(editor, {\n      at,\n      match: { type: BLOCKS.LIST_ITEM },\n      split: false,\n    });\n  });\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  ELEMENT_DEFAULT,\n  findNode,\n  getNodes,\n  getPluginType,\n  isCollapsed,\n  isRangeAcrossBlocks,\n  PlateEditor,\n  setNodes,\n  TElement,\n  wrapNodes,\n} from '@udecode/plate-core';\nimport { ELEMENT_LIC } from '@udecode/plate-list';\nimport { getListItemEntry } from '@udecode/plate-list';\nimport { Editor, Node, NodeEntry, Range } from 'slate';\n\nimport { unwrapList } from './unwrapList';\n\nconst listTypes = [BLOCKS.UL_LIST, BLOCKS.OL_LIST] as string[];\n\nexport const toggleList = (editor: PlateEditor, { type }: { type: string }) =>\n  Editor.withoutNormalizing(editor, () => {\n    if (!editor.selection) {\n      return;\n    }\n\n    if (isCollapsed(editor.selection) || !isRangeAcrossBlocks(editor)) {\n      // selection is collapsed\n      const res = getListItemEntry(editor);\n\n      if (res) {\n        const { list } = res;\n        if (list[0].type !== type) {\n          setNodes(\n            editor,\n            { type },\n            {\n              at: editor.selection,\n              match: (n) => listTypes.includes(n.type),\n              mode: 'lowest',\n            }\n          );\n        } else {\n          unwrapList(editor);\n        }\n      } else {\n        const list = { type, children: [], data: {} };\n        wrapNodes(editor, list);\n\n        const nodes = [\n          ...getNodes(editor, {\n            match: { type: getPluginType(editor, ELEMENT_DEFAULT) },\n          }),\n        ];\n\n        const listItem = {\n          type: BLOCKS.LIST_ITEM,\n          children: [],\n          data: {},\n        };\n\n        for (const [, path] of nodes) {\n          wrapNodes(editor, listItem, {\n            at: path,\n          });\n        }\n      }\n    } else {\n      // selection is a range\n\n      const [startPoint, endPoint] = Range.edges(editor.selection);\n      const commonEntry = Node.common(\n        editor,\n        startPoint.path,\n        endPoint.path\n      ) as NodeEntry<TElement>;\n\n      if (\n        listTypes.includes((commonEntry[0] as TElement).type) ||\n        commonEntry[0].type === BLOCKS.LIST_ITEM\n      ) {\n        let listType = commonEntry[0].type;\n        if (commonEntry[0].type === BLOCKS.LIST_ITEM) {\n          listType = (Editor.parent(editor, commonEntry[1])[0] as TElement).type;\n        }\n        if (listType !== type) {\n          const startList = findNode(editor, {\n            at: Range.start(editor.selection),\n            match: { type: listTypes },\n            mode: 'lowest',\n          });\n\n          const endList = findNode(editor, {\n            at: Range.end(editor.selection),\n            match: { type: listTypes },\n            mode: 'lowest',\n          });\n\n          if (!startList || !endList) {\n            return;\n          }\n\n          const rangeLength = Math.min(startList[1].length, endList[1].length);\n          setNodes(\n            editor,\n            { type },\n            {\n              at: editor.selection,\n              match: (n, path) => listTypes.includes(n.type) && path.length >= rangeLength,\n              mode: 'all',\n            }\n          );\n        } else {\n          unwrapList(editor);\n        }\n      } else {\n        const rootPathLength = commonEntry[1].length;\n        const nodes = (\n          Array.from(\n            getNodes(editor, {\n              mode: 'all',\n            })\n          ) as NodeEntry<TElement>[]\n        )\n          .filter(([, path]) => path.length === rootPathLength + 1)\n          .reverse();\n\n        nodes.forEach((n) => {\n          if (listTypes.includes(n[0].type)) {\n            setNodes(editor, { type }, { at: n[1] });\n          } else {\n            setNodes(editor, { type: getPluginType(editor, ELEMENT_LIC) }, { at: n[1] });\n\n            const listItem = {\n              type: BLOCKS.LIST_ITEM,\n              children: [],\n              data: {},\n            };\n\n            wrapNodes(editor, listItem, {\n              at: n[1],\n            });\n\n            const list = { type, children: [], data: {} };\n            wrapNodes(editor, list, { at: n[1] });\n          }\n        });\n      }\n    }\n  });\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { getAbove, HotkeyPlugin, KeyboardHandler } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\nimport castArray from 'lodash/castArray';\n\nimport { RichTextEditor } from '../../types';\nimport { moveListItems } from './transforms/moveListItems';\nimport { toggleList } from './transforms/toggleList';\n\nexport const onKeyDownList: KeyboardHandler<RichTextEditor, HotkeyPlugin> =\n  (editor, { type, options: { hotkey } }) =>\n  (e) => {\n    if (e.key === 'Tab' && editor.selection) {\n      const listSelected = getAbove(editor, {\n        at: editor.selection,\n        match: { type },\n      });\n\n      if (listSelected) {\n        e.preventDefault();\n        moveListItems(editor, { increase: !e.shiftKey });\n        return;\n      }\n    }\n\n    if (!hotkey) return;\n\n    const hotkeys = castArray(hotkey);\n\n    for (const _hotkey of hotkeys) {\n      if (isHotkey(_hotkey)(e)) {\n        toggleList(editor, { type });\n      }\n    }\n  };\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { EditorNodesOptions, getNodes, getPluginType, PlateEditor } from '@udecode/plate-core';\nimport { isListNested, ELEMENT_LIC, getListItemEntry, moveListItemUp } from '@udecode/plate-list';\nimport { Editor, Path, PathRef } from 'slate';\n\nimport { moveListItemDown } from './moveListItemDown';\n\nexport type MoveListItemsOptions = {\n  increase?: boolean;\n  at?: EditorNodesOptions['at'];\n};\n\nexport const moveListItems = (\n  editor: PlateEditor,\n  { increase = true, at = editor.selection ?? undefined }: MoveListItemsOptions = {}\n) => {\n  const _nodes = getNodes(editor, {\n    at,\n    match: {\n      type: getPluginType(editor, ELEMENT_LIC),\n    },\n  });\n\n  // Get the selected lic\n  const lics = Array.from(_nodes);\n\n  if (!lics.length) return;\n\n  const highestLicPaths: Path[] = [];\n  const highestLicPathRefs: PathRef[] = [];\n\n  // Filter out the nested lic, we just need to move the highest ones\n  lics.forEach((lic) => {\n    const licPath = lic[1];\n    const liPath = Path.parent(licPath);\n\n    const isAncestor = highestLicPaths.some((path) => {\n      const highestLiPath = Path.parent(path);\n\n      return Path.isAncestor(highestLiPath, liPath);\n    });\n    if (!isAncestor) {\n      highestLicPaths.push(licPath);\n      highestLicPathRefs.push(Editor.pathRef(editor, licPath));\n    }\n  });\n\n  const licPathRefsToMove = increase ? highestLicPathRefs : highestLicPathRefs.reverse();\n\n  Editor.withoutNormalizing(editor, () => {\n    licPathRefsToMove.forEach((licPathRef) => {\n      const licPath = licPathRef.unref();\n      if (!licPath) return;\n\n      const liEntry = getListItemEntry(editor, { at: licPath });\n\n      if (!liEntry) {\n        return;\n      }\n\n      if (increase) {\n        moveListItemDown(editor, liEntry);\n      } else if (isListNested(editor, liEntry.list[1])) {\n        moveListItemUp(editor, liEntry);\n      }\n    });\n  });\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { getLastChildPath, match, PlateEditor, TElement, wrapNodes } from '@udecode/plate-core';\nimport { getListTypes } from '@udecode/plate-list';\nimport { Ancestor, Editor, NodeEntry, Path, Transforms, Node } from 'slate';\n\nexport interface MoveListItemDownOptions {\n  list: NodeEntry<TElement>;\n  listItem: NodeEntry<TElement>;\n}\n\nexport const moveListItemDown = (\n  editor: PlateEditor,\n  { list, listItem }: MoveListItemDownOptions\n) => {\n  const [listNode] = list;\n  const [, listItemPath] = listItem;\n\n  let previousListItemPath: Path;\n\n  try {\n    previousListItemPath = Path.previous(listItemPath);\n  } catch (e) {\n    return;\n  }\n\n  // Previous sibling is the new parent\n  const previousSiblingItem = Editor.node(editor, previousListItemPath) as NodeEntry<Ancestor>;\n\n  if (previousSiblingItem) {\n    const [, previousPath] = previousSiblingItem;\n\n    const subList = Array.from(Node.children(editor, previousPath)).find(([n]) =>\n      match(n, { type: getListTypes(editor) })\n    ) as NodeEntry<Ancestor> | undefined;\n\n    const newPath = Path.next(getLastChildPath(subList ?? previousSiblingItem));\n\n    Editor.withoutNormalizing(editor, () => {\n      if (!subList) {\n        // Create new sub-list\n        wrapNodes(editor, { type: listNode.type, children: [], data: {} }, { at: listItemPath });\n      }\n\n      // Move the current item to the sub-list\n      Transforms.moveNodes(editor, {\n        at: listItemPath,\n        to: newPath,\n      });\n    });\n  }\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { getAbove, getBlockAbove, getParent } from '@udecode/plate-core';\nimport { NodeEntry, Transforms, Path, Node, Text, Range } from 'slate';\n\nimport { CustomElement, RichTextEditor } from '../../types';\n\nconst isList = (node: CustomElement) =>\n  [BLOCKS.OL_LIST, BLOCKS.UL_LIST].includes(node.type as BLOCKS);\n\nexport const hasListAsDirectParent = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  const [parentNode] = (getParent(editor, path) || []) as NodeEntry;\n  return isList(parentNode as CustomElement);\n};\n\nconst getNearestListAncestor = (editor: RichTextEditor, path: Path) => {\n  return getAbove(editor, { at: path, mode: 'lowest', match: isList }) || [];\n};\n\n/**\n * Places orphaned list items in a list. If there's a list somewhere\n * in the node's ancestors, defaults to that list type, else places\n * the list item in an unordered list.\n */\nexport const normalizeOrphanedListItem = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  const [parentList] = getNearestListAncestor(editor, path);\n  const parentListType = parentList?.type;\n  Transforms.wrapNodes(\n    editor,\n    { type: parentListType || BLOCKS.UL_LIST, children: [], data: {} },\n    { at: path }\n  );\n};\n\nexport const isNonEmptyListItem = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  const listItemChildren = Array.from(Node.children(editor, path));\n\n  return listItemChildren.length !== 0;\n};\n\nexport const firstNodeIsNotList = (_editor: RichTextEditor, [node]: NodeEntry<CustomElement>) => {\n  if (node.children.length === 1) {\n    const firstNode = node.children[0];\n\n    return !Text.isText(firstNode) && !isList(firstNode);\n  }\n\n  return true;\n};\n\nexport const insertParagraphAsChild = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  Transforms.insertNodes(editor, [{ type: BLOCKS.PARAGRAPH, data: {}, children: [{ text: '' }] }], {\n    at: path.concat([0]),\n  });\n};\n\nexport const replaceNodeWithListItems = (editor, entry) => {\n  const [node, path] = entry;\n\n  Transforms.removeNodes(editor, { at: path });\n  Transforms.insertNodes(editor, node.children[0].children, { at: path });\n};\n\nexport const isListTypeActive = (editor: RichTextEditor, type: BLOCKS): boolean => {\n  const { selection } = editor;\n\n  if (!selection) {\n    return false;\n  }\n\n  if (Range.isExpanded(selection)) {\n    const [start, end] = Range.edges(selection);\n    const node = Node.common(editor, start.path, end.path);\n\n    if ((node[0] as CustomElement).type === type) {\n      return true;\n    }\n  }\n\n  // Lists can be nested. Here, we take the list type at the lowest level\n  const listNode = getBlockAbove(editor, {\n    match: {\n      type: [BLOCKS.OL_LIST, BLOCKS.UL_LIST],\n    },\n    mode: 'lowest',\n  });\n\n  return listNode?.[0].type === type;\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { TEXT_CONTAINERS, BLOCKS } from '@contentful/rich-text-types';\nimport { findNode, TDescendant } from '@udecode/plate-core';\nimport { Editor, Node, NodeEntry, Path, Transforms } from 'slate';\n\nimport { RichTextEditor } from '../../types';\n\nconst getFirstAncestorOfType = (root: TDescendant, entry: NodeEntry): NodeEntry<TDescendant> => {\n  let ancestor: Path = Path.parent(entry[1]);\n  while ((Node.get(root, ancestor) as TDescendant).type !== BLOCKS.LIST_ITEM) {\n    ancestor = Path.parent(ancestor);\n  }\n\n  return [Node.get(root, ancestor), ancestor];\n};\n\nconst isListRoot = (node: TDescendant): boolean =>\n  [BLOCKS.UL_LIST, BLOCKS.OL_LIST].includes(node.type);\n\n/**\n * Removes the \"empty\" leading lis. Empty in this context means lis only with other lis as children.\n *\n * @returns If argument is not a list root, returns it, otherwise returns ul[] or li[].\n */\nconst trimList = <T extends TDescendant>(listRoot: T): T[] => {\n  if (!isListRoot(listRoot)) {\n    return [listRoot];\n  }\n\n  const textEntries = Array.from(Node.texts(listRoot));\n\n  const commonAncestorEntry = textEntries.reduce<NodeEntry<TDescendant>>(\n    (commonAncestor, textEntry) =>\n      Path.isAncestor(commonAncestor[1], textEntry[1])\n        ? commonAncestor\n        : Node.common(listRoot, textEntry[1], commonAncestor[1]),\n    // any list item would do, we grab the first one\n    getFirstAncestorOfType(listRoot, textEntries[0])\n  );\n\n  return isListRoot(commonAncestorEntry[0])\n    ? commonAncestorEntry[0].children\n    : [commonAncestorEntry[0]];\n};\n\n/**\n * Removes leading li when pasting a single li with a single child.\n */\nconst trimLiWrapper = <T extends TDescendant>(nodes: T[]): T[] => {\n  if (nodes.length !== 1) {\n    return nodes;\n  }\n\n  const node = nodes[0];\n\n  if (node.type !== BLOCKS.LIST_ITEM || node.children.length !== 1) {\n    return nodes;\n  }\n\n  return node.children;\n};\n\nconst unwrapTextContainerAtStart = <T extends TDescendant>(nodes: T[]): T[] => {\n  const node = nodes[0];\n\n  if (TEXT_CONTAINERS.includes(node.type)) {\n    return [...node.children, ...nodes.slice(1)];\n  }\n\n  return nodes;\n};\n\nexport const insertListFragment = (editor: RichTextEditor) => {\n  const { insertFragment } = editor;\n\n  return (fragment: TDescendant[]) => {\n    if (!editor.selection) {\n      return;\n    }\n\n    const liEntry = findNode(editor, {\n      match: { type: BLOCKS.LIST_ITEM },\n      mode: 'lowest',\n    });\n\n    if (liEntry) {\n      const nodes = unwrapTextContainerAtStart(\n        trimLiWrapper(fragment.flatMap((node) => trimList(node)))\n      );\n\n      let firstBlockIndex = nodes.findIndex((node) => Editor.isBlock(editor, node));\n\n      if (firstBlockIndex < 0) {\n        firstBlockIndex = nodes.length;\n      }\n\n      const inlines = nodes.slice(0, firstBlockIndex);\n      const blocks = nodes.slice(firstBlockIndex);\n\n      // Two calls to insertNodes are required here. Otherwise, all blocks\n      // after a text or inline element occurrence will be unwrapped for\n      // some reason.\n      Transforms.insertNodes(editor, inlines, {\n        at: editor.selection,\n        select: true,\n      });\n\n      return Transforms.insertNodes(editor, blocks, {\n        at: editor.selection,\n        select: true,\n      });\n    }\n\n    const filtered: TDescendant[] = isListRoot(fragment[0])\n      ? [{ text: '' }, ...fragment]\n      : fragment;\n\n    return insertFragment(filtered);\n  };\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { LIST_ITEM_BLOCKS } from '@contentful/rich-text-types';\nimport { WithOverride } from '@udecode/plate-core';\nimport {\n  ListPlugin,\n  normalizeList,\n  deleteFragmentList,\n  deleteForwardList,\n} from '@udecode/plate-list';\n\nimport { RichTextEditor } from '../../types';\nimport { insertListBreak } from './insertListBreak';\nimport { insertListFragment } from './insertListFragment';\nimport { deleteBackwardList } from './transforms/deleteBackwardList';\n\nconst validLiChildrenTypes = LIST_ITEM_BLOCKS;\n\nexport const withList: WithOverride<RichTextEditor, ListPlugin> = (editor) => {\n  const { deleteBackward, deleteForward, deleteFragment } = editor;\n\n  editor.deleteBackward = (unit) => {\n    if (deleteBackwardList(editor, unit)) return;\n\n    deleteBackward(unit);\n  };\n\n  editor.deleteForward = (unit) => {\n    if (deleteForwardList(editor)) return;\n\n    deleteForward(unit);\n  };\n\n  editor.deleteFragment = () => {\n    if (deleteFragmentList(editor)) return;\n\n    deleteFragment();\n  };\n\n  editor.insertBreak = insertListBreak(editor);\n\n  editor.insertFragment = insertListFragment(editor);\n\n  // TODO: replace with Normalizer rules\n  editor.normalizeNode = normalizeList(editor, { validLiChildrenTypes });\n\n  return editor;\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  deleteFragment,\n  isFirstChild,\n  isSelectionAtBlockStart,\n  mockPlugin,\n} from '@udecode/plate-core';\nimport {\n  getListItemEntry,\n  removeFirstListItem,\n  removeListItem,\n  isListNested,\n} from '@udecode/plate-list';\nimport { onKeyDownResetNode, ResetNodePlugin, SIMULATE_BACKSPACE } from '@udecode/plate-reset-node';\nimport { Editor } from 'slate';\n\nimport { RichTextEditor } from '../../../types';\nimport { unwrapList } from './unwrapList';\n\nexport const deleteBackwardList = (\n  editor: RichTextEditor,\n  unit: 'character' | 'word' | 'line' | 'block'\n) => {\n  const res = getListItemEntry(editor, {});\n\n  let moved: boolean | undefined = false;\n\n  if (res) {\n    const { list, listItem } = res;\n\n    if (\n      isSelectionAtBlockStart(editor, {\n        match: (node) => node.type === BLOCKS.LIST_ITEM,\n      })\n    ) {\n      Editor.withoutNormalizing(editor, () => {\n        moved = removeFirstListItem(editor, { list, listItem });\n        if (moved) return;\n\n        moved = removeListItem(editor, { list, listItem });\n        if (moved) return;\n\n        if (isFirstChild(listItem[1]) && !isListNested(editor, list[1])) {\n          onKeyDownResetNode(\n            editor,\n            mockPlugin<ResetNodePlugin>({\n              options: {\n                rules: [\n                  {\n                    types: [BLOCKS.LIST_ITEM],\n                    defaultType: BLOCKS.PARAGRAPH,\n                    hotkey: 'backspace',\n                    predicate: () => isSelectionAtBlockStart(editor),\n                    onReset: (e) => unwrapList(e),\n                  },\n                ],\n              },\n            })\n          )(SIMULATE_BACKSPACE);\n          moved = true;\n          return;\n        }\n\n        deleteFragment(editor, {\n          unit,\n          reverse: true,\n        });\n        moved = true;\n      });\n    }\n  }\n\n  return moved;\n};\n","/**\n * Credit: Copied & modified version from Plate's list plugin to support\n * list items with multiple children.\n *\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { ELEMENT_DEFAULT, getPluginType, isBlockAboveEmpty, mockPlugin } from '@udecode/plate-core';\nimport { getListItemEntry, moveListItemUp, unwrapList, ELEMENT_LI } from '@udecode/plate-list';\nimport { onKeyDownResetNode, ResetNodePlugin, SIMULATE_BACKSPACE } from '@udecode/plate-reset-node';\n\nimport { RichTextEditor } from '../../types';\nimport { insertListItem } from './transforms/insertListItem';\n\nconst listBreak = (editor: RichTextEditor): boolean => {\n  if (!editor.selection) return false;\n\n  const res = getListItemEntry(editor, {});\n  let moved: boolean | undefined;\n\n  // If selection is in a li\n  if (res) {\n    const { list, listItem } = res;\n\n    const childNode = listItem[0].children[0];\n\n    // If selected li is empty, move it up.\n    if (\n      isBlockAboveEmpty(editor) &&\n      listItem[0].children.length === 1 &&\n      TEXT_CONTAINERS.includes(childNode.type as BLOCKS)\n    ) {\n      moved = moveListItemUp(editor, {\n        list,\n        listItem,\n      });\n\n      if (moved) return true;\n    }\n  }\n\n  const didReset = onKeyDownResetNode(\n    editor,\n    mockPlugin<ResetNodePlugin>({\n      options: {\n        rules: [\n          {\n            types: [getPluginType(editor, ELEMENT_LI)],\n            defaultType: getPluginType(editor, ELEMENT_DEFAULT),\n            predicate: () => !moved && isBlockAboveEmpty(editor),\n            onReset: (_editor) => unwrapList(_editor),\n          },\n        ],\n      },\n    })\n  )(SIMULATE_BACKSPACE);\n  if (didReset) {\n    return true;\n  }\n\n  /**\n   * If selection is in li > p, insert li.\n   */\n  if (!moved) {\n    const inserted = insertListItem(editor);\n    if (inserted) return true;\n  }\n\n  return false;\n};\n\nexport const insertListBreak = (editor: RichTextEditor) => {\n  const { insertBreak } = editor;\n\n  return () => {\n    if (listBreak(editor)) return;\n\n    insertBreak();\n  };\n};\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport {\n  getAbove,\n  getParent,\n  insertNodes,\n  isFirstChild,\n  isSelectionAtBlockEnd,\n  isSelectionAtBlockStart,\n  moveChildren,\n} from '@udecode/plate-core';\nimport { Editor, Path, Transforms } from 'slate';\n\nimport { CustomElement, RichTextEditor } from '../../../types';\n\n/**\n * Build a new list item node while preserving marks\n */\nconst emptyListItemNode = (editor: RichTextEditor, withChildren = false): CustomElement => {\n  let children: CustomElement[] = [];\n\n  if (withChildren) {\n    const marks = Editor.marks(editor) || {};\n\n    children = [\n      {\n        type: BLOCKS.PARAGRAPH,\n        data: {},\n        children: [{ text: '', ...marks }],\n      },\n    ];\n  }\n\n  return {\n    type: BLOCKS.LIST_ITEM,\n    data: {},\n    children,\n  };\n};\n\n/**\n * Insert list item if selection is in li>p.\n */\nexport const insertListItem = (editor: RichTextEditor): boolean => {\n  if (!editor.selection) {\n    return false;\n  }\n\n  // Naming it paragraph for simplicity but can be a heading as well\n  const paragraph = getAbove(editor, { match: { type: TEXT_CONTAINERS } });\n  if (!paragraph) {\n    return false;\n  }\n\n  const [, paragraphPath] = paragraph;\n  const listItem = getParent(editor, paragraphPath);\n\n  if (!listItem) {\n    return false;\n  }\n\n  const [listItemNode, listItemPath] = listItem;\n\n  if (listItemNode.type !== BLOCKS.LIST_ITEM) {\n    return false;\n  }\n\n  // We are in a li>p (or heading)\n\n  Editor.withoutNormalizing(editor, () => {\n    if (!editor.selection) {\n      return;\n    }\n\n    // Check the cursor position in the current paragraph\n    const isAtStart = isSelectionAtBlockStart(editor);\n    const isAtEnd = isSelectionAtBlockEnd(editor);\n\n    const isAtStartOfListItem = isAtStart && isFirstChild(paragraphPath);\n    const shouldSplit = !isAtStart && !isAtEnd;\n\n    // Split the current paragraph content if necessary\n    if (shouldSplit) {\n      Transforms.splitNodes(editor);\n    }\n\n    // Insert the new li\n    const newListItemPath = isAtStartOfListItem ? listItemPath : Path.next(listItemPath);\n\n    insertNodes(\n      editor,\n      // Add an empty paragraph to the new li if We will not move some\n      // paragraphs over there.\n      emptyListItemNode(editor, !shouldSplit),\n      { at: newListItemPath }\n    );\n\n    // Move children *after* selection to the new li\n    const fromPath = isAtStart ? paragraphPath : Path.next(paragraphPath);\n    const fromStartIndex = fromPath[fromPath.length - 1] || 0;\n\n    // On split we don't add paragraph to the new li so we move\n    // content to the very beginning. Otherwise, account for the empty\n    // paragraph at the beginning by moving the content after\n    const toPath = newListItemPath.concat([shouldSplit ? 0 : 1]);\n\n    if (!isAtStartOfListItem) {\n      moveChildren(editor, {\n        at: listItemPath,\n        to: toPath,\n        fromStartIndex,\n      });\n    }\n\n    // Move cursor to the start of the new li\n    Transforms.select(editor, newListItemPath);\n    Transforms.collapse(editor, { edge: 'start' });\n  });\n\n  // Returning True skips processing other editor.insertBreak handlers\n  return true;\n};\n","import * as React from 'react';\n\nimport { ListBulletedIcon, ListNumberedIcon } from '@contentful/f36-icons';\nimport { BLOCKS } from '@contentful/rich-text-types';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { focus } from '../../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../../helpers/validations';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { toggleList } from '../transforms/toggleList';\nimport { isListTypeActive } from '../utils';\n\nexport interface ToolbarListButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function ToolbarListButton(props: ToolbarListButtonProps) {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n\n  function handleClick(type: BLOCKS): () => void {\n    return () => {\n      if (!editor?.selection) return;\n\n      toggleList(editor, { type });\n\n      focus(editor);\n    };\n  }\n\n  if (!editor) return null;\n\n  return (\n    <React.Fragment>\n      {isNodeTypeEnabled(sdk.field, BLOCKS.UL_LIST) && (\n        <ToolbarButton\n          title=\"UL\"\n          testId=\"ul-toolbar-button\"\n          onClick={handleClick(BLOCKS.UL_LIST)}\n          isActive={isListTypeActive(editor, BLOCKS.UL_LIST)}\n          isDisabled={props.isDisabled}>\n          <ListBulletedIcon />\n        </ToolbarButton>\n      )}\n      {isNodeTypeEnabled(sdk.field, BLOCKS.OL_LIST) && (\n        <ToolbarButton\n          title=\"OL\"\n          testId=\"ol-toolbar-button\"\n          onClick={handleClick(BLOCKS.OL_LIST)}\n          isActive={isListTypeActive(editor, BLOCKS.OL_LIST)}\n          isDisabled={props.isDisabled}>\n          <ListNumberedIcon />\n        </ToolbarButton>\n      )}\n    </React.Fragment>\n  );\n}\n","import * as React from 'react';\n\nimport { MARKS } from '@contentful/rich-text-types';\nimport { isMarkActive, toggleMark } from '@udecode/plate-core';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { focus } from '../../../helpers/editor';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\n\nexport interface MarkOptions {\n  mark: MARKS;\n  title: string;\n  icon: React.ReactElement;\n}\n\nexport const createMarkToolbarButton = ({ mark, title, icon }: MarkOptions) => {\n  const Mark = ({ isDisabled }: { isDisabled?: boolean }) => {\n    const editor = useContentfulEditor();\n\n    const handleClick = React.useCallback(() => {\n      if (!editor?.selection) return;\n\n      const isActive = isMarkActive(editor, mark);\n      editor.tracking.onToolbarAction(isActive ? 'unmark' : 'mark', { markType: mark });\n\n      toggleMark(editor, { key: mark });\n      focus(editor);\n    }, [editor]);\n\n    if (!editor) return null;\n\n    return (\n      <ToolbarButton\n        title={title}\n        testId={`${mark}-toolbar-button`}\n        onClick={handleClick}\n        isActive={isMarkActive(editor, mark)}\n        isDisabled={isDisabled}>\n        {icon}\n      </ToolbarButton>\n    );\n  };\n\n  Mark.displayName = mark;\n\n  return Mark;\n};\n","import { MARKS } from '@contentful/rich-text-types';\nimport { HotkeyPlugin, isMarkActive, KeyboardHandler, toggleMark } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\n\nimport { RichTextEditor } from '../../types';\n\nexport const buildMarkEventHandler =\n  (type: MARKS): KeyboardHandler<RichTextEditor, HotkeyPlugin> =>\n  (editor, { options: { hotkey } }) =>\n  (event) => {\n    if (editor.selection && hotkey && isHotkey(hotkey, event)) {\n      event.preventDefault();\n\n      const isActive = isMarkActive(editor, type);\n      editor.tracking.onShortcutAction(isActive ? 'unmark' : 'mark', { markType: type });\n\n      toggleMark(editor, { key: type as string });\n    }\n  };\n","import * as React from 'react';\n\nimport { FormatBoldIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createBoldPlugin as createDefaultBoldPlugin } from '@udecode/plate-basic-marks';\nimport { someHtmlElement } from '@udecode/plate-core';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nimport { RichTextPlugin } from '../../types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarBoldButton = createMarkToolbarButton({\n  title: 'Bold',\n  mark: MARKS.BOLD,\n  icon: <FormatBoldIcon />,\n});\n\nconst styles = {\n  bold: css({\n    fontWeight: 600,\n  }),\n};\n\nexport function Bold(props: Slate.RenderLeafProps) {\n  return (\n    <strong {...props.attributes} className={styles.bold}>\n      {props.children}\n    </strong>\n  );\n}\n\nconst isGoogleBoldWrapper = (el: HTMLElement) =>\n  el.id.startsWith('docs-internal-guid') && el.nodeName === 'B';\n\nexport const createBoldPlugin = (): RichTextPlugin =>\n  createDefaultBoldPlugin({\n    type: MARKS.BOLD,\n    component: Bold,\n    options: {\n      hotkey: ['mod+b'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.BOLD),\n    },\n    deserializeHtml: {\n      rules: [\n        { validNodeName: ['STRONG', 'B'] },\n        {\n          validStyle: {\n            fontWeight: ['600', '700', 'bold'],\n          },\n        },\n      ],\n      query: (el) => {\n        return (\n          !isGoogleBoldWrapper(el) &&\n          !someHtmlElement(el, (node) => node.style.fontWeight === 'normal')\n        );\n      },\n    },\n  });\n","import * as React from 'react';\n\nimport { CodeIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createCodePlugin as createDefaultCodePlugin } from '@udecode/plate-basic-marks';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nimport { RichTextPlugin } from '../../types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarCodeButton = createMarkToolbarButton({\n  title: 'Code',\n  mark: MARKS.CODE,\n  icon: <CodeIcon />,\n});\n\nconst styles = {\n  code: css({\n    fontFamily: 'monospace',\n    fontSize: '.9em',\n  }),\n};\n\nexport function Code(props: Slate.RenderLeafProps) {\n  return (\n    <code {...props.attributes} className={styles.code}>\n      {props.children}\n    </code>\n  );\n}\n\nexport const createCodePlugin = (): RichTextPlugin =>\n  createDefaultCodePlugin({\n    type: MARKS.CODE,\n    component: Code,\n    options: {\n      hotkey: ['mod+/'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.CODE),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['CODE', 'PRE'],\n        },\n        {\n          validStyle: {\n            fontFamily: ['Consolas', 'monospace'],\n          },\n        },\n      ],\n    },\n  });\n","import * as React from 'react';\n\nimport { FormatItalicIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createItalicPlugin as createDefaultItalicPlugin } from '@udecode/plate-basic-marks';\nimport { someHtmlElement } from '@udecode/plate-core';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nimport { RichTextPlugin } from '../../types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarItalicButton = createMarkToolbarButton({\n  title: 'Italic',\n  mark: MARKS.ITALIC,\n  icon: <FormatItalicIcon />,\n});\n\nconst styles = {\n  italic: css({\n    fontStyle: 'italic',\n  }),\n};\n\nexport function Italic(props: Slate.RenderLeafProps) {\n  return (\n    <em {...props.attributes} className={styles.italic}>\n      {props.children}\n    </em>\n  );\n}\n\nexport const createItalicPlugin = (): RichTextPlugin =>\n  createDefaultItalicPlugin({\n    type: MARKS.ITALIC,\n    component: Italic,\n    options: {\n      hotkey: ['mod+i'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.ITALIC),\n    },\n    deserializeHtml: {\n      rules: [\n        { validNodeName: ['I', 'EM'] },\n        {\n          validStyle: {\n            fontStyle: 'italic',\n          },\n        },\n      ],\n      query: (el) => {\n        return !someHtmlElement(el, (node) => node.style.fontStyle === 'normal');\n      },\n    },\n  });\n","import * as React from 'react';\n\nimport { FormatUnderlinedIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createUnderlinePlugin as createDefaultUnderlinePlugin } from '@udecode/plate-basic-marks';\nimport { someHtmlElement } from '@udecode/plate-core';\nimport * as Slate from 'slate-react';\n\nimport { RichTextPlugin } from '../../types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarUnderlineButton = createMarkToolbarButton({\n  title: 'Underline',\n  mark: MARKS.UNDERLINE,\n  icon: <FormatUnderlinedIcon />,\n});\n\nexport function Underline(props: Slate.RenderLeafProps) {\n  return <u {...props.attributes}>{props.children}</u>;\n}\n\nexport const createUnderlinePlugin = (): RichTextPlugin =>\n  createDefaultUnderlinePlugin({\n    type: MARKS.UNDERLINE,\n    component: Underline,\n    options: {\n      hotkey: ['mod+u'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.UNDERLINE),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['U'],\n        },\n        {\n          validStyle: {\n            textDecoration: ['underline'],\n          },\n        },\n      ],\n      query: (el) => {\n        return !someHtmlElement(el, (node) => node.style.textDecoration === 'none');\n      },\n    },\n  });\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { getParent } from '@udecode/plate-core';\nimport { Text } from 'slate';\nimport { CustomElement } from 'types';\n\nimport { INLINE_TYPES } from '../../helpers/editor';\nimport { transformWrapIn } from '../../helpers/transformers';\nimport { NormalizerRule } from './types';\n\nconst isInline = (node: CustomElement) => INLINE_TYPES.includes(node.type);\nconst isTextContainer = (node: CustomElement) => TEXT_CONTAINERS.includes(node.type as BLOCKS);\n\n// Base rules are rules that must be enforced at all times regardless\n// of which plugins are enabled.\nexport const baseRules: Required<NormalizerRule>[] = [\n  {\n    // Wrap orphaned text nodes in a paragraph\n    match: Text.isText,\n    validNode: (editor, [, path]) => {\n      const parent = getParent(editor, path)?.[0] as CustomElement;\n      return !!parent && (isTextContainer(parent) || isInline(parent) || editor.isVoid(parent));\n    },\n    transform: (editor, entry) => {\n      return transformWrapIn(BLOCKS.PARAGRAPH)(editor, entry);\n    },\n  },\n  {\n    // Wrap orphaned inline nodes in a paragraph,\n    match: {\n      type: INLINE_TYPES,\n    },\n    validNode: (editor, [, path]) => {\n      const parent = getParent(editor, path)?.[0] as CustomElement;\n      return !!parent && isTextContainer(parent);\n    },\n    transform: transformWrapIn(BLOCKS.PARAGRAPH),\n  },\n];\n","import { NodeEntry, Text, Node, Element } from 'slate';\nimport { RichTextEditor } from 'types';\n\nimport { NodeValidator, NodeTransformer } from './types';\n\nexport class NormalizerError extends Error {}\n\nexport const createValidatorFromTypes =\n  (types: string[]): NodeValidator =>\n  (_, [node]) => {\n    return Element.isElement(node) && types.includes(node.type);\n  };\n\nexport const getChildren = (editor: RichTextEditor, [node, path]: NodeEntry): NodeEntry[] => {\n  if (Text.isText(node)) {\n    return [];\n  }\n\n  return Array.from(Node.children(editor, path));\n};\n\nexport const createTransformerFromObject = (\n  transforms: Record<string, NodeTransformer>\n): NodeTransformer => {\n  // A default transformer must always be provided\n  const fallback = transforms['default'];\n\n  if (!fallback) {\n    throw new NormalizerError('A default transformer MUST be provided');\n  }\n\n  return (editor, entry) => {\n    const [node] = entry;\n    const key = Element.isElement(node) ? node.type : 'default';\n\n    const transformer = transforms[key] || fallback;\n\n    return transformer(editor, entry);\n  };\n};\n","import { match, getPluginType } from '@udecode/plate-core';\nimport isPlainObject from 'is-plain-obj';\nimport { Editor, NodeEntry } from 'slate';\n\nimport { transformRemove } from '../../helpers/transformers';\nimport { RichTextEditor, RichTextPlugin } from '../../types';\nimport { baseRules } from './baseRules';\nimport { NormalizerRule, NodeTransformer, NodeValidator } from './types';\nimport {\n  NormalizerError,\n  createValidatorFromTypes,\n  getChildren,\n  createTransformerFromObject,\n} from './utils';\n\nexport const withNormalizer = (editor: RichTextEditor) => {\n  const rules: Required<NormalizerRule>[] = baseRules;\n\n  // Derive normalization rules from other plugin's configurations\n  for (const p of editor.plugins as RichTextPlugin[]) {\n    const { normalizer: _rules } = p;\n\n    if (!_rules) {\n      continue;\n    }\n\n    for (const _rule of _rules) {\n      // Clone to avoid mutation bugs\n      const rule = { ..._rule };\n\n      if (!rule.match && !p.isElement) {\n        throw new NormalizerError('rule.match MUST be defined in a non-element plugin');\n      }\n\n      // By default we filter elements with given plugin type\n      if (!rule.match) {\n        rule.match = {\n          type: getPluginType(editor, p.key),\n        };\n      }\n\n      // Conditional transformation e.g.\n      // {\n      //   [BLOCKS.EMBEDDED_ASSET]: transformLift,\n      //   default?: transformRemove\n      // }\n      //\n      if (isPlainObject(rule.transform)) {\n        if ('validNode' in rule) {\n          // I can't think of a use case. Disabled to prevent misuse\n          throw new NormalizerError(\n            'conditional transformations are not supported in validNode rules'\n          );\n        }\n\n        rule.transform = createTransformerFromObject({\n          default: transformRemove,\n          ...rule.transform,\n        });\n      }\n\n      // By default all invalid nodes are removed.\n      if (!rule.transform) {\n        rule.transform = transformRemove;\n      }\n\n      // Convert Types array syntax to a validator function\n      if ('validChildren' in rule && Array.isArray(rule.validChildren)) {\n        rule.validChildren = createValidatorFromTypes(rule.validChildren);\n      }\n\n      rules.push(rule as Required<NormalizerRule>);\n    }\n  }\n\n  // Wrap transformer in a withoutNormalizing() call to avoid unnecessary\n  // normalization cycles.\n  const _transform = (tr: NodeTransformer, entry: NodeEntry) => {\n    Editor.withoutNormalizing(editor, () => {\n      tr(editor, entry);\n    });\n  };\n\n  const { normalizeNode } = editor;\n\n  editor.normalizeNode = (entry) => {\n    const [node] = entry;\n    const children = getChildren(editor, entry);\n\n    // The order of validNode rules Vs validChildren doesn't matter. Slate\n    // will always perform normalization in a depth-first fashion.\n    for (const rule of rules) {\n      if (!match(node, rule.match)) {\n        continue;\n      }\n\n      // Normalize node\n      if ('validNode' in rule && !rule.validNode(editor, entry)) {\n        _transform(rule.transform as NodeTransformer, entry);\n        return;\n      }\n\n      // Normalize node.children\n      if ('validChildren' in rule) {\n        // It can not be an array since we enforced it earlier\n        const isValidChild = rule.validChildren as NodeValidator;\n\n        const invalidChildEntry = children.find((entry) => !isValidChild(editor, entry));\n\n        if (invalidChildEntry) {\n          _transform(rule.transform as NodeTransformer, invalidChildEntry);\n          return;\n        }\n      }\n    }\n\n    return normalizeNode(entry);\n  };\n\n  return editor;\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport { RenderElementProps } from 'slate-react';\n\nconst styles = {\n  [BLOCKS.PARAGRAPH]: css`\n    line-height: ${tokens.lineHeightDefault};\n    margin-bottom: 1.5em;\n  `,\n};\n\nexport function Paragraph(props: RenderElementProps) {\n  return (\n    <div {...props.attributes} className={styles[BLOCKS.PARAGRAPH]}>\n      {props.children}\n    </div>\n  );\n}\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { HotkeyPlugin, KeyboardHandler } from '@udecode/plate-core';\nimport { createParagraphPlugin as createDefaultParagraphPlugin } from '@udecode/plate-paragraph';\nimport isHotkey from 'is-hotkey';\n\nimport { isInlineOrText, toggleElement } from '../../helpers/editor';\nimport { transformUnwrap, transformLift } from '../../helpers/transformers';\nimport { RichTextEditor, RichTextPlugin } from '../../types';\nimport { Paragraph } from './Paragraph';\nimport { isEmbedElement, isEmptyElement } from './utils';\n\nconst buildParagraphKeyDownHandler: KeyboardHandler<RichTextEditor, HotkeyPlugin> =\n  (editor, { options: { hotkey } }) =>\n  (event) => {\n    if (editor.selection && hotkey && isHotkey(hotkey, event)) {\n      toggleElement(editor, { activeType: BLOCKS.PARAGRAPH, inactiveType: BLOCKS.PARAGRAPH });\n    }\n  };\n\nexport const createParagraphPlugin = (): RichTextPlugin => {\n  const config: Partial<RichTextPlugin> = {\n    type: BLOCKS.PARAGRAPH,\n    component: Paragraph,\n    options: {\n      hotkey: ['mod+opt+0'],\n    },\n    handlers: {\n      onKeyDown: buildParagraphKeyDownHandler,\n    },\n    softBreak: [\n      // create a new line with SHIFT+Enter inside a paragraph\n      {\n        hotkey: 'shift+enter',\n        query: {\n          allow: BLOCKS.PARAGRAPH,\n        },\n      },\n    ],\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['P', 'DIV'],\n        },\n      ],\n      query: (el) => !isEmptyElement(el) && !isEmbedElement(el),\n    },\n    normalizer: [\n      {\n        validChildren: (_, [node]) => isInlineOrText(node),\n        transform: {\n          [BLOCKS.PARAGRAPH]: transformUnwrap,\n          default: transformLift,\n        },\n      },\n    ],\n  };\n\n  return createDefaultParagraphPlugin(config);\n};\n","import { sanitizeSheets } from './sanitizeSheets';\n\n/**\n * Remove all <style> tags\n */\nconst stripStyleTags = (doc: Document): Document => {\n  doc.querySelectorAll('style').forEach((e) => {\n    e.remove();\n  });\n\n  return doc;\n};\n\nconst transformers = [stripStyleTags, sanitizeSheets];\n\nexport const sanitizeHTML = (html: string): string => {\n  // Parse the HTML string and pipe it through our transformers\n  const doc = transformers.reduce(\n    (value, cb) => cb(value),\n    new DOMParser().parseFromString(html, 'text/html')\n  );\n\n  return doc.body.innerHTML\n    .replace(/>\\s+</g, '><') // Remove whitespace between tags\n    .replace(/(.*)<div.*>(<table.*<\\/table>)<\\/div>(.*)/g, '$1$2$3'); // remove div containers from tables\n};\n","/**\n * Remove empty spreadsheets columns/rows for performance reasons.\n */\nexport const sanitizeSheets = (doc: Document): Document => {\n  // Ensure we are inside a spreadsheet i.e. not pasting\n  // a table from within the editor\n  const supported = [\n    // Google Sheets\n    'google-sheets-html-origin',\n    // MS Excel\n    'meta[content=\"Excel.Sheet\"]',\n    'meta[content*=\"Microsoft Excel\"]',\n  ];\n\n  if (!supported.some((selector) => !!doc.querySelector(selector))) {\n    return doc;\n  }\n\n  const isEmptyElement = (el: Element) => {\n    return (el.textContent ?? '').trim() === '';\n  };\n\n  const tables = Array.from(doc.querySelectorAll('table'));\n\n  for (const table of tables) {\n    // Remove empty columns first!\n    table.querySelectorAll('tr').forEach((row) => {\n      isEmptyElement(row) && row.remove();\n    });\n\n    const rows = Array.from(table.querySelectorAll('tr'));\n\n    // CSS :nth-of-type index starts from 1\n    let colIndex = 1;\n\n    // eslint-disable-next-line\n    while (true) {\n      const cells = rows\n        .map((row) => row.querySelector(`th:nth-of-type(${colIndex}), td:nth-of-type(${colIndex})`))\n        .filter((cell): cell is Element => !!cell);\n\n      // No more columns\n      if (cells.length === 0) {\n        break;\n      }\n\n      const isEmpty = cells.every((cell) => isEmptyElement(cell));\n\n      // Don't increment on deletion because columns will be shifted\n      // left anyway. Incrementing may result in skipping\n      if (!isEmpty) {\n        colIndex += 1;\n        continue;\n      }\n\n      cells.forEach((cell) => cell.remove());\n    }\n  }\n\n  return doc;\n};\n","import { KEY_DESERIALIZE_HTML } from '@udecode/plate-core';\n\nimport { RichTextPlugin } from '../../types';\nimport { sanitizeHTML } from './utils/sanitizeHTML';\n\n/**\n * Get x-slate-fragment attribute from data-slate-fragment\n */\nconst catchSlateFragment = /data-slate-fragment=\"(.+?)\"/m;\nexport const getSlateFragmentAttribute = (dataTransfer: DataTransfer): string | void => {\n  const htmlData = dataTransfer.getData('text/html');\n  const [, fragment] = htmlData.match(catchSlateFragment) || [];\n  return fragment;\n};\n\n/**\n * Get the x-slate-fragment attribute that exist in text/html data\n * and append it to the DataTransfer object\n */\nexport const ensureXSlateFragment = (dataTransfer: DataTransfer): DataTransfer => {\n  if (!dataTransfer.getData('application/x-slate-fragment')) {\n    const fragment = getSlateFragmentAttribute(dataTransfer);\n    if (fragment) {\n      const clipboardData = new DataTransfer();\n      dataTransfer.types.forEach((type) => {\n        clipboardData.setData(type, dataTransfer.getData(type));\n      });\n      clipboardData.setData('application/x-slate-fragment', fragment);\n      return clipboardData;\n    }\n  }\n  return dataTransfer;\n};\n\nexport const createPasteHTMLPlugin = (): RichTextPlugin => ({\n  key: 'PasteHTMLPlugin',\n  withOverrides: (editor) => {\n    const { insertData } = editor;\n    editor.insertData = (data) => insertData(ensureXSlateFragment(data));\n    return editor;\n  },\n  inject: {\n    pluginsByKey: {\n      [KEY_DESERIALIZE_HTML]: {\n        editor: {\n          insertData: {\n            format: 'text/html',\n            // Perform custom content transformation *before* pasting\n            transformData: sanitizeHTML,\n          },\n        },\n      },\n    },\n  },\n});\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\nimport { RenderElementProps } from 'slate-react';\n\nconst style = css({\n  margin: '0 0 1.3125rem',\n  borderLeft: `6px solid ${tokens.gray200}`,\n  paddingLeft: '0.875rem',\n  fontStyle: 'normal',\n});\n\nexport function Quote(props: RenderElementProps) {\n  return (\n    <blockquote {...props.attributes} className={style}>\n      {props.children}\n    </blockquote>\n  );\n}\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport {\n  getAbove,\n  getBlockAbove,\n  isAncestorEmpty,\n  isLastChild,\n  PlateEditor,\n  hasSingleChild,\n} from '@udecode/plate-core';\n\n/**\n * Returns true if we are:\n * 1) Inside a blockquote\n * 2) With no only one child paragraph/heading and\n * 3) that child is empty\n */\nexport const shouldResetQuoteOnBackspace = (editor: PlateEditor) => {\n  const container = getAbove(editor, {\n    match: { type: TEXT_CONTAINERS },\n    mode: 'lowest',\n  });\n\n  if (!container) {\n    return false;\n  }\n\n  if (!isAncestorEmpty(editor, container[0])) {\n    return false;\n  }\n\n  const quote = getBlockAbove(editor, {\n    match: { type: BLOCKS.QUOTE },\n    mode: 'lowest',\n  });\n\n  if (!quote) {\n    return false;\n  }\n\n  if (hasSingleChild(quote[0]) && isLastChild(quote, container[1])) {\n    return true;\n  }\n\n  return false;\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { HotkeyPlugin, KeyboardHandler, PlateEditor } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\nimport { Transforms, Element, Editor } from 'slate';\n\nimport { isBlockSelected } from '../../helpers/editor';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\nimport { CustomElement, RichTextEditor } from '../../types';\n\nexport function toggleQuote(\n  editor: PlateEditor,\n  logAction?: TrackingPluginActions['onShortcutAction'] | TrackingPluginActions['onToolbarAction']\n): void {\n  if (!editor.selection) return;\n\n  const isActive = isBlockSelected(editor, BLOCKS.QUOTE);\n\n  logAction?.(isActive ? 'remove' : 'insert', { nodeType: BLOCKS.QUOTE });\n\n  Editor.withoutNormalizing(editor, () => {\n    if (!editor.selection) return;\n\n    Transforms.unwrapNodes(editor, {\n      match: (node) => Element.isElement(node) && (node as CustomElement).type === BLOCKS.QUOTE,\n      split: true,\n    });\n\n    if (!isActive) {\n      const quote = {\n        type: BLOCKS.QUOTE,\n        data: {},\n        children: [],\n      };\n\n      Transforms.wrapNodes(editor, quote);\n    }\n  });\n}\n\nexport const onKeyDownToggleQuote: KeyboardHandler<RichTextEditor, HotkeyPlugin> =\n  (editor, plugin) => (event) => {\n    const { hotkey } = plugin.options;\n\n    if (hotkey && isHotkey(hotkey, event)) {\n      event.preventDefault();\n      toggleQuote(editor, editor.tracking.onShortcutAction);\n    }\n  };\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { WithOverride } from '@udecode/plate-core';\nimport { getAbove } from '@udecode/plate-core';\nimport { BaseRange, BaseSelection, Element, Node, Point, Transforms } from 'slate';\n\nimport { RichTextEditor } from '../../types';\n\nexport const withQuote: WithOverride<RichTextEditor> = (editor) => {\n  const { insertFragment } = editor;\n\n  editor.insertFragment = (fragment) => {\n    const startingNode = fragment.length && fragment[0];\n    const startsWithBlockquote =\n      Element.isElement(startingNode) && startingNode.type === BLOCKS.QUOTE;\n\n    const containerEntry = getAbove(editor, {\n      match: {\n        type: TEXT_CONTAINERS,\n      },\n    });\n    const containerIsNotEmpty = containerEntry && Node.string(containerEntry[0]) !== '';\n\n    if (startsWithBlockquote && containerIsNotEmpty) {\n      const { selection } = editor;\n      const isContentSelected = (selection: BaseSelection): selection is BaseRange =>\n        !!selection && Point.compare(selection.anchor, selection.focus) !== 0;\n      // if something is selected (highlighted) we replace the selection\n      if (isContentSelected(selection)) {\n        Transforms.delete(editor, { at: selection });\n      }\n\n      // get the cursor entry again, it may be different after deletion\n      const containerEntry = getAbove(editor, {\n        match: {\n          type: TEXT_CONTAINERS,\n        },\n      });\n\n      const containerIsNotEmpty = containerEntry && Node.string(containerEntry[0]) !== '';\n\n      if (containerIsNotEmpty) {\n        Transforms.insertNodes(editor, fragment);\n        return;\n      }\n    }\n\n    insertFragment(fragment);\n  };\n\n  return editor;\n};\n","import { BLOCKS, CONTAINERS } from '@contentful/rich-text-types';\n\nimport { transformLift, transformUnwrap } from '../../helpers/transformers';\nimport { RichTextPlugin } from '../../types';\nimport { Quote } from './components/Quote';\nimport { shouldResetQuoteOnBackspace } from './shouldResetQuote';\nimport { onKeyDownToggleQuote, toggleQuote } from './toggleQuote';\nimport { withQuote } from './withQuote';\n\nexport function createQuotePlugin(): RichTextPlugin {\n  return {\n    key: BLOCKS.QUOTE,\n    type: BLOCKS.QUOTE,\n    isElement: true,\n    component: Quote,\n    options: {\n      hotkey: 'mod+shift+1',\n    },\n    handlers: {\n      onKeyDown: onKeyDownToggleQuote,\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: 'BLOCKQUOTE',\n        },\n      ],\n    },\n    resetNode: [\n      {\n        // toggle off blockquote on backspace when it's empty\n        hotkey: 'backspace',\n        types: [BLOCKS.QUOTE],\n        predicate: shouldResetQuoteOnBackspace,\n        onReset: toggleQuote,\n      },\n    ],\n    normalizer: [\n      {\n        validChildren: CONTAINERS[BLOCKS.QUOTE],\n        transform: {\n          [BLOCKS.QUOTE]: transformUnwrap,\n          default: transformLift,\n        },\n      },\n    ],\n    withOverrides: withQuote,\n  };\n}\n","import * as React from 'react';\n\nimport { QuoteIcon } from '@contentful/f36-icons';\nimport { BLOCKS } from '@contentful/rich-text-types';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { isBlockSelected, focus } from '../../../helpers/editor';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { toggleQuote } from '../toggleQuote';\n\nexport interface ToolbarQuoteButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function ToolbarQuoteButton(props: ToolbarQuoteButtonProps) {\n  const editor = useContentfulEditor();\n\n  function handleOnClick() {\n    if (!editor) return;\n\n    toggleQuote(editor, editor.tracking.onToolbarAction);\n    focus(editor);\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"Blockquote\"\n      onClick={handleOnClick}\n      testId=\"quote-toolbar-button\"\n      isDisabled={props.isDisabled}\n      isActive={isBlockSelected(editor, BLOCKS.QUOTE)}>\n      <QuoteIcon />\n    </ToolbarButton>\n  );\n}\n","export function getCaretTopPoint() {\n  const sel = document.getSelection();\n  if (!sel) return;\n  const r = sel.getRangeAt(0);\n  let rect;\n  let r2;\n  // supposed to be textNode in most cases\n  // but div[contenteditable] when empty\n  const node = r.startContainer;\n  const offset = r.startOffset;\n  if (offset > 0) {\n    // new range, don't influence DOM state\n    r2 = document.createRange();\n    r2.setStart(node, offset - 1);\n    r2.setEnd(node, offset);\n    // https://developer.mozilla.org/en-US/docs/Web/API/range.getBoundingClientRect\n    // IE9, Safari?(but look good in Safari 8)\n    rect = r2.getBoundingClientRect();\n    return { left: rect.right, top: rect.top };\n    // @ts-expect-error\n  } else if (offset < node.length) {\n    r2 = document.createRange();\n    // similar but select next on letter\n    r2.setStart(node, offset);\n    r2.setEnd(node, offset + 1);\n    rect = r2.getBoundingClientRect();\n    return { left: rect.left, top: rect.top };\n  } else {\n    // textNode has length\n    // https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\n    // @ts-expect-error\n    rect = node.getBoundingClientRect();\n    // @ts-expect-error\n    const styles = getComputedStyle(node);\n    const lineHeight = parseInt(styles.lineHeight);\n    const fontSize = parseInt(styles.fontSize);\n    // roughly half the whitespace... but not exactly\n    const delta = (lineHeight - fontSize) / 2;\n    return { left: rect.left, top: rect.top + delta };\n  }\n}\n\nexport function closePanel(editorId: string) {\n  document.dispatchEvent(\n    new CustomEvent('close-rte-palette-commands', {\n      detail: {\n        editorId,\n      },\n    })\n  );\n}\n\nexport function openPanel(editorId: string) {\n  document.dispatchEvent(\n    new CustomEvent('open-rte-palette-commands', {\n      detail: {\n        editorId,\n      },\n    })\n  );\n}\n","import * as React from 'react';\n\nimport { Card, Text } from '@contentful/f36-components';\nimport { css } from 'emotion';\n\nimport { getCaretTopPoint } from './helpers';\n\ntype TopLeftPosition = { top: number; left: number };\n\ninterface SlashCommandsPaletteProps {\n  editorId: string;\n}\n\nconst style = {\n  container: ({ top, left }: TopLeftPosition) =>\n    css({\n      position: 'fixed',\n      top: top - 14, // 14px comes from the `Card` component padding value\n      left: left + 10, // 10px just to have a better reading\n      zIndex: 1,\n      boxShadow: '0 5px 15px rgba(0, 0, 0, 0.15)',\n      borderRadius: '8px',\n      userSelect: 'none',\n    }),\n};\n\nexport function SlashCommandsPalette({ editorId }: SlashCommandsPaletteProps) {\n  const [position, setPosition] = React.useState<TopLeftPosition | null>(null);\n  const [isOpen, setIsOpen] = React.useState(false);\n  // The user is not annoyed every time they type `/`\n  const MAX_TRIES = 3;\n  const [currentTries, setCurrentTries] = React.useState(0);\n\n  React.useEffect(() => {\n    function handler(event) {\n      if (editorId !== event.detail.editorId) return;\n\n      const topLeft = getCaretTopPoint();\n      if (!topLeft) return;\n\n      setPosition(topLeft);\n      setIsOpen(true);\n      setCurrentTries((curr) => curr + 1);\n    }\n\n    document.addEventListener('open-rte-palette-commands', handler);\n\n    return () => {\n      document.removeEventListener('open-rte-palette-commands', handler);\n    };\n  }, [editorId]);\n\n  React.useEffect(() => {\n    function handler(event) {\n      if (editorId !== event.detail.editorId) return;\n\n      closePanel();\n    }\n\n    document.addEventListener('close-rte-palette-commands', handler);\n\n    return () => document.removeEventListener('close-rte-palette-commands', handler);\n  }, [editorId]);\n\n  React.useEffect(() => {\n    if (!isOpen) return;\n\n    function handler() {\n      closePanel();\n    }\n\n    window.addEventListener('resize', handler);\n    window.addEventListener('scroll', handler, true);\n\n    return () => {\n      window.removeEventListener('resize', handler);\n      window.removeEventListener('scroll', handler, true);\n    };\n  }, [isOpen]);\n\n  function closePanel() {\n    setIsOpen(false);\n    setPosition(null);\n  }\n\n  if (!isOpen || !position || currentTries > MAX_TRIES) return null;\n\n  return (\n    <div className={style.container(position)} data-test-id=\"rte-slash-commands\">\n      <Card>\n        <Text>Slash commands are temporarily unavailable.</Text>\n      </Card>\n    </div>\n  );\n}\n","import { getPluginType, TElement, getAbove, insertNodes, someNode } from '@udecode/plate-core';\nimport { ELEMENT_TABLE, ELEMENT_TR, getEmptyRowNode } from '@udecode/plate-table';\nimport { Transforms, Path, Editor } from 'slate';\n\nimport { RichTextEditor } from '../../../types';\n\nconst addRow = (editor: RichTextEditor, getNextRowPath: (currentRowPath: Path) => Path) => {\n  if (\n    someNode(editor, {\n      match: { type: getPluginType(editor, ELEMENT_TABLE) },\n    })\n  ) {\n    const currentRowItem = getAbove(editor, {\n      match: { type: getPluginType(editor, ELEMENT_TR) },\n    });\n\n    if (currentRowItem) {\n      const [currentRowElem, currentRowPath] = currentRowItem;\n      const nextRowPath = getNextRowPath(currentRowPath);\n\n      insertNodes<TElement>(\n        editor,\n        // @ts-expect-error\n        getEmptyRowNode(editor, {\n          header: false,\n          colCount: currentRowElem.children.length,\n        }),\n        {\n          at: nextRowPath,\n          // Note: this selects the last cell of the new row\n          select: true,\n        }\n      );\n\n      // Select the first cell in the current row\n      Transforms.select(editor, Editor.start(editor, nextRowPath));\n    }\n  }\n};\n\nexport const addRowBelow = (editor: RichTextEditor) => {\n  addRow(editor, (currentRowPath) => {\n    return Path.next(currentRowPath);\n  });\n};\n\nexport const addRowAbove = (editor: RichTextEditor) => {\n  addRow(editor, (currentRowPath) => {\n    // The new row will be in in-place of the old row\n    return currentRowPath;\n  });\n};\n","import { getPluginType, TElement, getAbove, insertNodes, someNode } from '@udecode/plate-core';\nimport {\n  getEmptyCellNode,\n  TablePluginOptions,\n  ELEMENT_TABLE,\n  ELEMENT_TD,\n  ELEMENT_TH,\n} from '@udecode/plate-table';\nimport { Path } from 'slate';\n\nimport { RichTextEditor } from '../../../types';\n\nconst addColumn = (\n  editor: RichTextEditor,\n  { header }: TablePluginOptions,\n  getNextCellPath: (currentCellPath: Path) => Path\n) => {\n  if (\n    someNode(editor, {\n      match: { type: getPluginType(editor, ELEMENT_TABLE) },\n    })\n  ) {\n    const currentCellItem = getAbove(editor, {\n      match: {\n        type: [getPluginType(editor, ELEMENT_TD), getPluginType(editor, ELEMENT_TH)],\n      },\n    });\n\n    const currentTableItem = getAbove(editor, {\n      match: { type: getPluginType(editor, ELEMENT_TABLE) },\n    });\n\n    if (currentCellItem && currentTableItem) {\n      const nextCellPath = getNextCellPath(currentCellItem[1]);\n      const newCellPath = nextCellPath.slice();\n      const replacePathPos = newCellPath.length - 2;\n\n      currentTableItem[0].children.forEach((_, rowIdx) => {\n        newCellPath[replacePathPos] = rowIdx;\n\n        insertNodes<TElement>(\n          editor,\n          // @ts-expect-error\n          getEmptyCellNode(editor, { header: header && rowIdx === 0 }),\n          {\n            at: newCellPath,\n            // Select the first cell of the new column\n            select: rowIdx === 0,\n          }\n        );\n      });\n    }\n  }\n};\n\nexport const addColumnRight = (editor: RichTextEditor, options: TablePluginOptions) => {\n  addColumn(editor, options, (currentCellPath) => Path.next(currentCellPath));\n};\n\nexport const addColumnLeft = (editor: RichTextEditor, options: TablePluginOptions) => {\n  addColumn(editor, options, (currentCellPath) => currentCellPath);\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { getParent } from '@udecode/plate-core';\nimport { getAbove, getChildren, isFirstChild, isAncestorEmpty } from '@udecode/plate-core';\nimport {\n  ELEMENT_TABLE,\n  ELEMENT_TH,\n  ELEMENT_TD,\n  ELEMENT_TR,\n  insertTable,\n} from '@udecode/plate-table';\nimport { Element, Node, NodeEntry } from 'slate';\nimport { Transforms, Path, Editor, Ancestor } from 'slate';\n\nimport { isBlockSelected, getAncestorPathFromSelection } from '../../helpers/editor';\nimport { CustomElement, RichTextEditor, TextOrCustomElement } from '../../types';\n\nexport function insertTableAndFocusFirstCell(editor: RichTextEditor): void {\n  insertTable(editor, { header: true });\n  replaceEmptyParagraphWithTable(editor);\n}\n\nexport function isTableActive(editor: RichTextEditor) {\n  const tableElements = [ELEMENT_TABLE, ELEMENT_TH, ELEMENT_TR, ELEMENT_TD];\n  return tableElements.some((el) => isBlockSelected(editor, el));\n}\n\nexport function isTableHeaderEnabled(editor: RichTextEditor) {\n  const tableItem = getAbove(editor, {\n    match: {\n      type: BLOCKS.TABLE,\n    },\n  });\n\n  if (!tableItem) {\n    return false;\n  }\n\n  const firstRow = getChildren(tableItem)[0];\n\n  if (!firstRow) {\n    return false;\n  }\n\n  return getChildren(firstRow).every(([node]) => {\n    return node.type === BLOCKS.TABLE_HEADER_CELL;\n  });\n}\n\nexport function replaceEmptyParagraphWithTable(editor: RichTextEditor) {\n  const tablePath = getAncestorPathFromSelection(editor);\n  if (!tablePath || isFirstChild(tablePath)) return;\n\n  const previousPath = Path.previous(tablePath);\n  if (!previousPath) return;\n\n  const [nodes] = Editor.nodes(editor, {\n    at: previousPath,\n    match: (node) => (node as CustomElement).type === BLOCKS.PARAGRAPH,\n  });\n  if (!nodes) return;\n\n  const [previousNode] = nodes;\n  const isPreviousNodeTextEmpty = isAncestorEmpty(editor, previousNode as Ancestor);\n  if (isPreviousNodeTextEmpty) {\n    // Switch table with previous empty paragraph\n    Transforms.moveNodes(editor, { at: tablePath, to: previousPath });\n    // Remove previous paragraph that now is under the table\n    Transforms.removeNodes(editor, { at: tablePath });\n  }\n}\n\n/**\n * Returns the number of cells in a given row vs the table width\n *\n * Note: We should only get different table rows cell counts in between\n * normalization cycles.\n */\nexport const getNoOfMissingTableCellsInRow = (editor: RichTextEditor, [, rowPath]: NodeEntry) => {\n  const parent = getParent(editor, rowPath);\n\n  // This is ensured by normalization. The error is here just in case\n  if (!parent) {\n    throw new Error('table rows must be wrapped in a table node');\n  }\n\n  const [, tablePath] = parent;\n\n  // The longest table row determines its width\n  const tableWidth = Math.max(\n    ...Array.from(Node.children(editor, tablePath)).map(\n      ([, path]) => Array.from(Node.children(editor, path)).length\n    )\n  );\n\n  const rowWidth = Array.from(Node.children(editor, rowPath)).length;\n\n  return tableWidth - rowWidth;\n};\n\nexport const createEmptyTableCells = (count: number): Node[] => {\n  const emptyTableCell = {\n    type: BLOCKS.TABLE_CELL,\n    data: {},\n    children: [\n      {\n        type: BLOCKS.PARAGRAPH,\n        data: {},\n        children: [{ text: '' }],\n      },\n    ],\n  };\n\n  return new Array(count).fill(emptyTableCell);\n};\n\nexport const isNotEmpty = (editor: RichTextEditor, [, path]: NodeEntry) => {\n  return Array.from(Node.children(editor, path)).length !== 0;\n};\n\nexport const isTable = (node: TextOrCustomElement) => {\n  return Element.isElement(node) && node.type === BLOCKS.TABLE;\n};\n","import React from 'react';\n\nimport { IconButton, Menu } from '@contentful/f36-components';\nimport { ChevronDownIcon } from '@contentful/f36-icons';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { getAbove } from '@udecode/plate-core';\nimport { TablePluginOptions, deleteColumn, deleteRow, deleteTable } from '@udecode/plate-table';\nimport { css } from 'emotion';\nimport { Editor } from 'slate';\nimport * as Slate from 'slate-react';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { getNodeEntryFromSelection, getTableSize } from '../../../helpers/editor';\nimport { RichTextTrackingActionName } from '../../../plugins/Tracking';\nimport { RichTextEditor } from '../../../types';\nimport { addRowAbove, addColumnLeft, addColumnRight, addRowBelow, setHeader } from '../actions';\nimport { isTableHeaderEnabled } from '../helpers';\n\nexport const styles = {\n  topRight: css({\n    position: 'absolute',\n    top: '6px',\n    right: '5px',\n  }),\n};\n\nconst getCurrentTableSize = (\n  editor: RichTextEditor\n): Record<'numRows' | 'numColumns', number> | null => {\n  const [table] = getNodeEntryFromSelection(editor, BLOCKS.TABLE);\n  return table ? getTableSize(table) : null;\n};\n\ntype TableAction = (editor: RichTextEditor, options: TablePluginOptions) => void;\n\nexport const TableActions = () => {\n  const editor = useContentfulEditor();\n  const isDisabled = Slate.useReadOnly();\n  const [isOpen, setOpen] = React.useState(false);\n  const [isHeaderEnabled, setHeaderEnabled] = React.useState(false);\n\n  const close = React.useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  React.useEffect(() => {\n    setHeaderEnabled(Boolean(editor && isTableHeaderEnabled(editor)));\n  }, [editor]);\n\n  const canInsertRowAbove = React.useMemo(() => {\n    if (!editor) {\n      return false;\n    }\n\n    const headerCell = getAbove(editor, {\n      match: {\n        type: BLOCKS.TABLE_HEADER_CELL,\n      },\n    });\n\n    return !headerCell;\n  }, [editor]);\n\n  const toggleHeader = React.useCallback(() => {\n    close();\n\n    if (!editor) {\n      return;\n    }\n\n    const value = !isHeaderEnabled;\n\n    setHeaderEnabled(value);\n    setHeader(editor, value);\n  }, [editor, close, isHeaderEnabled]);\n\n  const action = React.useCallback(\n    (cb: TableAction, type: 'insert' | 'remove', element: 'Table' | 'Row' | 'Column') => () => {\n      if (!editor?.selection) return;\n      close();\n\n      const tableSize = getCurrentTableSize(editor);\n\n      Editor.withoutNormalizing(editor, () => {\n        cb(editor, { header: isHeaderEnabled });\n      });\n      // Tracking\n      const actionName = `${type}Table${element === 'Table' ? '' : element}`;\n      editor.tracking.onViewportAction(actionName as RichTextTrackingActionName, { tableSize });\n    },\n    [editor, isHeaderEnabled, close]\n  );\n\n  if (isDisabled) {\n    return null;\n  }\n\n  return (\n    <Menu\n      placement=\"left\"\n      isOpen={isOpen}\n      onOpen={() => {\n        setOpen(true);\n      }}\n      onClose={close}>\n      <Menu.Trigger>\n        <IconButton\n          size=\"small\"\n          variant=\"transparent\"\n          tabIndex={-1}\n          className={styles.topRight}\n          icon={<ChevronDownIcon />}\n          aria-label=\"Open table menu\"\n          testId=\"cf-table-actions-button\"\n        />\n      </Menu.Trigger>\n      <Menu.List>\n        <Menu.Item onClick={action(addRowAbove, 'insert', 'Row')} disabled={!canInsertRowAbove}>\n          Add row above\n        </Menu.Item>\n        <Menu.Item onClick={action(addRowBelow, 'insert', 'Row')}>Add row below</Menu.Item>\n        <Menu.Item onClick={action(addColumnLeft, 'insert', 'Column')}>Add column left</Menu.Item>\n        <Menu.Item onClick={action(addColumnRight, 'insert', 'Column')}>Add column right</Menu.Item>\n        <Menu.Divider />\n        <Menu.Item onClick={toggleHeader}>\n          {isHeaderEnabled ? 'Disable table header' : 'Enable table header'}\n        </Menu.Item>\n        <Menu.Divider />\n        <Menu.Item onClick={action(deleteRow, 'remove', 'Row')}>Delete row</Menu.Item>\n        <Menu.Item onClick={action(deleteColumn, 'remove', 'Column')}>Delete column</Menu.Item>\n        <Menu.Item onClick={action(deleteTable, 'remove', 'Table')}>Delete table</Menu.Item>\n      </Menu.List>\n    </Menu>\n  );\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { getAbove, setNodes, getChildren } from '@udecode/plate-core';\n\nimport { RichTextEditor } from '../../../types';\n\nexport const setHeader = (editor: RichTextEditor, enable?: boolean) => {\n  const tableItem = getAbove(editor, {\n    match: { type: BLOCKS.TABLE },\n  });\n\n  if (!tableItem) {\n    return;\n  }\n\n  const firstRow = getChildren(tableItem)[0];\n\n  if (!firstRow) {\n    return;\n  }\n\n  getChildren(firstRow).forEach(([, path]) => {\n    setNodes(\n      editor,\n      {\n        type: enable ? BLOCKS.TABLE_HEADER_CELL : BLOCKS.TABLE_CELL,\n      },\n      { at: path }\n    );\n  });\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { TableCell } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nimport { TableActions } from './TableActions';\n\nconst style = css`\n  border: 1px solid ${tokens.gray400};\n  border-collapse: collapse;\n  padding: 10px 12px;\n  min-width: 48px;\n  position: relative;\n  vertical-align: top;\n\n  div:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const Cell = (props: Slate.RenderElementProps) => {\n  const isSelected = Slate.useSelected();\n\n  return (\n    <td\n      {...props.attributes}\n      // may include `colspan` and/or `rowspan`\n      {...(props.element.data as TableCell['data'])}\n      className={style}>\n      {isSelected && <TableActions />}\n      {props.children}\n    </td>\n  );\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { TableHeaderCell } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nimport { TableActions } from './TableActions';\n\nconst style = css`\n  background-clip: padding-box;\n  background-color: ${tokens.gray200};\n  border: 1px solid ${tokens.gray400};\n  border-collapse: collapse;\n  padding: 10px 12px;\n  font-weight: ${tokens.fontWeightNormal};\n  text-align: left;\n  min-width: 48px;\n  position: relative;\n\n  div:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const HeaderCell = (props: Slate.RenderElementProps) => {\n  const isSelected = Slate.useSelected();\n\n  return (\n    <th\n      {...props.attributes}\n      // may include `colspan` and/or `rowspan`\n      {...(props.element.data as TableHeaderCell['data'])}\n      className={style}>\n      {isSelected && <TableActions />}\n      {props.children}\n    </th>\n  );\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst style = css`\n  border: 1px solid ${tokens.gray400};\n  border-collapse: collapse;\n\n  &:hover td {\n    background-color: transparent !important;\n  }\n`;\n\nexport const Row = (props: Slate.RenderElementProps) => (\n  <tr {...props.attributes} className={style}>\n    {props.children}\n  </tr>\n);\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst style = css`\n  margin-bottom: 1.5em;\n  border-collapse: collapse;\n  border-radius: 5px;\n  border-style: hidden;\n  box-shadow: 0 0 0 1px ${tokens.gray400};\n  width: 100%;\n  table-layout: fixed;\n  overflow: hidden;\n`;\n\nexport const Table = (props: Slate.RenderElementProps) => {\n  return (\n    <div data-block-type={BLOCKS.TABLE}>\n      <table className={style} {...props.attributes}>\n        <tbody>{props.children}</tbody>\n      </table>\n    </div>\n  );\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { getText } from '@udecode/plate-core';\nimport { Element, Node } from 'slate';\n\nimport { insertEmptyParagraph } from '../../helpers/editor';\nimport { CustomElement, RichTextEditor } from '../../types';\nimport { isTable } from './helpers';\n\n/**\n * Removes table wrappers when pasting a single table cell\n *\n * In Plate/Slate, copying the content of a table cell wraps\n * it in a <table><tr><td>{content}</td></tr></table> even\n * when copying partial cell content.\n *\n * That's really annoying as there is no way to remove the table\n * wrappers in that case.\n */\nconst trimUnnecessaryTableWrapper = (node: Node): Node[] => {\n  if (!Element.isElement(node)) {\n    return [node];\n  }\n\n  // must be a table with a single row\n  if (node.type !== BLOCKS.TABLE || node.children?.length !== 1) {\n    return [node];\n  }\n\n  const row = node.children[0] as CustomElement;\n\n  // the row must contain a single cell\n  if (row?.children?.length !== 1) {\n    return [node];\n  }\n\n  const cell = row.children[0] as CustomElement;\n\n  return cell.children;\n};\n\nexport const insertTableFragment = (editor: RichTextEditor) => {\n  const { insertFragment } = editor;\n\n  return (fragments: Node[]) => {\n    if (!editor.selection) {\n      return;\n    }\n\n    fragments = fragments.flatMap(trimUnnecessaryTableWrapper);\n\n    // We need to make sure we have a new, empty and clean paragraph in order to paste tables as-is due to how Slate behaves\n    // More info: https://github.com/ianstormtaylor/slate/pull/4489 and https://github.com/ianstormtaylor/slate/issues/4542\n    const isInsertingTable = fragments.some((fragment) => isTable(fragment as CustomElement));\n    const isTableFirstFragment =\n      fragments.findIndex((fragment) => isTable(fragment as CustomElement)) === 0;\n    const currentLineHasText = getText(editor, editor.selection?.focus.path) !== '';\n\n    if (isInsertingTable && isTableFirstFragment && currentLineHasText) {\n      insertEmptyParagraph(editor);\n    }\n\n    return insertFragment(fragments);\n  };\n};\n","import { KeyboardEvent } from 'react';\n\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  HotkeyPlugin,\n  KeyboardHandler,\n  WithPlatePlugin,\n  getAbove,\n  isLastChild,\n} from '@udecode/plate-core';\nimport { getTableCellEntry, onKeyDownTable as defaultKeyDownTable } from '@udecode/plate-table';\n\nimport { insertEmptyParagraph } from '../../helpers/editor';\nimport { RichTextEditor } from '../../types';\nimport { addRowBelow } from './actions';\n\nexport const onKeyDownTable: KeyboardHandler<RichTextEditor, HotkeyPlugin> = (editor, plugin) => {\n  const defaultHandler = defaultKeyDownTable(editor, plugin as WithPlatePlugin);\n\n  return (event: KeyboardEvent) => {\n    // This fixes `Cannot resolve a Slate point from DOM point: [object HTMLDivElement]` when typing while the cursor is before table\n    const windowSelection = window.getSelection();\n    if (windowSelection) {\n      // @ts-expect-error\n      const blockType = windowSelection.anchorNode.attributes?.['data-block-type']?.value; // this attribute comes from `plugins/Table/components/Table.tsx`\n      const isBeforeTable = blockType === BLOCKS.TABLE;\n\n      if (isBeforeTable) {\n        if (event.key === 'Enter') {\n          const above = getAbove(editor, { match: { type: BLOCKS.TABLE } });\n\n          if (!above) return;\n\n          const [, tablePath] = above;\n\n          insertEmptyParagraph(editor, { at: tablePath, select: true });\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        return;\n      }\n    }\n\n    // Pressing Tab on the last cell creates a new row\n    // Otherwise, jumping between cells is handled in the defaultKeyDownTable\n    if (event.key === 'Tab' && !event.shiftKey) {\n      event.preventDefault();\n      const res = getTableCellEntry(editor, {});\n\n      if (res) {\n        const { tableElement, tableRow, tableCell } = res;\n\n        const isLastCell = isLastChild(tableRow, tableCell[1]);\n        const isLastRow = isLastChild(tableElement, tableRow[1]);\n\n        if (isLastRow && isLastCell) {\n          addRowBelow(editor);\n\n          // skip default handler\n          return;\n        }\n      }\n    }\n\n    defaultHandler(event);\n  };\n};\n","import {\n  BLOCKS,\n  INLINES,\n  TOP_LEVEL_BLOCKS,\n  VOID_BLOCKS,\n  CONTAINERS,\n} from '@contentful/rich-text-types';\n\nconst inlines = Object.values(INLINES).map((type) => ({ type }));\n\nexport default {\n  document: {\n    nodes: [\n      {\n        types: TOP_LEVEL_BLOCKS.map((type) => ({ type })),\n      },\n    ],\n  },\n\n  blocks: {\n    [BLOCKS.PARAGRAPH]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_1]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_2]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_3]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_4]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_5]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_6]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n\n    ...VOID_BLOCKS.reduce(\n      (blocks, nodeType) => ({\n        ...blocks,\n        [nodeType]: { isVoid: true },\n      }),\n      {}\n    ),\n\n    // TODO: add list schema\n\n    [BLOCKS.QUOTE]: {\n      nodes: [\n        {\n          match: [CONTAINERS[BLOCKS.QUOTE].map((type) => ({ type }))],\n          min: 1,\n        },\n      ],\n      normalize: (editor, error) => {\n        if (error.code === 'child_type_invalid') {\n          return editor.unwrapBlockByKey(error.node.key, BLOCKS.QUOTE);\n        }\n      },\n    },\n  },\n\n  inlines: {\n    [INLINES.HYPERLINK]: {\n      nodes: [\n        {\n          match: [{ object: 'text' }],\n        },\n      ],\n    },\n    [INLINES.ENTRY_HYPERLINK]: {\n      nodes: [\n        {\n          match: [{ object: 'text' }],\n        },\n      ],\n    },\n    [INLINES.ASSET_HYPERLINK]: {\n      nodes: [\n        {\n          match: [{ object: 'text' }],\n        },\n      ],\n    },\n    [INLINES.EMBEDDED_ENTRY]: {\n      isVoid: true,\n    },\n  },\n};\n","import * as contentfulSlateJSAdapter from '@contentful/contentful-slatejs-adapter';\nimport { documentToPlainTextString } from '@contentful/rich-text-plain-text-renderer';\n\nimport Schema from '../../constants/Schema';\nimport { RichTextEditor } from '../../types';\n\nexport function getCharacterCount(editor: RichTextEditor) {\n  const document = contentfulSlateJSAdapter.toContentfulDocument({\n    document: editor.children,\n    schema: Schema,\n  });\n\n  return documentToPlainTextString(document).length;\n}\n","import { RichTextPlugin } from '../../types';\nimport { getCharacterCount } from './utils';\n\nexport type RichTextTrackingActionName =\n  // Elements\n  | 'edit'\n  | 'insert'\n  | 'remove'\n  // Marks\n  | 'mark'\n  | 'unmark'\n  // Tables\n  | 'insertTable'\n  | 'insertTableRow'\n  | 'insertTableColumn'\n  | 'removeTable'\n  | 'removeTableRow'\n  | 'removeTableColumn'\n  // Copy & Paste\n  | 'paste'\n  | 'invalidTablePaste'\n  // Hyperlinks\n  | 'cancelCreateHyperlinkDialog'\n  | 'cancelEditHyperlinkDialog'\n  | 'linkRendered'\n  | 'openCreateHyperlinkDialog'\n  | 'openEditHyperlinkDialog'\n  | 'unlinkHyperlinks'\n  // Embeds\n  | 'openCreateEmbedDialog'\n  | 'cancelCreateEmbedDialog';\n\nexport type RichTextTrackingActionHandler = (\n  name: RichTextTrackingActionName,\n  data: Record<string, unknown>\n) => unknown;\n\nexport interface TrackingPluginActions {\n  onViewportAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n\n  onShortcutAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n\n  onToolbarAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n\n  onCommandPaletteAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n}\n\nconst actionOrigin = {\n  TOOLBAR: 'toolbar-icon',\n  SHORTCUT: 'shortcut',\n  VIEWPORT: 'viewport-interaction',\n  COMMAND_PALETTE: 'command-palette',\n};\n\nexport function getPastingSource(data: DataTransfer) {\n  const textHtml = data.getData('text/html');\n  const doc = new DOMParser().parseFromString(textHtml, 'text/html');\n\n  if (doc.querySelector('[id*=\"docs-internal-guid\"]')) {\n    return 'Google Docs';\n  }\n\n  if (doc.querySelector('google-sheets-html-origin') || doc.querySelector('[data-sheets-value]')) {\n    return 'Google Spreadsheets';\n  }\n\n  if (doc.querySelector('meta[content*=\"Microsoft Excel\"]')) {\n    return 'Microsoft Excel';\n  }\n\n  if (doc.querySelector('meta[content*=\"Microsoft Word\"]')) {\n    return 'Microsoft Word';\n  }\n\n  // TODO: MS Word Online doesn't give us specific tags, we might need to have a closer look at its tracking result since we are using generic values to identify it\n  if (\n    doc.querySelector('[style*=\"Arial_MSFontService\"]') &&\n    (doc.querySelector('.TextRun') || doc.querySelector('.OutlineElement'))\n  ) {\n    return 'Microsoft Word Online';\n  }\n\n  if (doc.querySelector('meta[content=\"Cocoa HTML Writer\"]')) {\n    return 'Apple Notes';\n  }\n\n  if (doc.querySelector('[style*=\"Slack-Lato, Slack-Fractions\"]')) {\n    return 'Slack';\n  }\n\n  return 'Unknown';\n}\n\nexport const createTrackingPlugin = (onAction: RichTextTrackingActionHandler): RichTextPlugin => {\n  const trackingActions: TrackingPluginActions = {\n    onViewportAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, { origin: actionOrigin.VIEWPORT, ...data }),\n\n    onShortcutAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, { origin: actionOrigin.SHORTCUT, ...data }),\n\n    onToolbarAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, { origin: actionOrigin.TOOLBAR, ...data }),\n\n    onCommandPaletteAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, {\n        origin: actionOrigin.COMMAND_PALETTE,\n        ...data,\n      }),\n  };\n\n  return {\n    key: 'TrackingPlugin',\n    withOverrides: (editor) => {\n      const { insertData } = editor;\n\n      editor.tracking = trackingActions;\n\n      editor.insertData = (data) => {\n        const isCopyAndPaste = data.types.length !== 0;\n        if (isCopyAndPaste) {\n          const characterCountSelection = window.getSelection()?.toString().length;\n          const characterCountBefore = getCharacterCount(editor);\n\n          setTimeout(() => {\n            const characterCountAfter = getCharacterCount(editor);\n\n            trackingActions.onShortcutAction('paste', {\n              characterCountAfter,\n              characterCountBefore,\n              characterCountSelection,\n              source: getPastingSource(data),\n            });\n          });\n        }\n\n        insertData(data);\n      };\n\n      return editor;\n    },\n  };\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { Element } from 'slate';\n\nimport { getPastingSource } from '../../plugins/Tracking';\nimport { CustomElement, RichTextEditor } from '../../types';\nimport type { NodeTransformer } from '../Normalizer';\n\nfunction hasTables(nodes: CustomElement[]) {\n  return nodes.some(({ type }) => {\n    return type === BLOCKS.TABLE;\n  });\n}\n\nconst isTableHeaderCell = ({ type }) => type === BLOCKS.TABLE_HEADER_CELL;\n\nfunction hasHeadersOutsideFirstRow(nodes: CustomElement[]) {\n  return nodes\n    .filter(({ type }) => type === BLOCKS.TABLE)\n    .flatMap(({ children }) => children.slice(1) as CustomElement[])\n    .some(({ children }) => (children as CustomElement[]).some(isTableHeaderCell));\n}\n\nexport function addTableTrackingEvents(editor: RichTextEditor) {\n  const { insertData } = editor;\n  editor.insertData = (data: DataTransfer) => {\n    const html = data.getData('text/html');\n\n    if (html) {\n      const { children: markupBefore } = editor;\n      insertData(data);\n      const { children: markupAfter } = editor;\n      setTimeout(() => {\n        if (hasTables(markupBefore)) return;\n        if (hasTables(markupAfter)) {\n          editor.tracking.onViewportAction('paste', {\n            tablePasted: true,\n            source: getPastingSource(data),\n            hasHeadersOutsideFirstRow: hasHeadersOutsideFirstRow(markupAfter),\n          });\n        }\n      }, 1);\n    } else {\n      insertData(data);\n    }\n  };\n}\n\nexport const withInvalidCellChildrenTracking = (transformer: NodeTransformer): NodeTransformer => {\n  return (editor, childEntry) => {\n    const [node] = childEntry;\n\n    if (Element.isElement(node)) {\n      editor.tracking?.onViewportAction('invalidTablePaste', {\n        nodeType: node.type,\n      });\n    }\n\n    return transformer(editor, childEntry);\n  };\n};\n","import { BLOCKS, CONTAINERS } from '@contentful/rich-text-types';\nimport { getBlockAbove, getParent, getLastChildPath, WithPlatePlugin } from '@udecode/plate-core';\nimport {\n  createTablePlugin as createDefaultTablePlugin,\n  ELEMENT_TABLE,\n  ELEMENT_TD,\n  ELEMENT_TH,\n  ELEMENT_TR,\n  withTable,\n} from '@udecode/plate-table';\nimport { NodeEntry, Path, Transforms } from 'slate';\n\nimport { isRootLevel } from '../../helpers/editor';\nimport { transformLift, transformParagraphs, transformWrapIn } from '../../helpers/transformers';\nimport { RichTextPlugin, CustomElement, RichTextEditor } from '../../types';\nimport { Cell } from './components/Cell';\nimport { HeaderCell } from './components/HeaderCell';\nimport { Row } from './components/Row';\nimport { Table } from './components/Table';\nimport { createEmptyTableCells, getNoOfMissingTableCellsInRow, isNotEmpty } from './helpers';\nimport { insertTableFragment } from './insertTableFragment';\nimport { onKeyDownTable } from './onKeyDownTable';\nimport { addTableTrackingEvents, withInvalidCellChildrenTracking } from './tableTracking';\n\nexport const createTablePlugin = (): RichTextPlugin =>\n  createDefaultTablePlugin({\n    type: BLOCKS.TABLE,\n    handlers: {\n      onKeyDown: onKeyDownTable,\n    },\n    withOverrides: (editor, plugin) => {\n      // injects important fixes from plate's original table plugin\n      withTable(editor, plugin as WithPlatePlugin<{}, {}>);\n\n      addTableTrackingEvents(editor as RichTextEditor);\n\n      editor.insertFragment = insertTableFragment(editor);\n\n      return editor;\n    },\n    overrideByKey: {\n      [ELEMENT_TABLE]: {\n        type: BLOCKS.TABLE,\n        component: Table,\n        normalizer: [\n          {\n            validNode: isNotEmpty,\n          },\n          {\n            // Move to root level unless nested\n            validNode: (editor, [, path]) => {\n              const isNestedTable = !!getBlockAbove(editor, {\n                at: path,\n                match: {\n                  type: [BLOCKS.TABLE_CELL, BLOCKS.TABLE_HEADER_CELL],\n                },\n              });\n\n              return isRootLevel(path) || isNestedTable;\n            },\n            transform: transformLift,\n          },\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE],\n          },\n        ],\n      },\n      [ELEMENT_TR]: {\n        type: BLOCKS.TABLE_ROW,\n        component: Row,\n        normalizer: [\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE_ROW],\n            transform: transformWrapIn(BLOCKS.TABLE_CELL),\n          },\n          {\n            // Remove empty rows\n            validNode: isNotEmpty,\n          },\n          {\n            // Parent must be a table\n            validNode: (editor, [, path]) => {\n              const parent = getParent(editor, path)?.[0];\n              return parent && parent.type === BLOCKS.TABLE;\n            },\n            transform: transformWrapIn(BLOCKS.TABLE),\n          },\n          {\n            // ensure consistent number of cells in each row\n            validNode: (editor, entry) => {\n              return getNoOfMissingTableCellsInRow(editor, entry) === 0;\n            },\n            transform: (editor, entry) => {\n              const howMany = getNoOfMissingTableCellsInRow(editor, entry);\n              const at = Path.next(getLastChildPath(entry as NodeEntry<CustomElement>));\n\n              Transforms.insertNodes(editor, createEmptyTableCells(howMany), {\n                at,\n              });\n            },\n          },\n        ],\n      },\n      [ELEMENT_TH]: {\n        type: BLOCKS.TABLE_HEADER_CELL,\n        component: HeaderCell,\n        normalizer: [\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE_HEADER_CELL],\n            transform: withInvalidCellChildrenTracking(transformParagraphs),\n          },\n        ],\n      },\n      [ELEMENT_TD]: {\n        type: BLOCKS.TABLE_CELL,\n        component: Cell,\n        normalizer: [\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE_CELL],\n            transform: withInvalidCellChildrenTracking(transformParagraphs),\n          },\n        ],\n      },\n    } as Record<string, Partial<RichTextPlugin>>,\n  });\n","import * as React from 'react';\n\nimport { TableIcon } from '@contentful/f36-icons';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { focus } from '../../../helpers/editor';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { insertTableAndFocusFirstCell, isTableActive } from './../helpers';\n\nexport interface ToolbarTableButtonProps {\n  isDisabled: boolean | undefined;\n}\n\nexport function ToolbarTableButton(props: ToolbarTableButtonProps) {\n  const editor = useContentfulEditor();\n  const isActive = editor && isTableActive(editor);\n\n  async function handleClick() {\n    if (!editor) return;\n\n    editor.tracking.onToolbarAction('insertTable');\n    insertTableAndFocusFirstCell(editor);\n    focus(editor);\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"Table\"\n      testId=\"table-toolbar-button\"\n      onClick={handleClick}\n      // TODO: active state looks off since the button will be disabled. Do we still need it?\n      isActive={isActive}\n      isDisabled={props.isDisabled}>\n      <TableIcon />\n    </ToolbarButton>\n  );\n}\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { getAbove, isAncestorEmpty, queryNode, TNode } from '@udecode/plate-core';\nimport { Editor, Ancestor, Transforms, Range, Location } from 'slate';\n\nimport { RichTextEditor, RichTextPlugin } from '../../types';\n\nexport function createTextPlugin(): RichTextPlugin {\n  return {\n    key: 'TextPlugin',\n    handlers: {\n      // Triple selection in a non-Firefox browser undesirably selects\n      // the start of the next block. Editor.unhangRange helps removing\n      // the extra block at the end.\n      onMouseUp: (editor) => () => {\n        if (!editor.selection) {\n          return;\n        }\n\n        Transforms.setSelection(editor, Editor.unhangRange(editor, editor.selection));\n      },\n    },\n    withOverrides: (editor) => {\n      // Reverts the change made upstream that caused the cursor\n      // to be trapped inside inline elements.\n      //\n      // Reverts https://github.com/ianstormtaylor/slate/pull/4578/\n      // Related https://github.com/ianstormtaylor/slate/issues/4704\n      const { insertText } = editor;\n\n      editor.insertText = (text) => {\n        const { selection } = editor;\n\n        // If the cursor is at the end of an inline, move it outside\n        // before inserting\n        if (selection && Range.isCollapsed(selection)) {\n          const inlinePath = Editor.above(editor, {\n            match: (n) => Editor.isInline(editor, n),\n            mode: 'highest',\n          })?.[1];\n\n          if (inlinePath && Editor.isEnd(editor, selection.anchor, inlinePath)) {\n            const point = Editor.after(editor, inlinePath);\n            Transforms.setSelection(editor, {\n              anchor: point,\n              focus: point,\n            });\n          }\n        }\n\n        return insertText(text);\n      };\n\n      // When pressing delete instead of backspace\n      const { deleteForward, deleteBackward } = editor;\n\n      editor.deleteBackward = (unit) => {\n        deleteEmptyParagraph(unit, editor, deleteBackward);\n      };\n\n      editor.deleteForward = (unit) => {\n        deleteEmptyParagraph(unit, editor, deleteForward);\n      };\n\n      fixPasteAsPlainText(editor);\n\n      return editor;\n    },\n  };\n}\n\nfunction deleteEmptyParagraph(\n  unit: 'character' | 'word' | 'line' | 'block',\n  editor: RichTextEditor,\n  deleteFunction: Function\n) {\n  const entry = getAbove(editor, {\n    match: {\n      type: TEXT_CONTAINERS,\n    },\n  });\n\n  if (entry) {\n    const [paragraphOrHeading, path] = entry;\n    const isTextEmpty = isAncestorEmpty(editor, paragraphOrHeading as Ancestor);\n    // We ignore paragraphs/headings that are children of ul, ol, blockquote, tables, etc\n    const isRootLevel = path.length === 1;\n    const hasSiblings = editor.children.length > 1; // prevent editor from losing focus\n\n    if (isTextEmpty && isRootLevel && hasSiblings) {\n      Transforms.removeNodes(editor, { at: path });\n\n      const prevNode = Editor.before(editor, editor.selection as Location, {\n        unit,\n      });\n\n      if (prevNode) {\n        const [prevCell] = Editor.nodes<TNode>(editor, {\n          match: (node) =>\n            queryNode([node as TNode, prevNode.path], {\n              allow: [BLOCKS.EMBEDDED_ASSET, BLOCKS.EMBEDDED_ENTRY, BLOCKS.HR],\n            }),\n          at: prevNode,\n        });\n\n        if (prevCell) {\n          Transforms.select(editor, prevNode);\n        }\n      }\n    } else {\n      deleteFunction(unit);\n    }\n  } else {\n    deleteFunction(unit);\n  }\n}\n\n/**\n * To be compatible with the old behavior we need to treat each 2 consecutive\n * line breaks as a new paragraph when pasting as plain text (also known as\n * paste and match style in macOS)\n */\nfunction fixPasteAsPlainText(editor: RichTextEditor) {\n  editor.insertTextData = (data: DataTransfer): boolean => {\n    const text = data.getData('text/plain');\n\n    if (!text) {\n      return false;\n    }\n\n    const lines = text.split(/\\n{2}/);\n    let split = false;\n\n    for (const line of lines) {\n      // empty lines\n      if (/^(\\r\\n?|\\n)$/.test(line)) {\n        continue;\n      }\n\n      if (split) {\n        Transforms.splitNodes(editor, { always: true });\n      }\n\n      editor.insertText(line);\n      split = true;\n    }\n\n    return true;\n  };\n}\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { createTrailingBlockPlugin } from '@udecode/plate-trailing-block';\n\nimport { RichTextPlugin } from '../../types';\n\nexport const createTrailingParagraphPlugin = (): RichTextPlugin => {\n  return createTrailingBlockPlugin({\n    options: {\n      type: BLOCKS.PARAGRAPH,\n      level: 0,\n    },\n  });\n};\n","import { FieldExtensionSDK } from '@contentful/app-sdk';\nimport {\n  createDeserializeAstPlugin,\n  createDeserializeHtmlPlugin,\n  PlateProps,\n} from '@udecode/plate-core';\nimport { createDeserializeDocxPlugin } from '@udecode/plate-serializer-docx';\n\nimport { RichTextPlugin } from '../types';\nimport { createSoftBreakPlugin, createExitBreakPlugin, createResetNodePlugin } from './Break';\nimport { createDragAndDropPlugin } from './DragAndDrop';\nimport {\n  createEmbeddedAssetBlockPlugin,\n  createEmbeddedEntryBlockPlugin,\n} from './EmbeddedEntityBlock';\nimport { createEmbeddedEntityInlinePlugin } from './EmbeddedEntityInline';\nimport { createHeadingPlugin } from './Heading';\nimport { createHrPlugin } from './Hr';\nimport { createHyperlinkPlugin } from './Hyperlink';\nimport { createListPlugin } from './List';\nimport { createMarksPlugin } from './Marks';\nimport { createNormalizerPlugin } from './Normalizer';\nimport { createParagraphPlugin } from './Paragraph';\nimport { createPasteHTMLPlugin } from './PasteHTML';\nimport { createQuotePlugin } from './Quote';\nimport { createSelectOnBackspacePlugin } from './SelectOnBackspace';\nimport { createSlashCommandsPlugin } from './SlashCommands';\nimport { createTablePlugin } from './Table';\nimport { createTextPlugin } from './Text';\nimport { createTrackingPlugin, RichTextTrackingActionHandler } from './Tracking';\nimport { createTrailingParagraphPlugin } from './TrailingParagraph';\nimport { createVoidsPlugin } from './Voids';\n\nexport const getPlugins = (\n  sdk: FieldExtensionSDK,\n  onAction: RichTextTrackingActionHandler\n): RichTextPlugin[] => [\n  // AST must come after the HTML deserializer\n  createDeserializeHtmlPlugin(),\n  createDeserializeAstPlugin(),\n  createDeserializeDocxPlugin(),\n\n  // Tracking - This should come first so all plugins below will have access to `editor.tracking`\n  createTrackingPlugin(onAction),\n\n  // Global / Global shortcuts\n  createDragAndDropPlugin(),\n  createSlashCommandsPlugin(),\n\n  // Block Elements\n  createParagraphPlugin(),\n  createListPlugin(),\n  createHrPlugin(),\n  createHeadingPlugin(),\n  createQuotePlugin(),\n  createTablePlugin(),\n  createEmbeddedEntryBlockPlugin(sdk),\n  createEmbeddedAssetBlockPlugin(sdk),\n\n  // Inline elements\n  createHyperlinkPlugin(sdk),\n  createEmbeddedEntityInlinePlugin(sdk),\n\n  // Marks\n  createMarksPlugin(),\n\n  // Other\n  createTrailingParagraphPlugin(),\n  createTextPlugin(),\n  createVoidsPlugin(),\n  createSelectOnBackspacePlugin(),\n\n  // Pasting content from other sources\n  createPasteHTMLPlugin(),\n\n  // These plugins drive their configurations from the list of plugins\n  // above. They MUST come last.\n  createSoftBreakPlugin(),\n  createExitBreakPlugin(),\n  createResetNodePlugin(),\n  createNormalizerPlugin(),\n];\n\nexport const disableCorePlugins: PlateProps['disableCorePlugins'] = {\n  // Temporarily until the upstream issue is fixed.\n  // See: https://github.com/udecode/plate/issues/1329#issuecomment-1005935946\n  deserializeAst: true,\n  deserializeHtml: true,\n\n  // Note: Enabled by default since v9.0.0 but it causes Cypress's\n  // .click() command to fail\n  eventEditor: true,\n};\n","import { toSlatejsDocument } from '@contentful/contentful-slatejs-adapter';\nimport { EMPTY_DOCUMENT, Document } from '@contentful/rich-text-types';\nimport { createPlateEditor, CreatePlateEditorOptions } from '@udecode/plate-core';\nimport { Descendant, Editor, Node, Transforms } from 'slate';\nimport { RichTextEditor } from 'types';\n\nimport schema from './constants/Schema';\nimport { sanitizeIncomingSlateDoc } from './helpers/sanitizeIncomingSlateDoc';\n\n/**\n * For legacy reasons, a document may not have any content at all\n * e.g:\n *\n * {nodeType: document, data: {}, content: []}\n *\n * Rendering such document will break the Slate editor\n */\nexport const hasContent = (doc?: Document) => {\n  if (!doc) {\n    return false;\n  }\n\n  return doc.content.length > 0;\n};\n\n/*\n Plate api doesn't allow to modify (easily) the editor value programmatically\n after the editor instance is created \n\n This function is inspired to https://github.com/udecode/plate/issues/1269#issuecomment-1057643622\n */\nexport const setEditorContent = (editor: Editor, nodes?: Node[]): void => {\n  // Replaces editor content while keeping change history\n  Editor.withoutNormalizing(editor, () => {\n    const children = [...editor.children];\n    children.forEach((node) => editor.apply({ type: 'remove_node', path: [0], node }));\n\n    if (nodes) {\n      const nodesArray = Node.isNode(nodes) ? [nodes] : nodes;\n      nodesArray.forEach((node, i) => editor.apply({ type: 'insert_node', path: [i], node: node }));\n    }\n\n    const point = Editor.end(editor, []);\n    if (point) {\n      Transforms.select(editor, point);\n    }\n  });\n};\n\n/**\n * Converts a Contentful rich text document to the corresponding slate editor\n * value\n */\nexport const documentToEditorValue = (doc: any) => {\n  const slateDoc = toSlatejsDocument({\n    document: hasContent(doc) ? doc : EMPTY_DOCUMENT,\n    // TODO: get rid of schema, https://github.com/contentful/field-editors/pull/1065#discussion_r826723248\n    schema,\n  });\n\n  return sanitizeIncomingSlateDoc(slateDoc);\n};\n\nexport const normalizeEditorValue = (\n  value: Descendant[],\n  options?: Omit<CreatePlateEditorOptions<RichTextEditor>, 'id' | 'editor'>\n) => {\n  const editor = createPlateEditor(options);\n  editor.children = value;\n  Editor.normalize(editor, { force: true });\n  return editor.children;\n};\n","import { CustomText, TextOrCustomElement } from '../types';\n\nconst isTextElement = (node: TextOrCustomElement): node is CustomText => 'text' in node;\n\n/**\n * Ensures all nodes have a child leaf text element. This should be handled by\n * Slate but its behavior has proven to be buggy and unpredictable.\n */\nexport function sanitizeIncomingSlateDoc(nodes: TextOrCustomElement[] = []): TextOrCustomElement[] {\n  return nodes.map((node: TextOrCustomElement): TextOrCustomElement => {\n    if (isTextElement(node)) {\n      return node;\n    }\n    if (node.children?.length === 0) {\n      return {\n        ...node,\n        children: [{ text: '', data: {} }],\n      };\n    }\n    return {\n      ...node,\n      children: sanitizeIncomingSlateDoc(node.children),\n    };\n  });\n}\n","import tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\n\nconst STYLE_EDITOR_BORDER = `1px solid ${tokens.gray400}`;\n\nexport const styles = {\n  root: css({\n    position: 'relative',\n  }),\n  editor: css({\n    borderRadius: `0 0 ${tokens.borderRadiusMedium} ${tokens.borderRadiusMedium}`,\n    border: STYLE_EDITOR_BORDER,\n    borderTop: 0,\n    padding: '20px',\n    fontSize: tokens.spacingM,\n    fontFamily: tokens.fontStackPrimary,\n    minHeight: '400px',\n    background: tokens.colorWhite,\n    outline: 'none',\n    whiteSpace: 'pre-wrap',\n    overflowWrap: 'break-word',\n    webkitUserModify: 'read-write-plaintext-only',\n    a: {\n      span: {\n        cursor: 'not-allowed',\n        '&:hover': {\n          cursor: 'not-allowed',\n        },\n      },\n    },\n    // We need to reset LIC style due to conflicts between PARAGRAPH styles\n    'ul > li > div': {\n      margin: 0,\n    },\n  }),\n  hiddenToolbar: css({\n    borderTop: STYLE_EDITOR_BORDER,\n  }),\n  enabled: css({\n    background: tokens.colorWhite,\n    a: {\n      span: {\n        cursor: 'pointer',\n        '&:hover': {\n          cursor: 'pointer',\n        },\n      },\n    },\n  }),\n  disabled: css({\n    background: tokens.gray100,\n    cursor: 'not-allowed',\n  }),\n};\n","import * as React from 'react';\n\nimport { Button, Menu } from '@contentful/f36-components';\nimport { PlusIcon, ChevronDownIcon } from '@contentful/f36-icons';\n\nexport interface EmbeddedEntityDropdownButtonProps {\n  children: React.ReactNode;\n  isDisabled: boolean | undefined;\n  isOpen: boolean;\n  onClose: () => void;\n  onToggle: () => void;\n}\n\nexport function EmbeddedEntityDropdownButton({\n  children,\n  isDisabled,\n  isOpen,\n  onClose,\n  onToggle,\n}: EmbeddedEntityDropdownButtonProps) {\n  return (\n    <Menu placement=\"bottom-end\" isOpen={isOpen} onClose={onClose} onOpen={onToggle}>\n      <Menu.Trigger>\n        <Button\n          endIcon={<ChevronDownIcon />}\n          testId=\"toolbar-entity-dropdown-toggle\"\n          variant=\"secondary\"\n          size=\"small\"\n          startIcon={<PlusIcon />}\n          isDisabled={isDisabled}>\n          Embed\n        </Button>\n      </Menu.Trigger>\n      <Menu.List className=\"toolbar-entity-dropdown-list\">{children}</Menu.List>\n    </Menu>\n  );\n}\n","import React, { useState } from 'react';\n\nimport { BLOCKS, INLINES } from '@contentful/rich-text-types';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { isLinkActive } from '../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../helpers/validations';\nimport { ToolbarIcon as EmbeddedEntityBlockToolbarIcon } from '../../plugins/EmbeddedEntityBlock';\nimport { ToolbarEmbeddedEntityInlineButton } from '../../plugins/EmbeddedEntityInline';\nimport { useSdkContext } from '../../SdkProvider';\nimport { EmbeddedEntityDropdownButton } from './EmbeddedEntityDropdownButton';\n\nexport interface EmbedEntityWidgetProps {\n  isDisabled?: boolean;\n  canInsertBlocks?: boolean;\n}\n\nexport const EmbedEntityWidget = ({ isDisabled, canInsertBlocks }: EmbedEntityWidgetProps) => {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n\n  const [isEmbedDropdownOpen, setEmbedDropdownOpen] = useState(false);\n  const onCloseEntityDropdown = () => setEmbedDropdownOpen(false);\n  const onToggleEntityDropdown = () => setEmbedDropdownOpen(!isEmbedDropdownOpen);\n\n  const inlineEntryEmbedEnabled = isNodeTypeEnabled(sdk.field, INLINES.EMBEDDED_ENTRY);\n  const blockEntryEmbedEnabled =\n    isNodeTypeEnabled(sdk.field, BLOCKS.EMBEDDED_ENTRY) && canInsertBlocks;\n  // Removed access check following https://contentful.atlassian.net/browse/DANTE-486\n  // TODO: refine permissions check in order to account for tags in rules and then readd access.can('read', 'Asset')\n  const blockAssetEmbedEnabled =\n    isNodeTypeEnabled(sdk.field, BLOCKS.EMBEDDED_ASSET) && canInsertBlocks;\n\n  const actions = (\n    <>\n      {blockEntryEmbedEnabled && (\n        <EmbeddedEntityBlockToolbarIcon\n          isDisabled={!!isDisabled}\n          nodeType={BLOCKS.EMBEDDED_ENTRY}\n          onClose={onCloseEntityDropdown}\n        />\n      )}\n      {inlineEntryEmbedEnabled && (\n        <ToolbarEmbeddedEntityInlineButton\n          isDisabled={!!isDisabled || isLinkActive(editor)}\n          onClose={onCloseEntityDropdown}\n        />\n      )}\n      {blockAssetEmbedEnabled && (\n        <EmbeddedEntityBlockToolbarIcon\n          isDisabled={!!isDisabled}\n          nodeType={BLOCKS.EMBEDDED_ASSET}\n          onClose={onCloseEntityDropdown}\n        />\n      )}\n    </>\n  );\n\n  const showEmbedButton =\n    blockEntryEmbedEnabled || inlineEntryEmbedEnabled || blockAssetEmbedEnabled;\n\n  return showEmbedButton ? (\n    <EmbeddedEntityDropdownButton\n      isDisabled={isDisabled}\n      onClose={onCloseEntityDropdown}\n      onToggle={onToggleEntityDropdown}\n      isOpen={isEmbedDropdownOpen}>\n      {actions}\n    </EmbeddedEntityDropdownButton>\n  ) : null;\n};\n","import React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { Flex } from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS, INLINES, MARKS } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\n\nimport { useContentfulEditor } from '../ContentfulEditorProvider';\nimport { isNodeTypeSelected } from '../helpers/editor';\nimport { isNodeTypeEnabled, isMarkEnabled } from '../helpers/validations';\nimport { ToolbarHeadingButton } from '../plugins/Heading';\nimport { ToolbarHrButton } from '../plugins/Hr';\nimport { ToolbarHyperlinkButton } from '../plugins/Hyperlink';\nimport { ToolbarListButton } from '../plugins/List';\nimport { ToolbarBoldButton } from '../plugins/Marks/Bold';\nimport { ToolbarCodeButton } from '../plugins/Marks/Code';\nimport { ToolbarItalicButton } from '../plugins/Marks/Italic';\nimport { ToolbarUnderlineButton } from '../plugins/Marks/Underline';\nimport { ToolbarQuoteButton } from '../plugins/Quote';\nimport { ToolbarTableButton } from '../plugins/Table';\nimport { useSdkContext } from '../SdkProvider';\nimport { EmbedEntityWidget } from './components/EmbedEntityWidget';\n\ntype ToolbarProps = {\n  isDisabled?: boolean;\n};\n\nconst styles = {\n  toolbar: css({\n    border: `1px solid ${tokens.gray400}`,\n    backgroundColor: tokens.gray100,\n    padding: tokens.spacingXs,\n    borderRadius: `${tokens.borderRadiusMedium} ${tokens.borderRadiusMedium} 0 0`,\n  }),\n  divider: css({\n    display: 'inline-block',\n    height: '21px',\n    width: '1px',\n    background: tokens.gray300,\n    margin: `0 ${tokens.spacing2Xs}`,\n  }),\n  embedActionsWrapper: css({\n    display: ['-webkit-box', '-ms-flexbox', 'flex'],\n    webkitAlignSelf: 'flex-start',\n    alignSelf: 'flex-start',\n    msFlexItemAlign: 'start',\n    marginLeft: 'auto',\n  }),\n  formattingOptionsWrapper: css({\n    display: ['-webkit-box', '-ms-flexbox', 'flex'],\n    msFlexAlign: 'center',\n    webkitBoxAlign: 'center',\n    alignItems: 'center',\n    msFlexWrap: 'wrap',\n    flexWrap: 'wrap',\n    marginRight: '20px',\n  }),\n};\n\nconst Toolbar = ({ isDisabled }: ToolbarProps) => {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n  const canInsertBlocks = !isNodeTypeSelected(editor, BLOCKS.TABLE);\n  const validationInfo = React.useMemo(() => getValidationInfo(sdk.field), [sdk.field]);\n  const isListSelected =\n    isNodeTypeSelected(editor, BLOCKS.UL_LIST) || isNodeTypeSelected(editor, BLOCKS.OL_LIST);\n  const isBlockquoteSelected = isNodeTypeSelected(editor, BLOCKS.QUOTE);\n  const shouldDisableTables =\n    isDisabled || !canInsertBlocks || isListSelected || isBlockquoteSelected;\n\n  return (\n    <Flex testId=\"toolbar\" className={styles.toolbar} alignItems=\"center\">\n      <div className={styles.formattingOptionsWrapper}>\n        <ToolbarHeadingButton isDisabled={isDisabled || !canInsertBlocks} />\n\n        {validationInfo.isAnyMarkEnabled && <span className={styles.divider} />}\n\n        {isMarkEnabled(sdk.field, MARKS.BOLD) && <ToolbarBoldButton isDisabled={isDisabled} />}\n        {isMarkEnabled(sdk.field, MARKS.ITALIC) && <ToolbarItalicButton isDisabled={isDisabled} />}\n        {isMarkEnabled(sdk.field, MARKS.UNDERLINE) && (\n          <ToolbarUnderlineButton isDisabled={isDisabled} />\n        )}\n        {isMarkEnabled(sdk.field, MARKS.CODE) && <ToolbarCodeButton isDisabled={isDisabled} />}\n\n        {validationInfo.isAnyHyperlinkEnabled && (\n          <>\n            <span className={styles.divider} />\n            <ToolbarHyperlinkButton isDisabled={isDisabled} />\n          </>\n        )}\n\n        {validationInfo.isAnyBlockFormattingEnabled && <span className={styles.divider} />}\n\n        <ToolbarListButton isDisabled={isDisabled || !canInsertBlocks} />\n\n        {isNodeTypeEnabled(sdk.field, BLOCKS.QUOTE) && (\n          <ToolbarQuoteButton isDisabled={isDisabled || !canInsertBlocks} />\n        )}\n        {isNodeTypeEnabled(sdk.field, BLOCKS.HR) && (\n          <ToolbarHrButton isDisabled={isDisabled || !canInsertBlocks} />\n        )}\n        {isNodeTypeEnabled(sdk.field, BLOCKS.TABLE) && (\n          <ToolbarTableButton isDisabled={shouldDisableTables} />\n        )}\n      </div>\n      <div className={styles.embedActionsWrapper}>\n        <EmbedEntityWidget isDisabled={isDisabled} canInsertBlocks={canInsertBlocks} />\n      </div>\n    </Flex>\n  );\n};\n\nfunction getValidationInfo(field: FieldExtensionSDK['field']): {\n  isAnyMarkEnabled: boolean;\n  isAnyHyperlinkEnabled: boolean;\n  isAnyBlockFormattingEnabled: boolean;\n} {\n  const someWithValidation = (vals, validation) => vals.some((val) => validation(field, val));\n\n  const isAnyMarkEnabled = someWithValidation(Object.values(MARKS), isMarkEnabled);\n\n  const isAnyHyperlinkEnabled = someWithValidation(\n    [INLINES.HYPERLINK, INLINES.ASSET_HYPERLINK, INLINES.ENTRY_HYPERLINK],\n    isNodeTypeEnabled\n  );\n\n  const isAnyBlockFormattingEnabled = someWithValidation(\n    [BLOCKS.UL_LIST, BLOCKS.OL_LIST, BLOCKS.QUOTE, BLOCKS.HR],\n    isNodeTypeEnabled\n  );\n\n  return {\n    isAnyMarkEnabled,\n    isAnyHyperlinkEnabled,\n    isAnyBlockFormattingEnabled,\n  };\n}\n\nexport default Toolbar;\n","import React, { ReactNode } from 'react';\n\nimport { css } from 'emotion';\n\nconst styles = {\n  nativeSticky: css`\n    position: -webkit-sticky;\n    position: sticky;\n    top: -1px;\n    z-index: 2;\n  `,\n};\n\ntype StickyToolbarProps = {\n  isDisabled?: boolean;\n  children: ReactNode;\n};\n\nconst StickyToolbarWrapper = ({ isDisabled, children }: StickyToolbarProps) => (\n  <div className={isDisabled ? '' : styles.nativeSticky}>{children}</div>\n);\n\nexport default StickyToolbarWrapper;\n","import { useCallback, useMemo } from 'react';\n\nimport { toContentfulDocument } from '@contentful/contentful-slatejs-adapter';\nimport { Document } from '@contentful/rich-text-types';\nimport { getPlateSelectors } from '@udecode/plate-core';\nimport debounce from 'lodash/debounce';\nimport { Operation } from 'slate';\n\nimport schema from './constants/Schema';\n\n/**\n * Returns whether a given operation is relevant enough to trigger a save.\n */\nconst isRelevantOperation = (op: Operation) => {\n  if (op.type === 'set_selection') {\n    return false;\n  }\n\n  return true;\n};\n\nexport type OnValueChangedProps = {\n  editorId: string;\n  handler?: (value: Document) => unknown;\n  skip?: boolean;\n  onSkip?: VoidFunction;\n};\n\nexport const useOnValueChanged = ({ editorId, handler, skip, onSkip }: OnValueChangedProps) => {\n  const onChange = useMemo(\n    () =>\n      debounce((document: unknown) => {\n        handler?.(toContentfulDocument({ document, schema }));\n      }, 500),\n    [handler]\n  );\n\n  return useCallback(\n    (value: unknown) => {\n      const editor = getPlateSelectors(editorId).editor();\n      if (!editor) {\n        throw new Error(\n          'Editor change callback called but editor not defined. Editor id: ' + editorId\n        );\n      }\n      const operations = editor?.operations.filter(isRelevantOperation);\n\n      if (operations.length > 0) {\n        if (skip) {\n          onSkip?.();\n          return;\n        }\n        onChange(value);\n      }\n    },\n    [editorId, onChange, skip, onSkip]\n  );\n};\n","import React, { useCallback, useState, useEffect } from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { EntityProvider } from '@contentful/field-editor-reference';\nimport { FieldConnector } from '@contentful/field-editor-shared';\nimport * as Contentful from '@contentful/rich-text-types';\nimport { Plate, getPlateSelectors, getPlateActions } from '@udecode/plate-core';\nimport { css, cx } from 'emotion';\nimport deepEquals from 'fast-deep-equal';\nimport noop from 'lodash/noop';\n\nimport { ContentfulEditorIdProvider, getContentfulEditorId } from './ContentfulEditorProvider';\nimport { getPlugins, disableCorePlugins } from './plugins';\nimport { SlashCommandsPalette } from './plugins/SlashCommands';\nimport { RichTextTrackingActionHandler } from './plugins/Tracking';\nimport { documentToEditorValue, normalizeEditorValue, setEditorContent } from './prepareDocument';\nimport { styles } from './RichTextEditor.styles';\nimport { SdkProvider } from './SdkProvider';\nimport Toolbar from './Toolbar';\nimport StickyToolbarWrapper from './Toolbar/components/StickyToolbarWrapper';\nimport { useOnValueChanged } from './useOnValueChanged';\n\ntype ConnectedProps = {\n  sdk: FieldExtensionSDK;\n  onAction?: RichTextTrackingActionHandler;\n  minHeight?: string | number;\n  value?: object;\n  isDisabled?: boolean;\n  onChange?: (doc: Contentful.Document) => unknown;\n  isToolbarHidden?: boolean;\n  actionsDisabled?: boolean;\n};\n\nexport const ConnectedRichTextEditor = (props: ConnectedProps) => {\n  const id = getContentfulEditorId(props.sdk);\n  const plugins = React.useMemo(\n    () => getPlugins(props.sdk, props.onAction ?? noop),\n    [props.sdk, props.onAction]\n  );\n\n  const [isFirstRender, setIsFirstRender] = useState(true);\n  const [pendingExternalUpdate, setPendingExternalUpdate] = useState(false);\n\n  const onValueChanged = useOnValueChanged({\n    editorId: id,\n    handler: props.onChange,\n    skip: pendingExternalUpdate || isFirstRender,\n    onSkip: () => setPendingExternalUpdate(false),\n  });\n\n  useEffect(() => {\n    /*\n      This effect is called when the value prop changes. Normally\n      this happens when the value is changed outside of the editor,\n      like in snapshots restoration or remote updates\n      Plate won't update the displayed value on its own, see:\n       - https://github.com/ianstormtaylor/slate/pull/4540\n       - https://github.com/udecode/plate/issues/1169\n\n       The content is forcefully set to the new value and it's ensured\n       the change listener isn't invoked\n    */\n    setIsFirstRender(false);\n    const editor = getPlateSelectors(id).editor();\n    if (!editor) {\n      return;\n    }\n    setPendingExternalUpdate(true);\n    setEditorContent(editor, documentToEditorValue(props.value));\n  }, [props.value, id]);\n\n  const classNames = cx(\n    styles.editor,\n    props.minHeight !== undefined ? css({ minHeight: props.minHeight }) : undefined,\n    props.isDisabled ? styles.disabled : styles.enabled,\n    props.isToolbarHidden && styles.hiddenToolbar\n  );\n\n  useEffect(() => {\n    if (!isFirstRender) {\n      return;\n    }\n\n    getPlateActions(id).value(\n      normalizeEditorValue(documentToEditorValue(props.value), {\n        plugins,\n        disableCorePlugins,\n      })\n    );\n  }, [isFirstRender, plugins, id, props.value]);\n\n  return (\n    <SdkProvider sdk={props.sdk}>\n      <ContentfulEditorIdProvider value={id}>\n        <div className={styles.root} data-test-id=\"rich-text-editor\">\n          <Plate\n            id={id}\n            plugins={plugins}\n            disableCorePlugins={disableCorePlugins}\n            editableProps={{\n              className: classNames,\n              readOnly: props.isDisabled,\n            }}\n            onChange={onValueChanged}>\n            {!props.isToolbarHidden && (\n              <StickyToolbarWrapper isDisabled={props.isDisabled}>\n                <Toolbar isDisabled={props.isDisabled} />\n              </StickyToolbarWrapper>\n            )}\n\n            {/* We put it inside <Plate> so we can use some hooks such as `useContentfulEditor` */}\n            <SlashCommandsPalette editorId={id} />\n          </Plate>\n        </div>\n      </ContentfulEditorIdProvider>\n    </SdkProvider>\n  );\n};\n\ntype Props = ConnectedProps & { isInitiallyDisabled: boolean };\n\nconst RichTextEditor = (props: Props) => {\n  const { sdk, isInitiallyDisabled, onAction, ...otherProps } = props;\n  const isEmptyValue = useCallback(\n    (value) => !value || deepEquals(value, Contentful.EMPTY_DOCUMENT),\n    []\n  );\n\n  const id = getContentfulEditorId(props.sdk);\n  return (\n    <EntityProvider sdk={sdk}>\n      <FieldConnector\n        throttle={0}\n        field={sdk.field}\n        isInitiallyDisabled={isInitiallyDisabled}\n        isEmptyValue={isEmptyValue}\n        isEqualValues={deepEquals}>\n        {({ lastRemoteValue, disabled, setValue }) => (\n          <ConnectedRichTextEditor\n            {...otherProps}\n            key={`rich-text-editor-${id}`}\n            value={lastRemoteValue}\n            sdk={sdk}\n            onAction={onAction}\n            isDisabled={disabled}\n            onChange={setValue}\n          />\n        )}\n      </FieldConnector>\n    </EntityProvider>\n  );\n};\n\nexport default RichTextEditor;\n","import { BLOCKS, INLINES } from '@contentful/rich-text-types';\nimport { getNodes } from '@udecode/plate-core';\n\nimport { RichTextPlugin } from '../../types';\n\nexport function createDragAndDropPlugin(): RichTextPlugin {\n  const DRAGGABLE_TYPES: string[] = [\n    BLOCKS.EMBEDDED_ENTRY,\n    BLOCKS.EMBEDDED_ASSET,\n    BLOCKS.HR,\n    INLINES.EMBEDDED_ENTRY,\n  ];\n\n  /**\n   * HTML node names where dropping should be allowed\n   * Usually for elements where `Transforms.removeNodes` is needed\n   * TODO: looking up for html nodes is not the best solution and it won't scale but it works fine for our current cases/elements\n   */\n  const ON_DROP_ALLOWED_TYPES = {\n    TABLE: [INLINES.EMBEDDED_ENTRY],\n  };\n\n  return {\n    key: 'DragAndDropPlugin',\n    handlers: {\n      // If true, the next handlers will be skipped.\n      onDrop: (editor) => (event) => {\n        const [draggingBlock] = Array.from(\n          getNodes(editor, {\n            match: (node) => DRAGGABLE_TYPES.includes(node?.type),\n          })\n        );\n        if (!draggingBlock) return false;\n\n        const [draggingNode] = draggingBlock;\n\n        if (!event.nativeEvent.target) return false;\n\n        // TODO: looking up for html nodes is not the best solution and it won't scale, we need to find a way to know the dropping target slate element\n        const dropDisallowed = getParents(event.nativeEvent.target as Node).some((node) => {\n          return ON_DROP_ALLOWED_TYPES[node.nodeName]\n            ? !ON_DROP_ALLOWED_TYPES[node.nodeName]?.includes(draggingNode.type)\n            : false;\n        });\n\n        if (!dropDisallowed) {\n          // Move the drop event to a new undo batch mitigating the bug where undo not only moves it back,\n          // but also undoes a previous action: https://github.com/ianstormtaylor/slate/issues/4694\n          editor.history.undos.push([]);\n        }\n\n        return dropDisallowed;\n      },\n    },\n  };\n}\n\nfunction getParents(el: Node): Node[] {\n  const parents: Node[] = [];\n\n  parents.push(el);\n  while (el.parentNode) {\n    parents.unshift(el.parentNode);\n    el = el.parentNode;\n  }\n\n  return parents;\n}\n","// import debounce from 'lodash/debounce';\n\nimport { RichTextPlugin } from '../../types';\nimport { closePanel, openPanel } from './helpers';\n\nconst SLASH_COMMANDS_PLUGIN_KEY = 'SlashCommands';\n\n// TODO: Explore a solution using marks and ReactDOM.createPortal to activate the commands panel\nexport function createSlashCommandsPlugin(): RichTextPlugin {\n  return {\n    key: SLASH_COMMANDS_PLUGIN_KEY,\n    type: SLASH_COMMANDS_PLUGIN_KEY,\n    handlers: {\n      onClick: (editor) => () => {\n        closePanel(editor.id);\n      },\n      onKeyDown: (editor) => (event) => {\n        closePanel(editor.id);\n\n        if (event.key === '/') {\n          openPanel(editor.id);\n        }\n      },\n    },\n  };\n}\n","export function isEmbedElement(element: HTMLElement) {\n  return (\n    element.hasAttribute('data-embedded-entity-inline-id') ||\n    element.hasAttribute('data-entity-type')\n  );\n}\n\nexport function isEmptyElement(element: HTMLElement) {\n  return element.textContent === '';\n}\n","import { BLOCKS, LIST_ITEM_BLOCKS } from '@contentful/rich-text-types';\nimport {\n  createListPlugin as createPlateListPlugin,\n  ELEMENT_LI,\n  ELEMENT_UL,\n  ELEMENT_OL,\n  ELEMENT_LIC,\n} from '@udecode/plate-list';\n\nimport { transformParagraphs, transformWrapIn } from '../../helpers/transformers';\nimport { RichTextEditor, RichTextPlugin } from '../../types';\nimport { ListOL, ListUL } from './components/List';\nimport { ListItem } from './components/ListItem';\nimport { onKeyDownList } from './onKeyDownList';\nimport {\n  isNonEmptyListItem,\n  hasListAsDirectParent,\n  insertParagraphAsChild,\n  normalizeOrphanedListItem,\n  firstNodeIsNotList,\n  replaceNodeWithListItems,\n} from './utils';\nimport { withList } from './withList';\n\nexport const createListPlugin = (): RichTextPlugin =>\n  createPlateListPlugin<RichTextEditor>({\n    normalizer: [\n      {\n        match: {\n          type: [BLOCKS.UL_LIST, BLOCKS.OL_LIST],\n        },\n        validChildren: [BLOCKS.LIST_ITEM],\n        transform: transformWrapIn(BLOCKS.LIST_ITEM),\n      },\n    ],\n    overrideByKey: {\n      [ELEMENT_UL]: {\n        type: BLOCKS.UL_LIST,\n        component: ListUL,\n        handlers: {\n          onKeyDown: onKeyDownList,\n        },\n        // The withList is added on ELEMENT_UL plugin in upstream code\n        // so we need to override it here\n        withOverrides: withList,\n      },\n      [ELEMENT_OL]: {\n        type: BLOCKS.OL_LIST,\n        component: ListOL,\n        handlers: {\n          onKeyDown: onKeyDownList,\n        },\n      },\n      // ELEMENT_LIC is a child of li, Slate does ul > li > lic + ul\n      [ELEMENT_LIC]: {\n        type: BLOCKS.PARAGRAPH,\n      },\n      [ELEMENT_LI]: {\n        type: BLOCKS.LIST_ITEM,\n        component: ListItem,\n        // @ts-expect-error\n        normalizer: [\n          {\n            validNode: hasListAsDirectParent,\n            transform: normalizeOrphanedListItem,\n          },\n          {\n            validNode: isNonEmptyListItem,\n            transform: insertParagraphAsChild,\n          },\n          {\n            validChildren: LIST_ITEM_BLOCKS,\n            transform: transformParagraphs,\n          },\n          {\n            validNode: firstNodeIsNotList,\n            transform: replaceNodeWithListItems,\n          },\n        ],\n      },\n    },\n  });\n","import { RichTextPlugin } from '../../types';\nimport { createBoldPlugin } from './Bold';\nimport { createCodePlugin } from './Code';\nimport { createItalicPlugin } from './Italic';\nimport { createUnderlinePlugin } from './Underline';\n\nexport const createMarksPlugin = (): RichTextPlugin => ({\n  key: 'Marks',\n  plugins: [createBoldPlugin(), createCodePlugin(), createItalicPlugin(), createUnderlinePlugin()],\n});\n","import { isFirstChild } from '@udecode/plate-core';\n\nimport { isRootLevel } from '../../helpers/editor';\nimport { RichTextPlugin } from '../../types';\n\nexport const createVoidsPlugin = (): RichTextPlugin => ({\n  key: 'VoidsPlugin',\n  exitBreak: [\n    {\n      // Inserts a new paragraph *before* a void element if it's the very first\n      // node on the editor\n      hotkey: 'enter',\n      before: true,\n      query: {\n        filter: ([node, path]) => isRootLevel(path) && isFirstChild(path) && !!node.isVoid,\n      },\n    },\n    {\n      // Inserts a new paragraph on enter when a void element is focused\n      hotkey: 'enter',\n      // exploit the internal use of Array.slice(0, level + 1) by the exitBreak plugin\n      // to stay in the parent element\n      level: -2,\n      query: {\n        filter: ([node, path]) => !(isRootLevel(path) && isFirstChild(path)) && !!node.isVoid,\n      },\n    },\n  ],\n});\n","import { INLINES } from '@contentful/rich-text-types';\nimport { createSelectOnBackspacePlugin as createDefaultSelectPlugin } from '@udecode/plate-select';\n\nimport { RichTextPlugin } from '../../types';\n\nexport const createSelectOnBackspacePlugin = (): RichTextPlugin =>\n  createDefaultSelectPlugin({\n    options: {\n      query: {\n        // `createTextPlugin` is taking care of block elements\n        allow: [INLINES.EMBEDDED_ENTRY],\n      },\n    },\n  });\n","import {\n  createSoftBreakPlugin as createDefaultSoftBreakPlugin,\n  SoftBreakRule,\n} from '@udecode/plate-break';\n\nimport { RichTextPlugin } from '../../types';\n\nexport const createSoftBreakPlugin = (): RichTextPlugin =>\n  createDefaultSoftBreakPlugin({\n    then: (editor) => {\n      const rules: SoftBreakRule[] = editor.plugins.flatMap((p) => {\n        return (p as RichTextPlugin).softBreak || [];\n      });\n\n      return {\n        options: { rules },\n      };\n    },\n  });\n","import {\n  createExitBreakPlugin as createDefaultExitBreakPlugin,\n  ExitBreakRule,\n} from '@udecode/plate-break';\n\nimport { RichTextPlugin } from '../../types';\n\nexport const createExitBreakPlugin = (): RichTextPlugin =>\n  createDefaultExitBreakPlugin({\n    options: {\n      rules: [],\n    },\n    then: (editor) => {\n      const rules: ExitBreakRule[] = editor.plugins.flatMap((p) => {\n        return (p as RichTextPlugin).exitBreak || [];\n      });\n\n      return {\n        options: { rules },\n      };\n    },\n  });\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  createResetNodePlugin as createDefaultResetNodePlugin,\n  ResetNodePluginRule,\n} from '@udecode/plate-reset-node';\n\nimport { RichTextPlugin } from '../../types';\n\nexport const createResetNodePlugin = (): RichTextPlugin =>\n  createDefaultResetNodePlugin({\n    options: {\n      rules: [],\n    },\n    then: (editor) => {\n      const rules: ResetNodePluginRule[] = editor.plugins.flatMap((p) => {\n        return (p as RichTextPlugin).resetNode || [];\n      });\n\n      // set defaultType to Paragraph if not set\n      for (const rule of rules) {\n        if (!rule.defaultType) {\n          rule.defaultType = BLOCKS.PARAGRAPH;\n        }\n      }\n\n      return {\n        options: { rules },\n      };\n    },\n  });\n","import { RichTextPlugin } from '../../types';\nimport { withNormalizer } from './withNormalizer';\n\nexport const createNormalizerPlugin = (): RichTextPlugin => ({\n  key: 'NormalizerPlugin',\n  // @ts-expect-error\n  withOverrides: withNormalizer,\n});\n","import React from 'react';\n\nimport {\n  TextLink,\n  Button,\n  FormControl,\n  FormLabel,\n  Select,\n  TextInput,\n  Form,\n  ModalContent,\n  ModalControls,\n} from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { EntityProvider } from '@contentful/field-editor-reference';\nimport { css } from 'emotion';\nimport PropTypes from 'prop-types';\n\nimport { FetchingWrappedAssetCard } from '../../plugins/shared/FetchingWrappedAssetCard';\nimport { FetchingWrappedEntryCard } from '../../plugins/shared/FetchingWrappedEntryCard';\n\nexport const LINK_TYPES = {\n  URI: 'uri',\n  ENTRY: 'Entry',\n  ASSET: 'Asset',\n};\n\nfunction isFeaturingEntitySelector(entitySelectorConfigs = {}) {\n  return !!entitySelectorConfigs.Entry || !!entitySelectorConfigs.Asset;\n}\n\nfunction entityToLink(entity) {\n  const { id, type } = entity.sys;\n  return { sys: { id, type: 'Link', linkType: type } };\n}\n\nexport class HyperlinkDialog extends React.Component {\n  static propTypes = {\n    sdk: PropTypes.object.isRequired,\n    labels: PropTypes.shape({\n      title: PropTypes.string,\n      confirm: PropTypes.string,\n    }),\n    value: PropTypes.shape({\n      text: PropTypes.string,\n      uri: PropTypes.string,\n      target: PropTypes.object,\n      // Will be overwritten accordingly if `uri` or `target.sys.linkType` are set.\n      type: PropTypes.oneOf(['uri', 'Entry', 'Asset']),\n    }),\n    entitySelectorConfigs: PropTypes.object,\n    allowedHyperlinkTypes: PropTypes.arrayOf(\n      PropTypes.oneOf([LINK_TYPES.ENTRY, LINK_TYPES.ASSET, LINK_TYPES.URI])\n    ),\n    hideText: PropTypes.bool,\n    onClose: PropTypes.func.isRequired,\n  };\n\n  static defaultProps = {\n    labels: {\n      title: 'Insert link',\n      confirm: 'Insert link',\n    },\n    value: {},\n    hideText: false,\n    entitySelectorConfigs: {},\n    allowedHyperlinkTypes: [LINK_TYPES.ENTRY, LINK_TYPES.ASSET, LINK_TYPES.URI],\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { text, type, uri, target } = props.value;\n    const isEntityLink = Boolean(target);\n    const entityLinks = {\n      [LINK_TYPES.ENTRY]: null,\n      [LINK_TYPES.ASSET]: null,\n    };\n    let linkType = type;\n\n    if (isEntityLink) {\n      linkType = target.sys.linkType;\n      entityLinks[linkType] = target;\n    } else if (props.allowedHyperlinkTypes.includes(LINK_TYPES.URI)) {\n      linkType = LINK_TYPES.URI;\n    } else {\n      linkType = props.allowedHyperlinkTypes[0];\n    }\n\n    this.state = { text, uri, entityLinks, type: linkType };\n  }\n\n  setTargetEntity(type, entity) {\n    this.setState((state) => ({\n      entityLinks: {\n        ...state.entityLinks,\n        [type]: entity ? entityToLink(entity) : undefined,\n      },\n    }));\n  }\n\n  getValue() {\n    const { text, type, uri } = this.state;\n    const value = { type };\n    if (text) {\n      value.text = text;\n    }\n    if (type === LINK_TYPES.URI) {\n      value.uri = uri;\n    } else {\n      value.target = this.state.entityLinks[type];\n    }\n    return value;\n  }\n\n  isLinkComplete() {\n    const { text, type, uri, target } = this.getValue();\n    const requiresText = !this.props.hideText;\n    if (requiresText && !text) {\n      return false;\n    }\n    return (type === LINK_TYPES.URI && uri) || target;\n  }\n\n  handleSubmit = (event) => {\n    event.preventDefault();\n    this.props.onClose(this.getValue());\n  };\n\n  selectEntry = async () => {\n    const { locale, contentTypes } = this.props.entitySelectorConfigs.Entry;\n    const entry = await this.props.sdk.dialogs.selectSingleEntry({ locale, contentTypes });\n    this.setTargetEntity(LINK_TYPES.ENTRY, entry);\n  };\n\n  selectAsset = async () => {\n    const { locale } = this.props.entitySelectorConfigs.Asset;\n    const asset = await this.props.sdk.dialogs.selectSingleAsset({ locale });\n    this.setTargetEntity(LINK_TYPES.ASSET, asset);\n  };\n\n  render() {\n    const { labels } = this.props;\n    return (\n      <EntityProvider sdk={this.props.sdk}>\n        <React.Fragment>\n          <ModalContent>{this.renderFields()}</ModalContent>\n          <ModalControls>\n            <Button\n              type=\"button\"\n              onClick={() => this.props.onClose(null)}\n              variant=\"secondary\"\n              testId=\"cancel-cta\"\n              size=\"small\">\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              variant=\"positive\"\n              onClick={this.handleSubmit}\n              isDisabled={!this.isLinkComplete()}\n              testId=\"confirm-cta\"\n              size=\"small\">\n              {labels.confirm}\n            </Button>\n          </ModalControls>\n        </React.Fragment>\n      </EntityProvider>\n    );\n  }\n\n  renderFields() {\n    const { hideText, allowedHyperlinkTypes, entitySelectorConfigs } = this.props;\n    const { uri, text, type } = this.state;\n    const isUriInputAutoFocused = type === LINK_TYPES.URI && (hideText || !!text);\n\n    return (\n      <Form>\n        {hideText ? null : (\n          <FormControl id=\"link-text\" isRequired>\n            <FormControl.Label>Link text</FormControl.Label>\n            <TextInput\n              testId=\"link-text-input\"\n              name=\"link-text\"\n              value={text || ''}\n              onChange={(e) => this.setState({ text: e.target.value })}\n              // eslint-disable-next-line jsx-a11y/no-autofocus\n              autoFocus={!isUriInputAutoFocused}\n            />\n          </FormControl>\n        )}\n        {isFeaturingEntitySelector(entitySelectorConfigs) && (\n          <FormControl id=\"link-type\" name=\"link-type\">\n            <FormControl.Label>Link type</FormControl.Label>\n            <Select\n              value={type}\n              onChange={(e) => this.setState({ type: e.target.value })}\n              testId=\"link-type-select\">\n              {/* Show the option if the link type is allowed or the current link is of type that is no longer valid */}\n              {allowedHyperlinkTypes.includes(LINK_TYPES.URI) || type === LINK_TYPES.URI ? (\n                <Select.Option value={LINK_TYPES.URI}>URL</Select.Option>\n              ) : null}\n              {allowedHyperlinkTypes.includes(LINK_TYPES.ENTRY) || type === LINK_TYPES.ENTRY ? (\n                <Select.Option value={LINK_TYPES.ENTRY}>Entry</Select.Option>\n              ) : null}\n              {allowedHyperlinkTypes.includes(LINK_TYPES.ASSET) || type === LINK_TYPES.ASSET ? (\n                <Select.Option value={LINK_TYPES.ASSET}>Asset</Select.Option>\n              ) : null}\n            </Select>\n          </FormControl>\n        )}\n        {type === LINK_TYPES.URI ? (\n          <FormControl id=\"link-uri\" isRequired>\n            <FormControl.Label>Link target</FormControl.Label>\n            <TextInput\n              testId=\"link-target-input\"\n              name=\"link-uri\"\n              value={uri || ''}\n              placeholder=\"https://\"\n              onChange={(e) => this.setState({ uri: e.target.value })}\n              // eslint-disable-next-line jsx-a11y/no-autofocus\n              autoFocus={isUriInputAutoFocused}\n            />\n            <FormControl.HelpText>A protocol may be required, e.g. https://</FormControl.HelpText>\n          </FormControl>\n        ) : (\n          this.renderEntityField()\n        )}\n      </Form>\n    );\n  }\n\n  renderEntityField() {\n    const { type, entityLinks } = this.state;\n    const resetEntity = () => this.setTargetEntity(type, null);\n    const entityLink = entityLinks[type];\n    const isEntitySelectorVisible = !entityLink;\n    return (\n      <div>\n        <FormLabel required htmlFor=\"\">\n          Link target\n        </FormLabel>\n        {!isEntitySelectorVisible && (\n          <TextLink\n            as=\"button\"\n            className={css({ marginLeft: tokens.spacingS })}\n            onClick={resetEntity}>\n            Remove selection\n          </TextLink>\n        )}\n        {entityLink && (\n          <div>\n            {type === LINK_TYPES.ENTRY && (\n              <FetchingWrappedEntryCard\n                sdk={this.props.sdk}\n                locale={this.props.entitySelectorConfigs.Entry.locale}\n                entryId={entityLink.sys.id}\n                isDisabled\n                isSelected={false}\n              />\n            )}\n            {type == LINK_TYPES.ASSET && (\n              <FetchingWrappedAssetCard\n                sdk={this.props.sdk}\n                locale={this.props.entitySelectorConfigs.Asset.locale}\n                assetId={entityLink.sys.id}\n                isDisabled\n                isSelected={false}\n              />\n            )}\n          </div>\n        )}\n        {/* Keep all entity selectors in the DOM for super fast types switching ux.*/}\n        {isEntitySelectorVisible && this.renderEntitySelector(type, isEntitySelectorVisible)}\n      </div>\n    );\n  }\n\n  renderEntitySelector(type) {\n    return (\n      <div className={css({ marginTop: tokens.spacingS })}>\n        {type === LINK_TYPES.ENTRY && (\n          <TextLink as=\"button\" onClick={this.selectEntry}>\n            Select entry\n          </TextLink>\n        )}\n        {type === LINK_TYPES.ASSET && (\n          <TextLink as=\"button\" onClick={this.selectAsset}>\n            Select asset\n          </TextLink>\n        )}\n      </div>\n    );\n  }\n}\n\nexport const openHyperlinkDialog = (\n  dialogs,\n  { value, showTextInput, allowedHyperlinkTypes, entitySelectorConfigs }\n) => {\n  const isNew = !(value.uri || value.target);\n  const props = {\n    labels: {\n      title: isNew ? 'Insert hyperlink' : 'Edit hyperlink',\n      confirm: isNew ? 'Insert' : 'Update',\n    },\n    value,\n    hideText: !showTextInput,\n    allowedHyperlinkTypes,\n    entitySelectorConfigs,\n  };\n\n  return dialogs.openCurrent({\n    title: props.labels.title,\n    width: 'large',\n    shouldCloseOnEscapePress: true,\n    shouldCloseOnOverlayClick: true,\n    allowHeightOverflow: true,\n    parameters: {\n      type: 'rich-text-hyperlink-dialog',\n      ...props,\n    },\n  });\n};\n","import React from 'react';\n\nimport { DialogExtensionSDK } from '@contentful/app-sdk';\nimport { ModalDialogLauncher } from '@contentful/field-editor-shared';\n\nimport { HyperlinkDialog } from './HypelinkDialog/HyperlinkDialog';\n\nexport const openRichTextDialog = (sdk: DialogExtensionSDK) => (options) => {\n  if (options.parameters?.type === 'rich-text-hyperlink-dialog') {\n    return ModalDialogLauncher.openDialog(options, ({ onClose }) => {\n      return <HyperlinkDialog {...options.parameters} onClose={onClose} sdk={sdk} />;\n    });\n  }\n  return Promise.reject();\n};\n","import React from 'react';\n\nimport { DialogExtensionSDK } from '@contentful/app-sdk';\n\nimport { HyperlinkDialog } from './HypelinkDialog/HyperlinkDialog';\n\nexport const renderRichTextDialog = (sdk: DialogExtensionSDK) => {\n  const parameters = sdk.parameters.invocation as Record<string, unknown>;\n  if (parameters?.type === 'rich-text-hyperlink-dialog') {\n    sdk.window.startAutoResizer();\n    return <HyperlinkDialog {...sdk.parameters.invocation} onClose={sdk.close} sdk={sdk} />;\n  }\n  return <div />;\n};\n"],"names":["getContentfulEditorId","sdk","field","entry","getSys","id","locale","editorContext","createContext","ContentfulEditorIdProvider","Provider","useContentfulEditorId","contextId","useContext","Error","useContentfulEditor","editorId","usePlateEditorState","IS_SAFARI","navigator","test","userAgent","IS_CHROME","LINK_TYPES","INLINES","HYPERLINK","ENTRY_HYPERLINK","ASSET_HYPERLINK","isBlockSelected","editor","type","Array","from","Editor","nodes","match","node","Element","isElement","isRootLevel","path","length","getNodeEntryFromSelection","nodeTypeOrTypes","selection","_editor$selection","focus","nodeTypes","isArray","i","nodeEntry","slice","includes","isNodeTypeSelected","nodeType","moveToTheNextChar","Transforms","move","distance","unit","insertEmptyParagraph","options","insertNodes","BLOCKS","PARAGRAPH","children","text","data","isVoid","insertLink","url","target","isLinkActive","unwrapLink","isCollapsed","Range","link","uri","setNodes","at","insertText","select","wrapNodes","split","collapse","edge","wrapLink","isEditor","unwrapNodes","INLINE_TYPES","Object","values","isInlineOrText","Text","isText","x","window","scrollX","y","scrollY","ReactEditor","setTimeout","scrollTo","toggleElement","editorOptions","toggleNodeType","withLinkTracking","Component","props","usePlateEditorRef","onEntityFetchComplete","React","useCallback","tracking","onViewportAction","useSdk","constate","SdkProvider","useSdkContext","useFetchedEntity","useEntities","getOrLoadEntry","getOrLoadAsset","store","entries","assets","useState","entity","setEntity","useEffect","newValue","areEqual","InternalAssetCard","undefined","asset","AssetCard","size","isLoading","MissingEntityCard","entityType","isDisabled","onRemove","WrappedAssetCard","getEntityScheduledActions","loadEntityScheduledActions","isSelected","localeCode","defaultLocaleCode","locales","onEdit","isClickable","FetchingWrappedAssetCard","assetId","displayName","InternalEntryCard","EntryCard","contentType","space","getCachedContentTypes","find","sys","WrappedEntryCard","getAsset","FetchingWrappedEntryCard","entryId","styles","root","css","marginBottom","display","container","verticalAlign","width","LinkedEntityBlock","attributes","element","useSelected","useReadOnly","entityId","linkType","handleEditClick","openAsset","openEntry","slideIn","handleRemoveClick","pathToElement","findPath","removeNodes","className","contentEditable","draggable","runtime","exports","Op","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","key","value","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","generator","create","Generator","context","Context","_invoke","state","method","arg","done","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","makeInvokeMethod","fn","call","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","resolve","reject","invoke","result","__await","then","unwrapped","error","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","doneResult","constructor","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","toString","keys","object","reverse","pop","skipTempReset","prev","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","Function","getLinkedContentTypeIdsForNodeType","flow","v","get","validations","newEntitySelectorConfigFromRichTextField","getEntityTypeFromRichTextNode","contentTypes","words","indexOf","selectEntityAndInsert","logAction","dialogs","baseConfig","selectEntity","selectSingleAsset","selectSingleEntry","config","withCreate","insertBlock","ensureFollowingParagraph","parent","above","voids","e","EMBEDDED_ASSET","EMBEDDED_ENTRY","paragraph","TEXT_CONTAINERS","Path","isChild","linkedEntityBlock","createNode","getText","marginRight","EmbeddedEntityBlockToolbarIcon","onClose","handleClick","event","preventDefault","onToolbarAction","toLowerCase","getEntityTypeFromNodeType","Menu","Item","disabled","onClick","testId","Flex","alignItems","flexDirection","Icon","as","AssetIcon","EmbeddedEntryBlockIcon","variant","entityTypes","getWithEmbeddedEntityEvents","hotkey","pathToSelectedElement","isHotkey","onShortcutAction","createEmbeddedEntityPlugin","component","handlers","onKeyDown","deserializeHtml","rules","validAttribute","withoutChildren","getNode","el","getAttribute","createEmbeddedEntryBlockPlugin","createEmbeddedAssetBlockPlugin","getEntryTitle","entityHelpers","getEntryStatus","scheduledIcon","tokens","spacing2Xs","FetchingWrappedInlineEntryCard","useMemo","allContentTypes","contentTypeName","title","defaultTitle","InlineEntryCard","status","actions","MenuItem","ScheduledIconWithTooltip","ClockIcon","createInlineEntryNode","icon","margin","fontSize","span","userSelect","EmbeddedEntityInline","inlineEntryNode","setSelection","ToolbarEmbeddedEntityInlineButton","EmbeddedEntryInlineIcon","createEmbeddedEntityInlinePlugin","isInline","getWithEmbeddedEntryInlineEvents","DEFAULT_ENABLED_NODE_TYPES","DOCUMENT","isFormattingOptionEnabled","validationType","nodeTypeOrMark","enabledFormattings","getRichTextValidation","concat","isNodeTypeEnabled","isMarkEnabled","dropdown","fontWeightDemiBold","fontSizeL","HEADING_1","HEADING_2","HEADING_3","HEADING_4","HEADING_5","HEADING_6","LABELS","ToolbarHeadingButton","isOpen","setOpen","selected","setSelected","flat","getElementFromCurrentSelection","operations","nodeTypesByEnablement","fromEntries","map","filter","Boolean","someHeadingsEnabled","Trigger","Button","endIcon","ChevronDownIcon","List","isInitiallyFocused","prevOnChange","onChange","isActive","activeType","inactiveType","cx","transformRemove","transformParagraphs","getNodes","mode","extractNodes","extractParagraphs","transformUnwrap","transformWrapIn","transformLift","liftNodes","headings","fontWeightMedium","spacingS","createHeading","Tag","block","HeadingComponents","createHeadingPlugin","softBreak","query","allow","HEADINGS","normalizer","validChildren","_","transform","exitBreak","end","start","getAbove","LIST_ITEM","plugins","idx","level","validNodeName","toUpperCase","button","height","marginLeft","tooltip","zIndex","Number","zIndexTooltip","ToolbarButton","startIcon","Tooltip","placement","content","spacingL","hr","spacingM","gray300","hrSelected","colorPrimary","withHrEvents","pathToSelectedHr","HR","ToolbarHrButton","moveToTheNextLine","HorizontalRuleIcon","Hr","Slate","isFocused","removeSelectionLabel","SYS_LINK_TYPES","LINK_TYPE_SELECTION_VALUES","HyperlinkModal","enabledLinkTypes","defaultLinkType","linkText","setLinkText","setLinkType","linkTarget","setLinkTarget","linkEntity","setLinkEntity","entityToLink","EntityProvider","ModalContent","Form","FormControl","isRequired","Label","TextInput","Select","readonly","Option","HelpText","FormLabel","htmlFor","TextLink","ModalControls","addOrEditLink","targetPath","isReadOnly","selectionBeforeBlur","string","selectionAfterFocus","currentLinkText","isEditing","ModalDialogLauncher","openDialog","shouldCloseOnEscapePress","shouldCloseOnOverlayClick","allowHeightOverflow","withoutNormalizing","ToolbarHyperlinkButton","LinkIcon","hasText","isAncestorEmpty","Node","trim","getEntity","getEntry","contentTypeId","ct","entityTitle","getAssetTitle","entityDescription","getEntityDescription","jobs","entityStatus","hyperlinkWrapper","position","a","hyperlink","fill","gray900","EntityHyperlink","tooltipContent","requestStatus","setRequestStatus","fetchAllData","_target$sys","_target$sys2","entityInfo","console","log","str","substr","replace","getScheduleTooltipContent","job","jobsCount","getEntityInfo","useEntityInfo","targetWrapperClassName","maxWidth","stopPropagation","p","toSlatePoint","exactMatch","suppressThrow","UrlHyperlink","href","rel","isEntryAnchor","nodeName","isAssetAnchor","buildHyperlinkEventHandler","getNodeOfType","createHyperlinkPlugin","common","validNode","baseStyle","lineHeightDefault","UL_LIST","OL_LIST","createList","ListUL","ListOL","style","spacingXs","ListItem","hasUnliftedListItems","unwrapList","listTypes","toggleList","isRangeAcrossBlocks","res","getListItemEntry","list","n","getPluginType","ELEMENT_DEFAULT","listItem","edges","commonEntry","listType","startList","findNode","endList","rangeLength","Math","min","rootPathLength","ELEMENT_LIC","onKeyDownList","increase","_nodes","lics","highestLicPaths","highestLicPathRefs","lic","licPath","liPath","some","highestLiPath","isAncestor","pathRef","licPathRefsToMove","licPathRef","unref","liEntry","previousListItemPath","listNode","listItemPath","previous","previousSiblingItem","subList","getListTypes","newPath","getLastChildPath","moveNodes","to","moveListItemDown","isListNested","moveListItemUp","moveListItems","shiftKey","castArray","isList","hasListAsDirectParent","getParent","normalizeOrphanedListItem","parentList","getNearestListAncestor","isNonEmptyListItem","firstNodeIsNotList","_editor","firstNode","insertParagraphAsChild","replaceNodeWithListItems","isListTypeActive","isExpanded","getBlockAbove","isListRoot","validLiChildrenTypes","LIST_ITEM_BLOCKS","withList","deleteBackward","deleteForward","deleteFragment","moved","isSelectionAtBlockStart","removeFirstListItem","removeListItem","isFirstChild","onKeyDownResetNode","mockPlugin","types","defaultType","predicate","onReset","SIMULATE_BACKSPACE","deleteBackwardList","deleteForwardList","deleteFragmentList","insertBreak","childNode","isBlockAboveEmpty","ELEMENT_LI","paragraphPath","isAtStart","isAtEnd","isSelectionAtBlockEnd","isAtStartOfListItem","shouldSplit","splitNodes","newListItemPath","withChildren","marks","emptyListItemNode","fromPath","fromStartIndex","toPath","moveChildren","insertListItem","listBreak","insertListBreak","insertFragment","fragment","unwrapTextContainerAtStart","trimLiWrapper","flatMap","listRoot","textEntries","texts","commonAncestorEntry","reduce","commonAncestor","textEntry","ancestor","getFirstAncestorOfType","trimList","firstBlockIndex","findIndex","isBlock","inlines","blocks","filtered","insertListFragment","normalizeNode","normalizeList","ToolbarListButton","ListBulletedIcon","ListNumberedIcon","createMarkToolbarButton","Mark","isMarkActive","markType","toggleMark","buildMarkEventHandler","ToolbarBoldButton","MARKS","BOLD","FormatBoldIcon","bold","fontWeight","Bold","ToolbarCodeButton","CODE","CodeIcon","code","fontFamily","Code","ToolbarItalicButton","ITALIC","FormatItalicIcon","italic","fontStyle","Italic","ToolbarUnderlineButton","UNDERLINE","FormatUnderlinedIcon","Underline","isTextContainer","baseRules","_getParent","_getParent2","NormalizerError","createValidatorFromTypes","createTransformerFromObject","transforms","fallback","withNormalizer","_rules","rule","isPlainObject","_transform","tr","getChildren","isValidChild","invalidChildEntry","Paragraph","buildParagraphKeyDownHandler","transformers","doc","querySelectorAll","remove","selector","querySelector","isEmptyElement","textContent","tables","table","row","rows","colIndex","cells","cell","every","sanitizeHTML","html","cb","DOMParser","parseFromString","body","innerHTML","catchSlateFragment","borderLeft","gray200","paddingLeft","Quote","shouldResetQuoteOnBackspace","quote","QUOTE","hasSingleChild","isLastChild","toggleQuote","onKeyDownToggleQuote","plugin","withQuote","startingNode","startsWithBlockquote","containerEntry","containerIsNotEmpty","Point","compare","anchor","isContentSelected","createQuotePlugin","resetNode","CONTAINERS","withOverrides","ToolbarQuoteButton","QuoteIcon","closePanel","document","dispatchEvent","CustomEvent","detail","SlashCommandsPalette","setPosition","setIsOpen","currentTries","setCurrentTries","handler","topLeft","sel","getSelection","rect","r2","r","getRangeAt","startContainer","offset","startOffset","createRange","setStart","setEnd","left","getBoundingClientRect","right","top","getComputedStyle","lineHeight","parseInt","getCaretTopPoint","curr","addEventListener","removeEventListener","boxShadow","borderRadius","Card","addRow","getNextRowPath","someNode","ELEMENT_TABLE","currentRowItem","ELEMENT_TR","currentRowElem","nextRowPath","getEmptyRowNode","header","colCount","addRowBelow","currentRowPath","addRowAbove","addColumn","getNextCellPath","currentCellItem","ELEMENT_TD","ELEMENT_TH","currentTableItem","newCellPath","replacePathPos","rowIdx","getEmptyCellNode","addColumnRight","currentCellPath","addColumnLeft","insertTableAndFocusFirstCell","insertTable","tablePath","levels","getAncestorPathFromSelection","previousPath","replaceEmptyParagraphWithTable","getNoOfMissingTableCellsInRow","rowPath","max","isNotEmpty","isTable","TABLE","topRight","TableActions","isHeaderEnabled","setHeaderEnabled","close","tableItem","firstRow","TABLE_HEADER_CELL","isTableHeaderEnabled","canInsertRowAbove","toggleHeader","enable","TABLE_CELL","setHeader","action","tableSize","numRows","numColumns","_firstRow$children","getTableSize","getCurrentTableSize","onOpen","IconButton","tabIndex","Divider","deleteRow","deleteColumn","deleteTable","gray400","Cell","fontWeightNormal","HeaderCell","Row","Table","trimUnnecessaryTableWrapper","onKeyDownTable","defaultHandler","defaultKeyDownTable","windowSelection","anchorNode","_windowSelection$anch","_windowSelection$anch2","getTableCellEntry","tableElement","tableRow","isLastCell","tableCell","TOP_LEVEL_BLOCKS","VOID_BLOCKS","normalize","unwrapBlockByKey","getCharacterCount","contentfulSlateJSAdapter","schema","Schema","documentToPlainTextString","getPastingSource","textHtml","getData","createTrackingPlugin","onAction","trackingActions","actionName","origin","onCommandPaletteAction","insertData","characterCountSelection","_window$getSelection","characterCountBefore","characterCountAfter","source","hasTables","isTableHeaderCell","withInvalidCellChildrenTracking","transformer","childEntry","createTablePlugin","createDefaultTablePlugin","withTable","markupBefore","markupAfter","tablePasted","hasHeadersOutsideFirstRow","addTableTrackingEvents","fragments","isInsertingTable","isTableFirstFragment","currentLineHasText","insertTableFragment","overrideByKey","isNestedTable","TABLE_ROW","emptyTableCell","howMany","ToolbarTableButton","isTableActive","TableIcon","deleteEmptyParagraph","deleteFunction","prevNode","before","queryNode","disableCorePlugins","deserializeAst","eventEditor","hasContent","documentToEditorValue","sanitizeIncomingSlateDoc","isTextElement","toSlatejsDocument","EMPTY_DOCUMENT","STYLE_EDITOR_BORDER","borderRadiusMedium","border","borderTop","padding","fontStackPrimary","minHeight","background","colorWhite","outline","whiteSpace","overflowWrap","webkitUserModify","cursor","hiddenToolbar","enabled","gray100","EmbeddedEntityDropdownButton","onToggle","PlusIcon","EmbedEntityWidget","canInsertBlocks","isEmbedDropdownOpen","setEmbedDropdownOpen","onCloseEntityDropdown","inlineEntryEmbedEnabled","blockEntryEmbedEnabled","blockAssetEmbedEnabled","toolbar","backgroundColor","divider","embedActionsWrapper","webkitAlignSelf","alignSelf","msFlexItemAlign","formattingOptionsWrapper","msFlexAlign","webkitBoxAlign","msFlexWrap","flexWrap","Toolbar","validationInfo","isAnyMarkEnabled","someWithValidation","vals","validation","val","isAnyHyperlinkEnabled","isAnyBlockFormattingEnabled","isListSelected","isBlockquoteSelected","shouldDisableTables","nativeSticky","StickyToolbarWrapper","isRelevantOperation","op","ConnectedRichTextEditor","skip","onSkip","DRAGGABLE_TYPES","ON_DROP_ALLOWED_TYPES","noop","createDeserializeHtmlPlugin","createDeserializeAstPlugin","createDeserializeDocxPlugin","onDrop","draggingBlock","draggingNode","nativeEvent","dropDisallowed","parents","parentNode","unshift","getParents","_ON_DROP_ALLOWED_TYPE","history","undos","hasAttribute","createDefaultParagraphPlugin","createPlateListPlugin","ELEMENT_UL","ELEMENT_OL","createDefaultBoldPlugin","validStyle","startsWith","isGoogleBoldWrapper","someHtmlElement","createDefaultCodePlugin","createDefaultItalicPlugin","createDefaultUnderlinePlugin","textDecoration","createTrailingBlockPlugin","onMouseUp","unhangRange","inlinePath","_Editor$above","isEnd","point","after","insertTextData","line","always","fixPasteAsPlainText","createDefaultSelectPlugin","dataTransfer","getSlateFragmentAttribute","clipboardData","DataTransfer","setData","ensureXSlateFragment","inject","pluginsByKey","KEY_DESERIALIZE_HTML","format","transformData","createDefaultSoftBreakPlugin","createDefaultExitBreakPlugin","createDefaultResetNodePlugin","isFirstRender","setIsFirstRender","setPendingExternalUpdate","onValueChanged","debounce","toContentfulDocument","getPlateSelectors","apply","isNode","setEditorContent","classNames","isToolbarHidden","getPlateActions","createPlateEditor","force","Plate","editableProps","readOnly","HyperlinkDialog","handleSubmit","_this","getValue","selectEntry","entitySelectorConfigs","Entry","setTargetEntity","selectAsset","Asset","isEntityLink","entityLinks","allowedHyperlinkTypes","setState","isLinkComplete","hideText","render","labels","Fragment","renderFields","_this2","confirm","isUriInputAutoFocused","_this3","autoFocus","isFeaturingEntitySelector","placeholder","renderEntityField","entityLink","isEntitySelectorVisible","required","_this4","renderEntitySelector","marginTop","propTypes","PropTypes","shape","oneOf","arrayOf","bool","func","defaultProps","isInitiallyDisabled","otherProps","isEmptyValue","deepEquals","Contentful","FieldConnector","throttle","isEqualValues","lastRemoteValue","setValue","parameters","invocation","startAutoResizer"],"mappings":"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"}